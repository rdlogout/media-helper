// @bun
var T5=Object.create;var{getPrototypeOf:z5,defineProperty:S2,getOwnPropertyNames:L5}=Object;var D5=Object.prototype.hasOwnProperty;var y2=($,J,U)=>{U=$!=null?T5(z5($)):{};let H=J||!$||!$.__esModule?S2(U,"default",{value:$,enumerable:!0}):U;for(let Q of L5($))if(!D5.call(H,Q))S2(H,Q,{get:()=>$[Q],enumerable:!0});return H};var _=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var O=import.meta.require;var H0=_((QQ,i2)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var p2=($)=>typeof $!=="undefined"&&$!==null,u5=($)=>typeof $==="object",m5=($)=>Object.prototype.toString.call($)==="[object Object]",l5=($)=>typeof $==="function",c5=($)=>typeof $==="boolean",r5=($)=>$ instanceof Buffer,a5=($)=>{if(p2($))switch($.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},e5=($)=>$ instanceof ArrayBuffer,n5=($)=>typeof $==="string"&&$.length>0,s5=($)=>typeof $==="number"&&!Number.isNaN($),p5=($)=>Number.isInteger($),i5=($,J,U)=>$>=J&&$<=U,t5=($,J)=>J.includes($),o5=($,J,U)=>new Error(`Expected ${J} for ${$} but received ${U} of type ${typeof U}`),$J=($,J)=>{return J.message=$.message,J};i2.exports={defined:p2,object:u5,plainObject:m5,fn:l5,bool:c5,buffer:r5,typedArray:a5,arrayBuffer:e5,string:n5,number:s5,integer:p5,inRange:i5,inArray:t5,invalidParameterError:o5,nativeError:$J}});var $$=_((WQ,o2)=>{var t2=()=>process.platform==="linux",I1=null,JJ=()=>{if(!I1)if(t2()&&process.report){let $=process.report.excludeNetwork;process.report.excludeNetwork=!0,I1=process.report.getReport(),process.report.excludeNetwork=$}else I1={};return I1};o2.exports={isLinux:t2,getReport:JJ}});var U$=_((ZQ,J$)=>{var x0=O("fs"),UJ=($)=>{let J=x0.openSync($,"r"),U=Buffer.alloc(2048),H=x0.readSync(J,U,0,2048,0);return x0.close(J,()=>{}),U.subarray(0,H)},HJ=($)=>new Promise((J,U)=>{x0.open($,"r",(H,Q)=>{if(H)U(H);else{let W=Buffer.alloc(2048);x0.read(Q,W,0,2048,0,(Z,Y)=>{J(W.subarray(0,Y)),x0.close(Q,()=>{})})}})});J$.exports={LDD_PATH:"/usr/bin/ldd",SELF_PATH:"/proc/self/exe",readFileSync:UJ,readFile:HJ}});var Q$=_((NQ,H$)=>{var QJ=($)=>{if($.length<64)return null;if($.readUInt32BE(0)!==2135247942)return null;if($.readUInt8(4)!==2)return null;if($.readUInt8(5)!==1)return null;let J=$.readUInt32LE(32),U=$.readUInt16LE(54),H=$.readUInt16LE(56);for(let Q=0;Q<H;Q++){let W=J+Q*U;if($.readUInt32LE(W)===3){let Y=$.readUInt32LE(W+8),N=$.readUInt32LE(W+32);return $.subarray(Y,Y+N).toString().replace(/\0.*$/g,"")}}return null};H$.exports={interpreterPath:QJ}});var P1=_((YQ,T$)=>{var Z$=O("child_process"),{isLinux:v0,getReport:N$}=$$(),{LDD_PATH:V1,SELF_PATH:Y$,readFile:n1,readFileSync:s1}=U$(),{interpreterPath:q$}=Q$(),Q0,W0,Z0,P0="",K$=()=>{if(!P0)return new Promise(($)=>{Z$.exec("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",(J,U)=>{P0=J?" ":U,$(P0)})});return P0},X$=()=>{if(!P0)try{P0=Z$.execSync("getconf GNU_LIBC_VERSION 2>&1 || true; ldd --version 2>&1 || true",{encoding:"utf8"})}catch($){P0=" "}return P0},X0="glibc",G$=/LIBC[a-z0-9 \-).]*?(\d+\.\d+)/i,F0="musl",WJ=($)=>$.includes("libc.musl-")||$.includes("ld-musl-"),I$=()=>{let $=N$();if($.header&&$.header.glibcVersionRuntime)return X0;if(Array.isArray($.sharedObjects)){if($.sharedObjects.some(WJ))return F0}return null},V$=($)=>{let[J,U]=$.split(/[\r\n]+/);if(J&&J.includes(X0))return X0;if(U&&U.includes(F0))return F0;return null},P$=($)=>{if($){if($.includes("/ld-musl-"))return F0;else if($.includes("/ld-linux-"))return X0}return null},A$=($)=>{if($=$.toString(),$.includes("musl"))return F0;if($.includes("GNU C Library"))return X0;return null},ZJ=async()=>{if(W0!==void 0)return W0;W0=null;try{let $=await n1(V1);W0=A$($)}catch($){}return W0},NJ=()=>{if(W0!==void 0)return W0;W0=null;try{let $=s1(V1);W0=A$($)}catch($){}return W0},YJ=async()=>{if(Q0!==void 0)return Q0;Q0=null;try{let $=await n1(Y$),J=q$($);Q0=P$(J)}catch($){}return Q0},qJ=()=>{if(Q0!==void 0)return Q0;Q0=null;try{let $=s1(Y$),J=q$($);Q0=P$(J)}catch($){}return Q0},B$=async()=>{let $=null;if(v0()){if($=await YJ(),!$){if($=await ZJ(),!$)$=I$();if(!$){let J=await K$();$=V$(J)}}}return $},R$=()=>{let $=null;if(v0()){if($=qJ(),!$){if($=NJ(),!$)$=I$();if(!$){let J=X$();$=V$(J)}}}return $},KJ=async()=>v0()&&await B$()!==X0,XJ=()=>v0()&&R$()!==X0,GJ=async()=>{if(Z0!==void 0)return Z0;Z0=null;try{let J=(await n1(V1)).match(G$);if(J)Z0=J[1]}catch($){}return Z0},IJ=()=>{if(Z0!==void 0)return Z0;Z0=null;try{let J=s1(V1).match(G$);if(J)Z0=J[1]}catch($){}return Z0},E$=()=>{let $=N$();if($.header&&$.header.glibcVersionRuntime)return $.header.glibcVersionRuntime;return null},W$=($)=>$.trim().split(/\s+/)[1],j$=($)=>{let[J,U,H]=$.split(/[\r\n]+/);if(J&&J.includes(X0))return W$(J);if(U&&H&&U.includes(F0))return W$(H);return null},VJ=async()=>{let $=null;if(v0()){if($=await GJ(),!$)$=E$();if(!$){let J=await K$();$=j$(J)}}return $},PJ=()=>{let $=null;if(v0()){if($=IJ(),!$)$=E$();if(!$){let J=X$();$=j$(J)}}return $};T$.exports={GLIBC:X0,MUSL:F0,family:B$,familySync:R$,isNonGlibcLinux:KJ,isNonGlibcLinuxSync:XJ,version:VJ,versionSync:PJ}});var e0=_((qQ,z$)=>{var AJ=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...$)=>console.error("SEMVER",...$):()=>{};z$.exports=AJ});var A1=_((KQ,L$)=>{var BJ=Number.MAX_SAFE_INTEGER||9007199254740991,RJ=["major","premajor","minor","preminor","patch","prepatch","prerelease"];L$.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:BJ,RELEASE_TYPES:RJ,SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var n0=_((N0,D$)=>{var{MAX_SAFE_COMPONENT_LENGTH:p1,MAX_SAFE_BUILD_LENGTH:EJ,MAX_LENGTH:jJ}=A1(),TJ=e0();N0=D$.exports={};var zJ=N0.re=[],LJ=N0.safeRe=[],F=N0.src=[],DJ=N0.safeSrc=[],M=N0.t={},wJ=0,i1="[a-zA-Z0-9-]",FJ=[["\\s",1],["\\d",jJ],[i1,EJ]],MJ=($)=>{for(let[J,U]of FJ)$=$.split(`${J}*`).join(`${J}{0,${U}}`).split(`${J}+`).join(`${J}{1,${U}}`);return $},k=($,J,U)=>{let H=MJ(J),Q=wJ++;TJ($,Q,J),M[$]=Q,F[Q]=J,DJ[Q]=H,zJ[Q]=new RegExp(J,U?"g":void 0),LJ[Q]=new RegExp(H,U?"g":void 0)};k("NUMERICIDENTIFIER","0|[1-9]\\d*");k("NUMERICIDENTIFIERLOOSE","\\d+");k("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${i1}*`);k("MAINVERSION",`(${F[M.NUMERICIDENTIFIER]})\\.(${F[M.NUMERICIDENTIFIER]})\\.(${F[M.NUMERICIDENTIFIER]})`);k("MAINVERSIONLOOSE",`(${F[M.NUMERICIDENTIFIERLOOSE]})\\.(${F[M.NUMERICIDENTIFIERLOOSE]})\\.(${F[M.NUMERICIDENTIFIERLOOSE]})`);k("PRERELEASEIDENTIFIER",`(?:${F[M.NONNUMERICIDENTIFIER]}|${F[M.NUMERICIDENTIFIER]})`);k("PRERELEASEIDENTIFIERLOOSE",`(?:${F[M.NONNUMERICIDENTIFIER]}|${F[M.NUMERICIDENTIFIERLOOSE]})`);k("PRERELEASE",`(?:-(${F[M.PRERELEASEIDENTIFIER]}(?:\\.${F[M.PRERELEASEIDENTIFIER]})*))`);k("PRERELEASELOOSE",`(?:-?(${F[M.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${F[M.PRERELEASEIDENTIFIERLOOSE]})*))`);k("BUILDIDENTIFIER",`${i1}+`);k("BUILD",`(?:\\+(${F[M.BUILDIDENTIFIER]}(?:\\.${F[M.BUILDIDENTIFIER]})*))`);k("FULLPLAIN",`v?${F[M.MAINVERSION]}${F[M.PRERELEASE]}?${F[M.BUILD]}?`);k("FULL",`^${F[M.FULLPLAIN]}$`);k("LOOSEPLAIN",`[v=\\s]*${F[M.MAINVERSIONLOOSE]}${F[M.PRERELEASELOOSE]}?${F[M.BUILD]}?`);k("LOOSE",`^${F[M.LOOSEPLAIN]}$`);k("GTLT","((?:<|>)?=?)");k("XRANGEIDENTIFIERLOOSE",`${F[M.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);k("XRANGEIDENTIFIER",`${F[M.NUMERICIDENTIFIER]}|x|X|\\*`);k("XRANGEPLAIN",`[v=\\s]*(${F[M.XRANGEIDENTIFIER]})(?:\\.(${F[M.XRANGEIDENTIFIER]})(?:\\.(${F[M.XRANGEIDENTIFIER]})(?:${F[M.PRERELEASE]})?${F[M.BUILD]}?)?)?`);k("XRANGEPLAINLOOSE",`[v=\\s]*(${F[M.XRANGEIDENTIFIERLOOSE]})(?:\\.(${F[M.XRANGEIDENTIFIERLOOSE]})(?:\\.(${F[M.XRANGEIDENTIFIERLOOSE]})(?:${F[M.PRERELEASELOOSE]})?${F[M.BUILD]}?)?)?`);k("XRANGE",`^${F[M.GTLT]}\\s*${F[M.XRANGEPLAIN]}$`);k("XRANGELOOSE",`^${F[M.GTLT]}\\s*${F[M.XRANGEPLAINLOOSE]}$`);k("COERCEPLAIN",`(^|[^\\d])(\\d{1,${p1}})(?:\\.(\\d{1,${p1}}))?(?:\\.(\\d{1,${p1}}))?`);k("COERCE",`${F[M.COERCEPLAIN]}(?:$|[^\\d])`);k("COERCEFULL",F[M.COERCEPLAIN]+`(?:${F[M.PRERELEASE]})?(?:${F[M.BUILD]})?(?:$|[^\\d])`);k("COERCERTL",F[M.COERCE],!0);k("COERCERTLFULL",F[M.COERCEFULL],!0);k("LONETILDE","(?:~>?)");k("TILDETRIM",`(\\s*)${F[M.LONETILDE]}\\s+`,!0);N0.tildeTrimReplace="$1~";k("TILDE",`^${F[M.LONETILDE]}${F[M.XRANGEPLAIN]}$`);k("TILDELOOSE",`^${F[M.LONETILDE]}${F[M.XRANGEPLAINLOOSE]}$`);k("LONECARET","(?:\\^)");k("CARETTRIM",`(\\s*)${F[M.LONECARET]}\\s+`,!0);N0.caretTrimReplace="$1^";k("CARET",`^${F[M.LONECARET]}${F[M.XRANGEPLAIN]}$`);k("CARETLOOSE",`^${F[M.LONECARET]}${F[M.XRANGEPLAINLOOSE]}$`);k("COMPARATORLOOSE",`^${F[M.GTLT]}\\s*(${F[M.LOOSEPLAIN]})$|^$`);k("COMPARATOR",`^${F[M.GTLT]}\\s*(${F[M.FULLPLAIN]})$|^$`);k("COMPARATORTRIM",`(\\s*)${F[M.GTLT]}\\s*(${F[M.LOOSEPLAIN]}|${F[M.XRANGEPLAIN]})`,!0);N0.comparatorTrimReplace="$1$2$3";k("HYPHENRANGE",`^\\s*(${F[M.XRANGEPLAIN]})\\s+-\\s+(${F[M.XRANGEPLAIN]})\\s*$`);k("HYPHENRANGELOOSE",`^\\s*(${F[M.XRANGEPLAINLOOSE]})\\s+-\\s+(${F[M.XRANGEPLAINLOOSE]})\\s*$`);k("STAR","(<|>)?=?\\s*\\*");k("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");k("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var B1=_((XQ,w$)=>{var CJ=Object.freeze({loose:!0}),_J=Object.freeze({}),SJ=($)=>{if(!$)return _J;if(typeof $!=="object")return CJ;return $};w$.exports=SJ});var _$=_((GQ,C$)=>{var F$=/^[0-9]+$/,M$=($,J)=>{if(typeof $==="number"&&typeof J==="number")return $===J?0:$<J?-1:1;let U=F$.test($),H=F$.test(J);if(U&&H)$=+$,J=+J;return $===J?0:U&&!H?-1:H&&!U?1:$<J?-1:1},yJ=($,J)=>M$(J,$);C$.exports={compareIdentifiers:M$,rcompareIdentifiers:yJ}});var O0=_((IQ,y$)=>{var R1=e0(),{MAX_LENGTH:S$,MAX_SAFE_INTEGER:E1}=A1(),{safeRe:j1,t:T1}=n0(),xJ=B1(),{compareIdentifiers:t1}=_$();class U0{constructor($,J){if(J=xJ(J),$ instanceof U0)if($.loose===!!J.loose&&$.includePrerelease===!!J.includePrerelease)return $;else $=$.version;else if(typeof $!=="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof $}".`);if($.length>S$)throw new TypeError(`version is longer than ${S$} characters`);R1("SemVer",$,J),this.options=J,this.loose=!!J.loose,this.includePrerelease=!!J.includePrerelease;let U=$.trim().match(J.loose?j1[T1.LOOSE]:j1[T1.FULL]);if(!U)throw new TypeError(`Invalid Version: ${$}`);if(this.raw=$,this.major=+U[1],this.minor=+U[2],this.patch=+U[3],this.major>E1||this.major<0)throw new TypeError("Invalid major version");if(this.minor>E1||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>E1||this.patch<0)throw new TypeError("Invalid patch version");if(!U[4])this.prerelease=[];else this.prerelease=U[4].split(".").map((H)=>{if(/^[0-9]+$/.test(H)){let Q=+H;if(Q>=0&&Q<E1)return Q}return H});this.build=U[5]?U[5].split("."):[],this.format()}format(){if(this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length)this.version+=`-${this.prerelease.join(".")}`;return this.version}toString(){return this.version}compare($){if(R1("SemVer.compare",this.version,this.options,$),!($ instanceof U0)){if(typeof $==="string"&&$===this.version)return 0;$=new U0($,this.options)}if($.version===this.version)return 0;return this.compareMain($)||this.comparePre($)}compareMain($){if(!($ instanceof U0))$=new U0($,this.options);if(this.major<$.major)return-1;if(this.major>$.major)return 1;if(this.minor<$.minor)return-1;if(this.minor>$.minor)return 1;if(this.patch<$.patch)return-1;if(this.patch>$.patch)return 1;return 0}comparePre($){if(!($ instanceof U0))$=new U0($,this.options);if(this.prerelease.length&&!$.prerelease.length)return-1;else if(!this.prerelease.length&&$.prerelease.length)return 1;else if(!this.prerelease.length&&!$.prerelease.length)return 0;let J=0;do{let U=this.prerelease[J],H=$.prerelease[J];if(R1("prerelease compare",J,U,H),U===void 0&&H===void 0)return 0;else if(H===void 0)return 1;else if(U===void 0)return-1;else if(U===H)continue;else return t1(U,H)}while(++J)}compareBuild($){if(!($ instanceof U0))$=new U0($,this.options);let J=0;do{let U=this.build[J],H=$.build[J];if(R1("build compare",J,U,H),U===void 0&&H===void 0)return 0;else if(H===void 0)return 1;else if(U===void 0)return-1;else if(U===H)continue;else return t1(U,H)}while(++J)}inc($,J,U){if($.startsWith("pre")){if(!J&&U===!1)throw new Error("invalid increment argument: identifier is empty");if(J){let H=`-${J}`.match(this.options.loose?j1[T1.PRERELEASELOOSE]:j1[T1.PRERELEASE]);if(!H||H[1]!==J)throw new Error(`invalid identifier: ${J}`)}}switch($){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",J,U);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",J,U);break;case"prepatch":this.prerelease.length=0,this.inc("patch",J,U),this.inc("pre",J,U);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",J,U);this.inc("pre",J,U);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0,this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":{let H=Number(U)?1:0;if(this.prerelease.length===0)this.prerelease=[H];else{let Q=this.prerelease.length;while(--Q>=0)if(typeof this.prerelease[Q]==="number")this.prerelease[Q]++,Q=-2;if(Q===-1){if(J===this.prerelease.join(".")&&U===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(H)}}if(J){let Q=[J,H];if(U===!1)Q=[J];if(t1(this.prerelease[0],J)===0){if(isNaN(this.prerelease[1]))this.prerelease=Q}else this.prerelease=Q}break}default:throw new Error(`invalid increment argument: ${$}`)}if(this.raw=this.format(),this.build.length)this.raw+=`+${this.build.join(".")}`;return this}}y$.exports=U0});var O$=_((VQ,v$)=>{var x$=O0(),vJ=($,J,U=!1)=>{if($ instanceof x$)return $;try{return new x$($,J)}catch(H){if(!U)return null;throw H}};v$.exports=vJ});var h$=_((PQ,k$)=>{var OJ=O0(),kJ=O$(),{safeRe:z1,t:L1}=n0(),hJ=($,J)=>{if($ instanceof OJ)return $;if(typeof $==="number")$=String($);if(typeof $!=="string")return null;J=J||{};let U=null;if(!J.rtl)U=$.match(J.includePrerelease?z1[L1.COERCEFULL]:z1[L1.COERCE]);else{let N=J.includePrerelease?z1[L1.COERCERTLFULL]:z1[L1.COERCERTL],K;while((K=N.exec($))&&(!U||U.index+U[0].length!==$.length)){if(!U||K.index+K[0].length!==U.index+U[0].length)U=K;N.lastIndex=K.index+K[1].length+K[2].length}N.lastIndex=-1}if(U===null)return null;let H=U[2],Q=U[3]||"0",W=U[4]||"0",Z=J.includePrerelease&&U[5]?`-${U[5]}`:"",Y=J.includePrerelease&&U[6]?`+${U[6]}`:"";return kJ(`${H}.${Q}.${W}${Z}${Y}`,J)};k$.exports=hJ});var M0=_((AQ,b$)=>{var f$=O0(),fJ=($,J,U)=>new f$($,U).compare(new f$(J,U));b$.exports=fJ});var o1=_((BQ,g$)=>{var bJ=M0(),gJ=($,J,U)=>bJ($,J,U)>=0;g$.exports=gJ});var m$=_((RQ,u$)=>{class d${constructor(){this.max=1000,this.map=new Map}get($){let J=this.map.get($);if(J===void 0)return;else return this.map.delete($),this.map.set($,J),J}delete($){return this.map.delete($)}set($,J){if(!this.delete($)&&J!==void 0){if(this.map.size>=this.max){let H=this.map.keys().next().value;this.delete(H)}this.map.set($,J)}return this}}u$.exports=d$});var c$=_((EQ,l$)=>{var dJ=M0(),uJ=($,J,U)=>dJ($,J,U)===0;l$.exports=uJ});var a$=_((jQ,r$)=>{var mJ=M0(),lJ=($,J,U)=>mJ($,J,U)!==0;r$.exports=lJ});var n$=_((TQ,e$)=>{var cJ=M0(),rJ=($,J,U)=>cJ($,J,U)>0;e$.exports=rJ});var p$=_((zQ,s$)=>{var aJ=M0(),eJ=($,J,U)=>aJ($,J,U)<0;s$.exports=eJ});var t$=_((LQ,i$)=>{var nJ=M0(),sJ=($,J,U)=>nJ($,J,U)<=0;i$.exports=sJ});var $4=_((DQ,o$)=>{var pJ=c$(),iJ=a$(),tJ=n$(),oJ=o1(),$U=p$(),JU=t$(),UU=($,J,U,H)=>{switch(J){case"===":if(typeof $==="object")$=$.version;if(typeof U==="object")U=U.version;return $===U;case"!==":if(typeof $==="object")$=$.version;if(typeof U==="object")U=U.version;return $!==U;case"":case"=":case"==":return pJ($,U,H);case"!=":return iJ($,U,H);case">":return tJ($,U,H);case">=":return oJ($,U,H);case"<":return $U($,U,H);case"<=":return JU($,U,H);default:throw new TypeError(`Invalid operator: ${J}`)}};o$.exports=UU});var N4=_((wQ,Z4)=>{var s0=Symbol("SemVer ANY");class D1{static get ANY(){return s0}constructor($,J){if(J=J4(J),$ instanceof D1)if($.loose===!!J.loose)return $;else $=$.value;if($=$.trim().split(/\s+/).join(" "),J2("comparator",$,J),this.options=J,this.loose=!!J.loose,this.parse($),this.semver===s0)this.value="";else this.value=this.operator+this.semver.version;J2("comp",this)}parse($){let J=this.options.loose?U4[H4.COMPARATORLOOSE]:U4[H4.COMPARATOR],U=$.match(J);if(!U)throw new TypeError(`Invalid comparator: ${$}`);if(this.operator=U[1]!==void 0?U[1]:"",this.operator==="=")this.operator="";if(!U[2])this.semver=s0;else this.semver=new Q4(U[2],this.options.loose)}toString(){return this.value}test($){if(J2("Comparator.test",$,this.options.loose),this.semver===s0||$===s0)return!0;if(typeof $==="string")try{$=new Q4($,this.options)}catch(J){return!1}return $2($,this.operator,this.semver,this.options)}intersects($,J){if(!($ instanceof D1))throw new TypeError("a Comparator is required");if(this.operator===""){if(this.value==="")return!0;return new W4($.value,J).test(this.value)}else if($.operator===""){if($.value==="")return!0;return new W4(this.value,J).test($.semver)}if(J=J4(J),J.includePrerelease&&(this.value==="<0.0.0-0"||$.value==="<0.0.0-0"))return!1;if(!J.includePrerelease&&(this.value.startsWith("<0.0.0")||$.value.startsWith("<0.0.0")))return!1;if(this.operator.startsWith(">")&&$.operator.startsWith(">"))return!0;if(this.operator.startsWith("<")&&$.operator.startsWith("<"))return!0;if(this.semver.version===$.semver.version&&this.operator.includes("=")&&$.operator.includes("="))return!0;if($2(this.semver,"<",$.semver,J)&&this.operator.startsWith(">")&&$.operator.startsWith("<"))return!0;if($2(this.semver,">",$.semver,J)&&this.operator.startsWith("<")&&$.operator.startsWith(">"))return!0;return!1}}Z4.exports=D1;var J4=B1(),{safeRe:U4,t:H4}=n0(),$2=$4(),J2=e0(),Q4=O0(),W4=U2()});var U2=_((FQ,X4)=>{var HU=/\s+/g;class p0{constructor($,J){if(J=WU(J),$ instanceof p0)if($.loose===!!J.loose&&$.includePrerelease===!!J.includePrerelease)return $;else return new p0($.raw,J);if($ instanceof H2)return this.raw=$.value,this.set=[[$]],this.formatted=void 0,this;if(this.options=J,this.loose=!!J.loose,this.includePrerelease=!!J.includePrerelease,this.raw=$.trim().replace(HU," "),this.set=this.raw.split("||").map((U)=>this.parseRange(U.trim())).filter((U)=>U.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let U=this.set[0];if(this.set=this.set.filter((H)=>!q4(H[0])),this.set.length===0)this.set=[U];else if(this.set.length>1){for(let H of this.set)if(H.length===1&&GU(H[0])){this.set=[H];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let $=0;$<this.set.length;$++){if($>0)this.formatted+="||";let J=this.set[$];for(let U=0;U<J.length;U++){if(U>0)this.formatted+=" ";this.formatted+=J[U].toString().trim()}}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange($){let U=((this.options.includePrerelease&&KU)|(this.options.loose&&XU))+":"+$,H=Y4.get(U);if(H)return H;let Q=this.options.loose,W=Q?p[s.HYPHENRANGELOOSE]:p[s.HYPHENRANGE];$=$.replace(W,zU(this.options.includePrerelease)),c("hyphen replace",$),$=$.replace(p[s.COMPARATORTRIM],NU),c("comparator trim",$),$=$.replace(p[s.TILDETRIM],YU),c("tilde trim",$),$=$.replace(p[s.CARETTRIM],qU),c("caret trim",$);let Z=$.split(" ").map((A)=>IU(A,this.options)).join(" ").split(/\s+/).map((A)=>TU(A,this.options));if(Q)Z=Z.filter((A)=>{return c("loose invalid filter",A,this.options),!!A.match(p[s.COMPARATORLOOSE])});c("range list",Z);let Y=new Map,N=Z.map((A)=>new H2(A,this.options));for(let A of N){if(q4(A))return[A];Y.set(A.value,A)}if(Y.size>1&&Y.has(""))Y.delete("");let K=[...Y.values()];return Y4.set(U,K),K}intersects($,J){if(!($ instanceof p0))throw new TypeError("a Range is required");return this.set.some((U)=>{return K4(U,J)&&$.set.some((H)=>{return K4(H,J)&&U.every((Q)=>{return H.every((W)=>{return Q.intersects(W,J)})})})})}test($){if(!$)return!1;if(typeof $==="string")try{$=new ZU($,this.options)}catch(J){return!1}for(let J=0;J<this.set.length;J++)if(LU(this.set[J],$,this.options))return!0;return!1}}X4.exports=p0;var QU=m$(),Y4=new QU,WU=B1(),H2=N4(),c=e0(),ZU=O0(),{safeRe:p,t:s,comparatorTrimReplace:NU,tildeTrimReplace:YU,caretTrimReplace:qU}=n0(),{FLAG_INCLUDE_PRERELEASE:KU,FLAG_LOOSE:XU}=A1(),q4=($)=>$.value==="<0.0.0-0",GU=($)=>$.value==="",K4=($,J)=>{let U=!0,H=$.slice(),Q=H.pop();while(U&&H.length)U=H.every((W)=>{return Q.intersects(W,J)}),Q=H.pop();return U},IU=($,J)=>{return $=$.replace(p[s.BUILD],""),c("comp",$,J),$=AU($,J),c("caret",$),$=VU($,J),c("tildes",$),$=RU($,J),c("xrange",$),$=jU($,J),c("stars",$),$},i=($)=>!$||$.toLowerCase()==="x"||$==="*",VU=($,J)=>{return $.trim().split(/\s+/).map((U)=>PU(U,J)).join(" ")},PU=($,J)=>{let U=J.loose?p[s.TILDELOOSE]:p[s.TILDE];return $.replace(U,(H,Q,W,Z,Y)=>{c("tilde",$,H,Q,W,Z,Y);let N;if(i(Q))N="";else if(i(W))N=`>=${Q}.0.0 <${+Q+1}.0.0-0`;else if(i(Z))N=`>=${Q}.${W}.0 <${Q}.${+W+1}.0-0`;else if(Y)c("replaceTilde pr",Y),N=`>=${Q}.${W}.${Z}-${Y} <${Q}.${+W+1}.0-0`;else N=`>=${Q}.${W}.${Z} <${Q}.${+W+1}.0-0`;return c("tilde return",N),N})},AU=($,J)=>{return $.trim().split(/\s+/).map((U)=>BU(U,J)).join(" ")},BU=($,J)=>{c("caret",$,J);let U=J.loose?p[s.CARETLOOSE]:p[s.CARET],H=J.includePrerelease?"-0":"";return $.replace(U,(Q,W,Z,Y,N)=>{c("caret",$,Q,W,Z,Y,N);let K;if(i(W))K="";else if(i(Z))K=`>=${W}.0.0${H} <${+W+1}.0.0-0`;else if(i(Y))if(W==="0")K=`>=${W}.${Z}.0${H} <${W}.${+Z+1}.0-0`;else K=`>=${W}.${Z}.0${H} <${+W+1}.0.0-0`;else if(N)if(c("replaceCaret pr",N),W==="0")if(Z==="0")K=`>=${W}.${Z}.${Y}-${N} <${W}.${Z}.${+Y+1}-0`;else K=`>=${W}.${Z}.${Y}-${N} <${W}.${+Z+1}.0-0`;else K=`>=${W}.${Z}.${Y}-${N} <${+W+1}.0.0-0`;else if(c("no pr"),W==="0")if(Z==="0")K=`>=${W}.${Z}.${Y}${H} <${W}.${Z}.${+Y+1}-0`;else K=`>=${W}.${Z}.${Y}${H} <${W}.${+Z+1}.0-0`;else K=`>=${W}.${Z}.${Y} <${+W+1}.0.0-0`;return c("caret return",K),K})},RU=($,J)=>{return c("replaceXRanges",$,J),$.split(/\s+/).map((U)=>EU(U,J)).join(" ")},EU=($,J)=>{$=$.trim();let U=J.loose?p[s.XRANGELOOSE]:p[s.XRANGE];return $.replace(U,(H,Q,W,Z,Y,N)=>{c("xRange",$,H,Q,W,Z,Y,N);let K=i(W),A=K||i(Z),j=A||i(Y),D=j;if(Q==="="&&D)Q="";if(N=J.includePrerelease?"-0":"",K)if(Q===">"||Q==="<")H="<0.0.0-0";else H="*";else if(Q&&D){if(A)Z=0;if(Y=0,Q===">")if(Q=">=",A)W=+W+1,Z=0,Y=0;else Z=+Z+1,Y=0;else if(Q==="<=")if(Q="<",A)W=+W+1;else Z=+Z+1;if(Q==="<")N="-0";H=`${Q+W}.${Z}.${Y}${N}`}else if(A)H=`>=${W}.0.0${N} <${+W+1}.0.0-0`;else if(j)H=`>=${W}.${Z}.0${N} <${W}.${+Z+1}.0-0`;return c("xRange return",H),H})},jU=($,J)=>{return c("replaceStars",$,J),$.trim().replace(p[s.STAR],"")},TU=($,J)=>{return c("replaceGTE0",$,J),$.trim().replace(p[J.includePrerelease?s.GTE0PRE:s.GTE0],"")},zU=($)=>(J,U,H,Q,W,Z,Y,N,K,A,j,D)=>{if(i(H))U="";else if(i(Q))U=`>=${H}.0.0${$?"-0":""}`;else if(i(W))U=`>=${H}.${Q}.0${$?"-0":""}`;else if(Z)U=`>=${U}`;else U=`>=${U}${$?"-0":""}`;if(i(K))N="";else if(i(A))N=`<${+K+1}.0.0-0`;else if(i(j))N=`<${K}.${+A+1}.0-0`;else if(D)N=`<=${K}.${A}.${j}-${D}`;else if($)N=`<${K}.${A}.${+j+1}-0`;else N=`<=${N}`;return`${U} ${N}`.trim()},LU=($,J,U)=>{for(let H=0;H<$.length;H++)if(!$[H].test(J))return!1;if(J.prerelease.length&&!U.includePrerelease){for(let H=0;H<$.length;H++){if(c($[H].semver),$[H].semver===H2.ANY)continue;if($[H].semver.prerelease.length>0){let Q=$[H].semver;if(Q.major===J.major&&Q.minor===J.minor&&Q.patch===J.patch)return!0}}return!1}return!0}});var I4=_((MQ,G4)=>{var DU=U2(),wU=($,J,U)=>{try{J=new DU(J,U)}catch(H){return!1}return J.test($)};G4.exports=wU});var Q2=_((CQ,FU)=>{FU.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.34.5",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://sharp.pixelplumbing.com",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unneb\xE4ck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix B\xFCnemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","J\xE9r\xE9my Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kot\u011B\u0161ovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouci\xF1o <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugu\xE9 <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com>","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>","Dennis Beatty <dennis@dcbeatty.com>","Ingvar Stepanyan <me@rreverser.com>","Don Denton <don@happycollision.com>"],scripts:{build:"node install/build.js",install:"node install/check.js || npm run build",clean:"rm -rf src/build/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run lint && npm run test-unit",lint:"npm run lint-cpp && npm run lint-js && npm run lint-types","lint-cpp":"cpplint --quiet src/*.h src/*.cc","lint-js":"biome lint","lint-types":"tsd --files ./test/types/sharp.test-d.ts","test-leak":"./test/leak/leak.sh","test-unit":"node --experimental-test-coverage test/unit.mjs","package-from-local-build":"node npm/from-local-build.js","package-release-notes":"node npm/release-notes.js","docs-build":"node docs/build.mjs","docs-serve":"cd docs && npm start","docs-publish":"cd docs && npm run build && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},type:"commonjs",main:"lib/index.js",types:"lib/index.d.ts",files:["install","lib","src/*.{cc,h,gyp}"],repository:{type:"git",url:"git://github.com/lovell/sharp.git"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{"@img/colour":"^1.0.0","detect-libc":"^2.1.2",semver:"^7.7.3"},optionalDependencies:{"@img/sharp-darwin-arm64":"0.34.5","@img/sharp-darwin-x64":"0.34.5","@img/sharp-libvips-darwin-arm64":"1.2.4","@img/sharp-libvips-darwin-x64":"1.2.4","@img/sharp-libvips-linux-arm":"1.2.4","@img/sharp-libvips-linux-arm64":"1.2.4","@img/sharp-libvips-linux-ppc64":"1.2.4","@img/sharp-libvips-linux-riscv64":"1.2.4","@img/sharp-libvips-linux-s390x":"1.2.4","@img/sharp-libvips-linux-x64":"1.2.4","@img/sharp-libvips-linuxmusl-arm64":"1.2.4","@img/sharp-libvips-linuxmusl-x64":"1.2.4","@img/sharp-linux-arm":"0.34.5","@img/sharp-linux-arm64":"0.34.5","@img/sharp-linux-ppc64":"0.34.5","@img/sharp-linux-riscv64":"0.34.5","@img/sharp-linux-s390x":"0.34.5","@img/sharp-linux-x64":"0.34.5","@img/sharp-linuxmusl-arm64":"0.34.5","@img/sharp-linuxmusl-x64":"0.34.5","@img/sharp-wasm32":"0.34.5","@img/sharp-win32-arm64":"0.34.5","@img/sharp-win32-ia32":"0.34.5","@img/sharp-win32-x64":"0.34.5"},devDependencies:{"@biomejs/biome":"^2.3.4","@cpplint/cli":"^0.1.0","@emnapi/runtime":"^1.7.0","@img/sharp-libvips-dev":"1.2.4","@img/sharp-libvips-dev-wasm32":"1.2.4","@img/sharp-libvips-win32-arm64":"1.2.4","@img/sharp-libvips-win32-ia32":"1.2.4","@img/sharp-libvips-win32-x64":"1.2.4","@types/node":"*",emnapi:"^1.7.0","exif-reader":"^2.0.2","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^9.1.3","node-addon-api":"^8.5.0","node-gyp":"^11.5.0","tar-fs":"^3.1.1",tsd:"^0.33.0"},license:"Apache-2.0",engines:{node:"^18.17.0 || ^20.3.0 || >=21.0.0"},config:{libvips:">=8.17.3"},funding:{url:"https://opencollective.com/libvips"}}});var Z2=_((_Q,L4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var{spawnSync:w1}=O("child_process"),{createHash:MU}=O("crypto"),B4=h$(),CU=o1(),_U=I4(),V4=P1(),{config:SU,engines:P4,optionalDependencies:yU}=Q2(),xU=process.env.npm_package_config_libvips||SU.libvips,R4=B4(xU).version,vU=["darwin-arm64","darwin-x64","linux-arm","linux-arm64","linux-ppc64","linux-riscv64","linux-s390x","linux-x64","linuxmusl-arm64","linuxmusl-x64","win32-arm64","win32-ia32","win32-x64"],F1={encoding:"utf8",shell:!0},OU=($)=>{if($ instanceof Error)console.error(`sharp: Installation error: ${$.message}`);else console.log(`sharp: ${$}`)},E4=()=>V4.isNonGlibcLinuxSync()?V4.familySync():"",kU=()=>`${process.platform}${E4()}-${process.arch}`,k0=()=>{if(j4())return"wasm32";let{npm_config_arch:$,npm_config_platform:J,npm_config_libc:U}=process.env,H=typeof U==="string"?U:E4();return`${J||process.platform}${H}-${$||process.arch}`},hU=()=>{try{return O(`@img/sharp-libvips-dev-${k0()}/include`)}catch{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/include");})()}catch{}}return""},fU=()=>{try{return (()=>{throw new Error("Cannot require module "+"@img/sharp-libvips-dev/cplusplus");})()}catch{}return""},bU=()=>{try{return O(`@img/sharp-libvips-dev-${k0()}/lib`)}catch{try{return O(`@img/sharp-libvips-${k0()}/lib`)}catch{}}return""},gU=()=>{if(process.release?.name==="node"&&process.versions){if(!_U(process.versions.node,P4.node))return{found:process.versions.node,expected:P4.node}}},j4=()=>{let{CC:$}=process.env;return Boolean($?.endsWith("/emcc"))},dU=()=>{if(process.platform==="darwin"&&process.arch==="x64")return(w1("sysctl sysctl.proc_translated",F1).stdout||"").trim()==="sysctl.proc_translated: 1";return!1},A4=($)=>MU("sha512").update($).digest("hex"),uU=()=>{try{let $=A4(`imgsharp-libvips-${k0()}`),J=B4(yU[`@img/sharp-libvips-${k0()}`],{includePrerelease:!0}).version;return A4(`${$}npm:${J}`).slice(0,10)}catch{}return""},mU=()=>w1(`node-gyp rebuild --directory=src ${j4()?"--nodedir=emscripten":""}`,{...F1,stdio:"inherit"}).status,T4=()=>{if(process.platform!=="win32")return(w1("pkg-config --modversion vips-cpp",{...F1,env:{...process.env,PKG_CONFIG_PATH:z4()}}).stdout||"").trim();else return""},z4=()=>{if(process.platform!=="win32")return[(w1('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',F1).stdout||"").trim(),process.env.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":");else return""},W2=($,J,U)=>{if(U)U(`Detected ${J}, skipping search for globally-installed libvips`);return $},lU=($)=>{if(Boolean(process.env.SHARP_IGNORE_GLOBAL_LIBVIPS)===!0)return W2(!1,"SHARP_IGNORE_GLOBAL_LIBVIPS",$);if(Boolean(process.env.SHARP_FORCE_GLOBAL_LIBVIPS)===!0)return W2(!0,"SHARP_FORCE_GLOBAL_LIBVIPS",$);if(dU())return W2(!1,"Rosetta",$);let J=T4();return!!J&&CU(J,R4)};L4.exports={minimumLibvipsVersion:R4,prebuiltPlatforms:vU,buildPlatformArch:k0,buildSharpLibvipsIncludeDir:hU,buildSharpLibvipsCPlusPlusDir:fU,buildSharpLibvipsLibDir:bU,isUnsupportedNodeRuntime:gU,runtimePlatformArch:kU,log:OU,yarnLocator:uU,spawnRebuild:mU,globalLibvipsVersion:T4,pkgConfigPath:z4,useGlobalLibvips:lU}});var t0=_((yQ,w4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var{familySync:cU,versionSync:rU}=P1(),{runtimePlatformArch:aU,isUnsupportedNodeRuntime:D4,prebuiltPlatforms:eU,minimumLibvipsVersion:nU}=Z2(),C0=aU(),sU=[`../src/build/Release/sharp-${C0}.node`,"../src/build/Release/sharp-wasm32.node",`@img/sharp-${C0}/sharp.node`,"@img/sharp-wasm32/sharp.node"],N2,h0,i0=[];for(N2 of sU)try{h0=O(N2);break}catch($){i0.push($)}if(h0&&N2.startsWith("@img/sharp-linux-x64")&&!h0._isUsingX64V2()){let $=new Error("Prebuilt binaries for linux-x64 require v2 microarchitecture");$.code="Unsupported CPU",i0.push($),h0=null}if(h0)w4.exports=h0;else{let[$,J,U]=["linux","darwin","win32"].map((W)=>C0.startsWith(W)),H=[`Could not load the "sharp" module using the ${C0} runtime`];i0.forEach((W)=>{if(W.code!=="MODULE_NOT_FOUND")H.push(`${W.code}: ${W.message}`)});let Q=i0.map((W)=>W.message).join(" ");if(H.push("Possible solutions:"),D4()){let{found:W,expected:Z}=D4();H.push("- Please upgrade Node.js:",`    Found ${W}`,`    Requires ${Z}`)}else if(eU.includes(C0)){let[W,Z]=C0.split("-"),Y=W.endsWith("musl")?" --libc=musl":"";H.push("- Ensure optional dependencies can be installed:","    npm install --include=optional sharp","- Ensure your package manager supports multi-platform installation:","    See https://sharp.pixelplumbing.com/install#cross-platform","- Add platform-specific dependencies:",`    npm install --os=${W.replace("musl","")}${Y} --cpu=${Z} sharp`)}else H.push(`- Manually install libvips >= ${nU}`,"- Add experimental WebAssembly-based dependencies:","    npm install --cpu=wasm32 sharp","    npm install @img/sharp-wasm32");if($&&/(symbol not found|CXXABI_)/i.test(Q))try{let{config:W}=O(`@img/sharp-libvips-${C0}/package`),Z=`${cU()} ${rU()}`,Y=`${W.musl?"musl":"glibc"} ${W.musl||W.glibc}`;H.push("- Update your OS:",`    Found ${Z}`,`    Requires ${Y}`)}catch(W){}if($&&/\/snap\/core[0-9]{2}/.test(Q))H.push("- Remove the Node.js Snap, which does not support native modules","    snap remove node");if(J&&/Incompatible library version/.test(Q))H.push("- Update Homebrew:","    brew update && brew upgrade vips");if(i0.some((W)=>W.code==="ERR_DLOPEN_DISABLED"))H.push("- Run Node.js without using the --no-addons flag");if(U&&/The specified procedure could not be found/.test(Q))H.push("- Using the canvas package on Windows?","    See https://sharp.pixelplumbing.com/install#canvas-and-windows","- Check for outdated versions of sharp in the dependency tree:","    npm ls sharp");throw H.push("- Consult the installation documentation:","    See https://sharp.pixelplumbing.com/install"),new Error(H.join(`
`))}});var M4=_((vQ,F4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var pU=O("util"),Y2=O("stream"),iU=H0();t0();var tU=pU.debuglog("sharp"),oU=($)=>{_0.queue.emit("change",$)},_0=function($,J){if(arguments.length===1&&!iU.defined($))throw new Error("Invalid input");if(!(this instanceof _0))return new _0($,J);return Y2.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBefore:!1,orientBefore:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tint:[-1,0,0,0],flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,precision:"integer",minAmpl:0.2,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:-1,trimLineArt:!1,dilateWidth:0,erodeWidth:0,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspacePipeline:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,keepMetadata:0,withMetadataOrientation:-1,withMetadataDensity:0,withIccProfile:"",withExif:{},withExifMerge:!0,withXmp:"",resolveWithObject:!1,loop:-1,delay:[],jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpSmartDeblock:!1,webpPreset:"default",webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifKeepDuplicateFrames:!1,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffBigtiff:!1,tiffPredictor:"horizontal",tiffPyramid:!1,tiffMiniswhite:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",heifBitdepth:8,jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],pdfBackground:[255,255,255,255],debuglog:(U)=>{this.emit("warning",U),tU(U)},queueListener:oU},this.options.input=this._createInputDescriptor($,J,{allowStream:!0}),this};Object.setPrototypeOf(_0.prototype,Y2.Duplex.prototype);Object.setPrototypeOf(_0,Y2.Duplex);function $8(){let $=this.constructor.call(),{debuglog:J,queueListener:U,...H}=this.options;if($.options=structuredClone(H),$.options.debuglog=J,$.options.queueListener=U,this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),$.options.input.buffer=this.options.input.buffer,$.emit("finish")});return $}Object.assign(_0.prototype,{clone:$8});F4.exports=_0});var S4=_((OQ,_4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var X=H0(),A0=t0(),J8={left:"low",top:"low",low:"low",center:"centre",centre:"centre",right:"high",bottom:"high",high:"high"},U8=["failOn","limitInputPixels","unlimited","animated","autoOrient","density","ignoreIcc","page","pages","sequentialRead","jp2","openSlide","pdf","raw","svg","tiff","failOnError","openSlideLevel","pdfBackground","tiffSubifd"];function C4($){let J=U8.filter((U)=>X.defined($[U])).map((U)=>[U,$[U]]);return J.length?Object.fromEntries(J):void 0}function H8($,J,U){let H={autoOrient:!1,failOn:"warning",limitInputPixels:268402689,ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(X.string($))H.file=$;else if(X.buffer($)){if($.length===0)throw Error("Input Buffer is empty");H.buffer=$}else if(X.arrayBuffer($)){if($.byteLength===0)throw Error("Input bit Array is empty");H.buffer=Buffer.from($,0,$.byteLength)}else if(X.typedArray($)){if($.length===0)throw Error("Input Bit Array is empty");H.buffer=Buffer.from($.buffer,$.byteOffset,$.byteLength)}else if(X.plainObject($)&&!X.defined(J)){if(J=$,C4(J))H.buffer=[]}else if(!X.defined($)&&!X.defined(J)&&X.object(U)&&U.allowStream)H.buffer=[];else if(Array.isArray($))if($.length>1)if(!this.options.joining)this.options.joining=!0,this.options.join=$.map((Q)=>this._createInputDescriptor(Q));else throw new Error("Recursive join is unsupported");else throw new Error("Expected at least two images to join");else throw new Error(`Unsupported input '${$}' of type ${typeof $}${X.defined(J)?` when also providing options of type ${typeof J}`:""}`);if(X.object(J)){if(X.defined(J.failOnError))if(X.bool(J.failOnError))H.failOn=J.failOnError?"warning":"none";else throw X.invalidParameterError("failOnError","boolean",J.failOnError);if(X.defined(J.failOn))if(X.string(J.failOn)&&X.inArray(J.failOn,["none","truncated","error","warning"]))H.failOn=J.failOn;else throw X.invalidParameterError("failOn","one of: none, truncated, error, warning",J.failOn);if(X.defined(J.autoOrient))if(X.bool(J.autoOrient))H.autoOrient=J.autoOrient;else throw X.invalidParameterError("autoOrient","boolean",J.autoOrient);if(X.defined(J.density))if(X.inRange(J.density,1,1e5))H.density=J.density;else throw X.invalidParameterError("density","number between 1 and 100000",J.density);if(X.defined(J.ignoreIcc))if(X.bool(J.ignoreIcc))H.ignoreIcc=J.ignoreIcc;else throw X.invalidParameterError("ignoreIcc","boolean",J.ignoreIcc);if(X.defined(J.limitInputPixels))if(X.bool(J.limitInputPixels))H.limitInputPixels=J.limitInputPixels?268402689:0;else if(X.integer(J.limitInputPixels)&&X.inRange(J.limitInputPixels,0,Number.MAX_SAFE_INTEGER))H.limitInputPixels=J.limitInputPixels;else throw X.invalidParameterError("limitInputPixels","positive integer",J.limitInputPixels);if(X.defined(J.unlimited))if(X.bool(J.unlimited))H.unlimited=J.unlimited;else throw X.invalidParameterError("unlimited","boolean",J.unlimited);if(X.defined(J.sequentialRead))if(X.bool(J.sequentialRead))H.sequentialRead=J.sequentialRead;else throw X.invalidParameterError("sequentialRead","boolean",J.sequentialRead);if(X.defined(J.raw)){if(X.object(J.raw)&&X.integer(J.raw.width)&&J.raw.width>0&&X.integer(J.raw.height)&&J.raw.height>0&&X.integer(J.raw.channels)&&X.inRange(J.raw.channels,1,4))switch(H.rawWidth=J.raw.width,H.rawHeight=J.raw.height,H.rawChannels=J.raw.channels,$.constructor){case Uint8Array:case Uint8ClampedArray:H.rawDepth="uchar";break;case Int8Array:H.rawDepth="char";break;case Uint16Array:H.rawDepth="ushort";break;case Int16Array:H.rawDepth="short";break;case Uint32Array:H.rawDepth="uint";break;case Int32Array:H.rawDepth="int";break;case Float32Array:H.rawDepth="float";break;case Float64Array:H.rawDepth="double";break;default:H.rawDepth="uchar";break}else throw new Error("Expected width, height and channels for raw pixel input");if(H.rawPremultiplied=!1,X.defined(J.raw.premultiplied))if(X.bool(J.raw.premultiplied))H.rawPremultiplied=J.raw.premultiplied;else throw X.invalidParameterError("raw.premultiplied","boolean",J.raw.premultiplied);if(H.rawPageHeight=0,X.defined(J.raw.pageHeight))if(X.integer(J.raw.pageHeight)&&J.raw.pageHeight>0&&J.raw.pageHeight<=J.raw.height){if(J.raw.height%J.raw.pageHeight!==0)throw new Error(`Expected raw.height ${J.raw.height} to be a multiple of raw.pageHeight ${J.raw.pageHeight}`);H.rawPageHeight=J.raw.pageHeight}else throw X.invalidParameterError("raw.pageHeight","positive integer",J.raw.pageHeight)}if(X.defined(J.animated))if(X.bool(J.animated))H.pages=J.animated?-1:1;else throw X.invalidParameterError("animated","boolean",J.animated);if(X.defined(J.pages))if(X.integer(J.pages)&&X.inRange(J.pages,-1,1e5))H.pages=J.pages;else throw X.invalidParameterError("pages","integer between -1 and 100000",J.pages);if(X.defined(J.page))if(X.integer(J.page)&&X.inRange(J.page,0,1e5))H.page=J.page;else throw X.invalidParameterError("page","integer between 0 and 100000",J.page);if(X.object(J.openSlide)&&X.defined(J.openSlide.level))if(X.integer(J.openSlide.level)&&X.inRange(J.openSlide.level,0,256))H.openSlideLevel=J.openSlide.level;else throw X.invalidParameterError("openSlide.level","integer between 0 and 256",J.openSlide.level);else if(X.defined(J.level))if(X.integer(J.level)&&X.inRange(J.level,0,256))H.openSlideLevel=J.level;else throw X.invalidParameterError("level","integer between 0 and 256",J.level);if(X.object(J.tiff)&&X.defined(J.tiff.subifd))if(X.integer(J.tiff.subifd)&&X.inRange(J.tiff.subifd,-1,1e5))H.tiffSubifd=J.tiff.subifd;else throw X.invalidParameterError("tiff.subifd","integer between -1 and 100000",J.tiff.subifd);else if(X.defined(J.subifd))if(X.integer(J.subifd)&&X.inRange(J.subifd,-1,1e5))H.tiffSubifd=J.subifd;else throw X.invalidParameterError("subifd","integer between -1 and 100000",J.subifd);if(X.object(J.svg)){if(X.defined(J.svg.stylesheet))if(X.string(J.svg.stylesheet))H.svgStylesheet=J.svg.stylesheet;else throw X.invalidParameterError("svg.stylesheet","string",J.svg.stylesheet);if(X.defined(J.svg.highBitdepth))if(X.bool(J.svg.highBitdepth))H.svgHighBitdepth=J.svg.highBitdepth;else throw X.invalidParameterError("svg.highBitdepth","boolean",J.svg.highBitdepth)}if(X.object(J.pdf)&&X.defined(J.pdf.background))H.pdfBackground=this._getBackgroundColourOption(J.pdf.background);else if(X.defined(J.pdfBackground))H.pdfBackground=this._getBackgroundColourOption(J.pdfBackground);if(X.object(J.jp2)&&X.defined(J.jp2.oneshot))if(X.bool(J.jp2.oneshot))H.jp2Oneshot=J.jp2.oneshot;else throw X.invalidParameterError("jp2.oneshot","boolean",J.jp2.oneshot);if(X.defined(J.create))if(X.object(J.create)&&X.integer(J.create.width)&&J.create.width>0&&X.integer(J.create.height)&&J.create.height>0&&X.integer(J.create.channels)){if(H.createWidth=J.create.width,H.createHeight=J.create.height,H.createChannels=J.create.channels,H.createPageHeight=0,X.defined(J.create.pageHeight))if(X.integer(J.create.pageHeight)&&J.create.pageHeight>0&&J.create.pageHeight<=J.create.height){if(J.create.height%J.create.pageHeight!==0)throw new Error(`Expected create.height ${J.create.height} to be a multiple of create.pageHeight ${J.create.pageHeight}`);H.createPageHeight=J.create.pageHeight}else throw X.invalidParameterError("create.pageHeight","positive integer",J.create.pageHeight);if(X.defined(J.create.noise)){if(!X.object(J.create.noise))throw new Error("Expected noise to be an object");if(J.create.noise.type!=="gaussian")throw new Error("Only gaussian noise is supported at the moment");if(H.createNoiseType=J.create.noise.type,!X.inRange(J.create.channels,1,4))throw X.invalidParameterError("create.channels","number between 1 and 4",J.create.channels);if(H.createNoiseMean=128,X.defined(J.create.noise.mean))if(X.number(J.create.noise.mean)&&X.inRange(J.create.noise.mean,0,1e4))H.createNoiseMean=J.create.noise.mean;else throw X.invalidParameterError("create.noise.mean","number between 0 and 10000",J.create.noise.mean);if(H.createNoiseSigma=30,X.defined(J.create.noise.sigma))if(X.number(J.create.noise.sigma)&&X.inRange(J.create.noise.sigma,0,1e4))H.createNoiseSigma=J.create.noise.sigma;else throw X.invalidParameterError("create.noise.sigma","number between 0 and 10000",J.create.noise.sigma)}else if(X.defined(J.create.background)){if(!X.inRange(J.create.channels,3,4))throw X.invalidParameterError("create.channels","number between 3 and 4",J.create.channels);H.createBackground=this._getBackgroundColourOption(J.create.background)}else throw new Error("Expected valid noise or background to create a new input image");delete H.buffer}else throw new Error("Expected valid width, height and channels to create a new input image");if(X.defined(J.text))if(X.object(J.text)&&X.string(J.text.text)){if(H.textValue=J.text.text,X.defined(J.text.height)&&X.defined(J.text.dpi))throw new Error("Expected only one of dpi or height");if(X.defined(J.text.font))if(X.string(J.text.font))H.textFont=J.text.font;else throw X.invalidParameterError("text.font","string",J.text.font);if(X.defined(J.text.fontfile))if(X.string(J.text.fontfile))H.textFontfile=J.text.fontfile;else throw X.invalidParameterError("text.fontfile","string",J.text.fontfile);if(X.defined(J.text.width))if(X.integer(J.text.width)&&J.text.width>0)H.textWidth=J.text.width;else throw X.invalidParameterError("text.width","positive integer",J.text.width);if(X.defined(J.text.height))if(X.integer(J.text.height)&&J.text.height>0)H.textHeight=J.text.height;else throw X.invalidParameterError("text.height","positive integer",J.text.height);if(X.defined(J.text.align))if(X.string(J.text.align)&&X.string(this.constructor.align[J.text.align]))H.textAlign=this.constructor.align[J.text.align];else throw X.invalidParameterError("text.align","valid alignment",J.text.align);if(X.defined(J.text.justify))if(X.bool(J.text.justify))H.textJustify=J.text.justify;else throw X.invalidParameterError("text.justify","boolean",J.text.justify);if(X.defined(J.text.dpi))if(X.integer(J.text.dpi)&&X.inRange(J.text.dpi,1,1e6))H.textDpi=J.text.dpi;else throw X.invalidParameterError("text.dpi","integer between 1 and 1000000",J.text.dpi);if(X.defined(J.text.rgba))if(X.bool(J.text.rgba))H.textRgba=J.text.rgba;else throw X.invalidParameterError("text.rgba","bool",J.text.rgba);if(X.defined(J.text.spacing))if(X.integer(J.text.spacing)&&X.inRange(J.text.spacing,-1e6,1e6))H.textSpacing=J.text.spacing;else throw X.invalidParameterError("text.spacing","integer between -1000000 and 1000000",J.text.spacing);if(X.defined(J.text.wrap))if(X.string(J.text.wrap)&&X.inArray(J.text.wrap,["word","char","word-char","none"]))H.textWrap=J.text.wrap;else throw X.invalidParameterError("text.wrap","one of: word, char, word-char, none",J.text.wrap);delete H.buffer}else throw new Error("Expected a valid string to create an image with text.");if(X.defined(J.join))if(X.defined(this.options.join)){if(X.defined(J.join.animated))if(X.bool(J.join.animated))H.joinAnimated=J.join.animated;else throw X.invalidParameterError("join.animated","boolean",J.join.animated);if(X.defined(J.join.across))if(X.integer(J.join.across)&&X.inRange(J.join.across,1,1e6))H.joinAcross=J.join.across;else throw X.invalidParameterError("join.across","integer between 1 and 100000",J.join.across);if(X.defined(J.join.shim))if(X.integer(J.join.shim)&&X.inRange(J.join.shim,0,1e6))H.joinShim=J.join.shim;else throw X.invalidParameterError("join.shim","integer between 0 and 100000",J.join.shim);if(X.defined(J.join.background))H.joinBackground=this._getBackgroundColourOption(J.join.background);if(X.defined(J.join.halign))if(X.string(J.join.halign)&&X.string(this.constructor.align[J.join.halign]))H.joinHalign=this.constructor.align[J.join.halign];else throw X.invalidParameterError("join.halign","valid alignment",J.join.halign);if(X.defined(J.join.valign))if(X.string(J.join.valign)&&X.string(this.constructor.align[J.join.valign]))H.joinValign=this.constructor.align[J.join.valign];else throw X.invalidParameterError("join.valign","valid alignment",J.join.valign)}else throw new Error("Expected input to be an array of images to join")}else if(X.defined(J))throw new Error(`Invalid input options ${J}`);return H}function Q8($,J,U){if(Array.isArray(this.options.input.buffer))if(X.buffer($)){if(this.options.input.buffer.length===0)this.on("finish",()=>{this.streamInFinished=!0});this.options.input.buffer.push($),U()}else U(new Error("Non-Buffer data on Writable Stream"));else U(new Error("Unexpected data on Writable Stream"))}function W8(){if(this._isStreamInput())this.options.input.buffer=Buffer.concat(this.options.input.buffer)}function Z8(){return Array.isArray(this.options.input.buffer)}function N8($){let J=Error();if(X.fn($)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),A0.metadata(this.options,(U,H)=>{if(U)$(X.nativeError(U,J));else $(null,H)})});else A0.metadata(this.options,(U,H)=>{if(U)$(X.nativeError(U,J));else $(null,H)});return this}else if(this._isStreamInput())return new Promise((U,H)=>{let Q=()=>{this._flattenBufferIn(),A0.metadata(this.options,(W,Z)=>{if(W)H(X.nativeError(W,J));else U(Z)})};if(this.writableFinished)Q();else this.once("finish",Q)});else return new Promise((U,H)=>{A0.metadata(this.options,(Q,W)=>{if(Q)H(X.nativeError(Q,J));else U(W)})})}function Y8($){let J=Error();if(X.fn($)){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),A0.stats(this.options,(U,H)=>{if(U)$(X.nativeError(U,J));else $(null,H)})});else A0.stats(this.options,(U,H)=>{if(U)$(X.nativeError(U,J));else $(null,H)});return this}else if(this._isStreamInput())return new Promise((U,H)=>{this.on("finish",function(){this._flattenBufferIn(),A0.stats(this.options,(Q,W)=>{if(Q)H(X.nativeError(Q,J));else U(W)})})});else return new Promise((U,H)=>{A0.stats(this.options,(Q,W)=>{if(Q)H(X.nativeError(Q,J));else U(W)})})}_4.exports=($)=>{Object.assign($.prototype,{_inputOptionsFromObject:C4,_createInputDescriptor:H8,_write:Q8,_flattenBufferIn:W8,_isStreamInput:Z8,metadata:N8,stats:Y8}),$.align=J8}});var h4=_((kQ,k4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var S=H0(),x4={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},v4={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},y4={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},O4={entropy:16,attention:17},q2={nearest:"nearest",linear:"linear",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3",mks2013:"mks2013",mks2021:"mks2021"},q8={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},K8={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function K2($){return $.angle%360!==0||$.rotationAngle!==0}function M1($){return $.width!==-1||$.height!==-1}function X8($,J,U){if(M1(this.options))this.options.debuglog("ignoring previous resize options");if(this.options.widthPost!==-1)this.options.debuglog("operation order will be: extract, resize, extract");if(S.defined($))if(S.object($)&&!S.defined(U))U=$;else if(S.integer($)&&$>0)this.options.width=$;else throw S.invalidParameterError("width","positive integer",$);else this.options.width=-1;if(S.defined(J))if(S.integer(J)&&J>0)this.options.height=J;else throw S.invalidParameterError("height","positive integer",J);else this.options.height=-1;if(S.object(U)){if(S.defined(U.width))if(S.integer(U.width)&&U.width>0)this.options.width=U.width;else throw S.invalidParameterError("width","positive integer",U.width);if(S.defined(U.height))if(S.integer(U.height)&&U.height>0)this.options.height=U.height;else throw S.invalidParameterError("height","positive integer",U.height);if(S.defined(U.fit)){let H=K8[U.fit];if(S.string(H))this.options.canvas=H;else throw S.invalidParameterError("fit","valid fit",U.fit)}if(S.defined(U.position)){let H=S.integer(U.position)?U.position:O4[U.position]||v4[U.position]||x4[U.position];if(S.integer(H)&&(S.inRange(H,0,8)||S.inRange(H,16,17)))this.options.position=H;else throw S.invalidParameterError("position","valid position/gravity/strategy",U.position)}if(this._setBackgroundColourOption("resizeBackground",U.background),S.defined(U.kernel))if(S.string(q2[U.kernel]))this.options.kernel=q2[U.kernel];else throw S.invalidParameterError("kernel","valid kernel name",U.kernel);if(S.defined(U.withoutEnlargement))this._setBooleanOption("withoutEnlargement",U.withoutEnlargement);if(S.defined(U.withoutReduction))this._setBooleanOption("withoutReduction",U.withoutReduction);if(S.defined(U.fastShrinkOnLoad))this._setBooleanOption("fastShrinkOnLoad",U.fastShrinkOnLoad)}if(K2(this.options)&&M1(this.options))this.options.rotateBefore=!0;return this}function G8($){if(S.integer($)&&$>0)this.options.extendTop=$,this.options.extendBottom=$,this.options.extendLeft=$,this.options.extendRight=$;else if(S.object($)){if(S.defined($.top))if(S.integer($.top)&&$.top>=0)this.options.extendTop=$.top;else throw S.invalidParameterError("top","positive integer",$.top);if(S.defined($.bottom))if(S.integer($.bottom)&&$.bottom>=0)this.options.extendBottom=$.bottom;else throw S.invalidParameterError("bottom","positive integer",$.bottom);if(S.defined($.left))if(S.integer($.left)&&$.left>=0)this.options.extendLeft=$.left;else throw S.invalidParameterError("left","positive integer",$.left);if(S.defined($.right))if(S.integer($.right)&&$.right>=0)this.options.extendRight=$.right;else throw S.invalidParameterError("right","positive integer",$.right);if(this._setBackgroundColourOption("extendBackground",$.background),S.defined($.extendWith))if(S.string(y4[$.extendWith]))this.options.extendWith=y4[$.extendWith];else throw S.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",$.extendWith)}else throw S.invalidParameterError("extend","integer or object",$);return this}function I8($){let J=M1(this.options)||this.options.widthPre!==-1?"Post":"Pre";if(this.options[`width${J}`]!==-1)this.options.debuglog("ignoring previous extract options");if(["left","top","width","height"].forEach(function(U){let H=$[U];if(S.integer(H)&&H>=0)this.options[U+(U==="left"||U==="top"?"Offset":"")+J]=H;else throw S.invalidParameterError(U,"integer",H)},this),K2(this.options)&&!M1(this.options)){if(this.options.widthPre===-1||this.options.widthPost===-1)this.options.rotateBefore=!0}if(this.options.input.autoOrient)this.options.orientBefore=!0;return this}function V8($){if(this.options.trimThreshold=10,S.defined($))if(S.object($)){if(S.defined($.background))this._setBackgroundColourOption("trimBackground",$.background);if(S.defined($.threshold))if(S.number($.threshold)&&$.threshold>=0)this.options.trimThreshold=$.threshold;else throw S.invalidParameterError("threshold","positive number",$.threshold);if(S.defined($.lineArt))this._setBooleanOption("trimLineArt",$.lineArt)}else throw S.invalidParameterError("trim","object",$);if(K2(this.options))this.options.rotateBefore=!0;return this}k4.exports=($)=>{Object.assign($.prototype,{resize:X8,extend:G8,extract:I8,trim:V8}),$.gravity=x4,$.strategy=O4,$.kernel=q2,$.fit=q8,$.position=v4}});var b4=_((hQ,f4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var u=H0(),X2={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function P8($){if(!Array.isArray($))throw u.invalidParameterError("images to composite","array",$);return this.options.composite=$.map((J)=>{if(!u.object(J))throw u.invalidParameterError("image to composite","object",J);let U=this._inputOptionsFromObject(J),H={input:this._createInputDescriptor(J.input,U,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(u.defined(J.blend))if(u.string(X2[J.blend]))H.blend=X2[J.blend];else throw u.invalidParameterError("blend","valid blend name",J.blend);if(u.defined(J.tile))if(u.bool(J.tile))H.tile=J.tile;else throw u.invalidParameterError("tile","boolean",J.tile);if(u.defined(J.left))if(u.integer(J.left))H.left=J.left;else throw u.invalidParameterError("left","integer",J.left);if(u.defined(J.top))if(u.integer(J.top))H.top=J.top;else throw u.invalidParameterError("top","integer",J.top);if(u.defined(J.top)!==u.defined(J.left))throw new Error("Expected both left and top to be set");else H.hasOffset=u.integer(J.top)&&u.integer(J.left);if(u.defined(J.gravity))if(u.integer(J.gravity)&&u.inRange(J.gravity,0,8))H.gravity=J.gravity;else if(u.string(J.gravity)&&u.integer(this.constructor.gravity[J.gravity]))H.gravity=this.constructor.gravity[J.gravity];else throw u.invalidParameterError("gravity","valid gravity",J.gravity);if(u.defined(J.premultiplied))if(u.bool(J.premultiplied))H.premultiplied=J.premultiplied;else throw u.invalidParameterError("premultiplied","boolean",J.premultiplied);return H}),this}f4.exports=($)=>{$.prototype.composite=P8,$.blend=X2}});var l4=_((fQ,m4)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var I=H0(),g4={integer:"integer",float:"float",approximate:"approximate"};function A8($,J){if(!I.defined($))return this.autoOrient();if(this.options.angle||this.options.rotationAngle)this.options.debuglog("ignoring previous rotate options"),this.options.angle=0,this.options.rotationAngle=0;if(I.integer($)&&!($%90))this.options.angle=$;else if(I.number($)){if(this.options.rotationAngle=$,I.object(J)&&J.background)this._setBackgroundColourOption("rotationBackground",J.background)}else throw I.invalidParameterError("angle","numeric",$);return this}function B8(){return this.options.input.autoOrient=!0,this}function R8($){return this.options.flip=I.bool($)?$:!0,this}function E8($){return this.options.flop=I.bool($)?$:!0,this}function j8($,J){let U=[].concat(...$);if(U.length===4&&U.every(I.number))this.options.affineMatrix=U;else throw I.invalidParameterError("matrix","1x4 or 2x2 array",$);if(I.defined(J))if(I.object(J)){if(this._setBackgroundColourOption("affineBackground",J.background),I.defined(J.idx))if(I.number(J.idx))this.options.affineIdx=J.idx;else throw I.invalidParameterError("options.idx","number",J.idx);if(I.defined(J.idy))if(I.number(J.idy))this.options.affineIdy=J.idy;else throw I.invalidParameterError("options.idy","number",J.idy);if(I.defined(J.odx))if(I.number(J.odx))this.options.affineOdx=J.odx;else throw I.invalidParameterError("options.odx","number",J.odx);if(I.defined(J.ody))if(I.number(J.ody))this.options.affineOdy=J.ody;else throw I.invalidParameterError("options.ody","number",J.ody);if(I.defined(J.interpolator))if(I.inArray(J.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=J.interpolator;else throw I.invalidParameterError("options.interpolator","valid interpolator name",J.interpolator)}else throw I.invalidParameterError("options","object",J);return this}function T8($,J,U){if(!I.defined($))this.options.sharpenSigma=-1;else if(I.bool($))this.options.sharpenSigma=$?-1:0;else if(I.number($)&&I.inRange($,0.01,1e4)){if(this.options.sharpenSigma=$,I.defined(J))if(I.number(J)&&I.inRange(J,0,1e4))this.options.sharpenM1=J;else throw I.invalidParameterError("flat","number between 0 and 10000",J);if(I.defined(U))if(I.number(U)&&I.inRange(U,0,1e4))this.options.sharpenM2=U;else throw I.invalidParameterError("jagged","number between 0 and 10000",U)}else if(I.plainObject($)){if(I.number($.sigma)&&I.inRange($.sigma,0.000001,10))this.options.sharpenSigma=$.sigma;else throw I.invalidParameterError("options.sigma","number between 0.000001 and 10",$.sigma);if(I.defined($.m1))if(I.number($.m1)&&I.inRange($.m1,0,1e6))this.options.sharpenM1=$.m1;else throw I.invalidParameterError("options.m1","number between 0 and 1000000",$.m1);if(I.defined($.m2))if(I.number($.m2)&&I.inRange($.m2,0,1e6))this.options.sharpenM2=$.m2;else throw I.invalidParameterError("options.m2","number between 0 and 1000000",$.m2);if(I.defined($.x1))if(I.number($.x1)&&I.inRange($.x1,0,1e6))this.options.sharpenX1=$.x1;else throw I.invalidParameterError("options.x1","number between 0 and 1000000",$.x1);if(I.defined($.y2))if(I.number($.y2)&&I.inRange($.y2,0,1e6))this.options.sharpenY2=$.y2;else throw I.invalidParameterError("options.y2","number between 0 and 1000000",$.y2);if(I.defined($.y3))if(I.number($.y3)&&I.inRange($.y3,0,1e6))this.options.sharpenY3=$.y3;else throw I.invalidParameterError("options.y3","number between 0 and 1000000",$.y3)}else throw I.invalidParameterError("sigma","number between 0.01 and 10000",$);return this}function z8($){if(!I.defined($))this.options.medianSize=3;else if(I.integer($)&&I.inRange($,1,1000))this.options.medianSize=$;else throw I.invalidParameterError("size","integer between 1 and 1000",$);return this}function L8($){let J;if(I.number($))J=$;else if(I.plainObject($)){if(!I.number($.sigma))throw I.invalidParameterError("options.sigma","number between 0.3 and 1000",J);if(J=$.sigma,"precision"in $)if(I.string(g4[$.precision]))this.options.precision=g4[$.precision];else throw I.invalidParameterError("precision","one of: integer, float, approximate",$.precision);if("minAmplitude"in $)if(I.number($.minAmplitude)&&I.inRange($.minAmplitude,0.001,1))this.options.minAmpl=$.minAmplitude;else throw I.invalidParameterError("minAmplitude","number between 0.001 and 1",$.minAmplitude)}if(!I.defined($))this.options.blurSigma=-1;else if(I.bool($))this.options.blurSigma=$?-1:0;else if(I.number(J)&&I.inRange(J,0.3,1000))this.options.blurSigma=J;else throw I.invalidParameterError("sigma","number between 0.3 and 1000",J);return this}function d4($){if(!I.defined($))this.options.dilateWidth=1;else if(I.integer($)&&$>0)this.options.dilateWidth=$;else throw I.invalidParameterError("dilate","positive integer",d4);return this}function u4($){if(!I.defined($))this.options.erodeWidth=1;else if(I.integer($)&&$>0)this.options.erodeWidth=$;else throw I.invalidParameterError("erode","positive integer",u4);return this}function D8($){if(this.options.flatten=I.bool($)?$:!0,I.object($))this._setBackgroundColourOption("flattenBackground",$.background);return this}function w8(){return this.options.unflatten=!0,this}function F8($,J){if(!I.defined($))this.options.gamma=2.2;else if(I.number($)&&I.inRange($,1,3))this.options.gamma=$;else throw I.invalidParameterError("gamma","number between 1.0 and 3.0",$);if(!I.defined(J))this.options.gammaOut=this.options.gamma;else if(I.number(J)&&I.inRange(J,1,3))this.options.gammaOut=J;else throw I.invalidParameterError("gammaOut","number between 1.0 and 3.0",J);return this}function M8($){if(this.options.negate=I.bool($)?$:!0,I.plainObject($)&&"alpha"in $)if(!I.bool($.alpha))throw I.invalidParameterError("alpha","should be boolean value",$.alpha);else this.options.negateAlpha=$.alpha;return this}function C8($){if(I.plainObject($)){if(I.defined($.lower))if(I.number($.lower)&&I.inRange($.lower,0,99))this.options.normaliseLower=$.lower;else throw I.invalidParameterError("lower","number between 0 and 99",$.lower);if(I.defined($.upper))if(I.number($.upper)&&I.inRange($.upper,1,100))this.options.normaliseUpper=$.upper;else throw I.invalidParameterError("upper","number between 1 and 100",$.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw I.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function _8($){return this.normalise($)}function S8($){if(I.plainObject($)){if(I.integer($.width)&&$.width>0)this.options.claheWidth=$.width;else throw I.invalidParameterError("width","integer greater than zero",$.width);if(I.integer($.height)&&$.height>0)this.options.claheHeight=$.height;else throw I.invalidParameterError("height","integer greater than zero",$.height);if(I.defined($.maxSlope))if(I.integer($.maxSlope)&&I.inRange($.maxSlope,0,100))this.options.claheMaxSlope=$.maxSlope;else throw I.invalidParameterError("maxSlope","integer between 0 and 100",$.maxSlope)}else throw I.invalidParameterError("options","plain object",$);return this}function y8($){if(!I.object($)||!Array.isArray($.kernel)||!I.integer($.width)||!I.integer($.height)||!I.inRange($.width,3,1001)||!I.inRange($.height,3,1001)||$.height*$.width!==$.kernel.length)throw new Error("Invalid convolution kernel");if(!I.integer($.scale))$.scale=$.kernel.reduce((J,U)=>J+U,0);if($.scale<1)$.scale=1;if(!I.integer($.offset))$.offset=0;return this.options.convKernel=$,this}function x8($,J){if(!I.defined($))this.options.threshold=128;else if(I.bool($))this.options.threshold=$?128:0;else if(I.integer($)&&I.inRange($,0,255))this.options.threshold=$;else throw I.invalidParameterError("threshold","integer between 0 and 255",$);if(!I.object(J)||J.greyscale===!0||J.grayscale===!0)this.options.thresholdGrayscale=!0;else this.options.thresholdGrayscale=!1;return this}function v8($,J,U){if(this.options.boolean=this._createInputDescriptor($,U),I.string(J)&&I.inArray(J,["and","or","eor"]))this.options.booleanOp=J;else throw I.invalidParameterError("operator","one of: and, or, eor",J);return this}function O8($,J){if(!I.defined($)&&I.number(J))$=1;else if(I.number($)&&!I.defined(J))J=0;if(!I.defined($))this.options.linearA=[];else if(I.number($))this.options.linearA=[$];else if(Array.isArray($)&&$.length&&$.every(I.number))this.options.linearA=$;else throw I.invalidParameterError("a","number or array of numbers",$);if(!I.defined(J))this.options.linearB=[];else if(I.number(J))this.options.linearB=[J];else if(Array.isArray(J)&&J.length&&J.every(I.number))this.options.linearB=J;else throw I.invalidParameterError("b","number or array of numbers",J);if(this.options.linearA.length!==this.options.linearB.length)throw new Error("Expected a and b to be arrays of the same length");return this}function k8($){if(!Array.isArray($))throw I.invalidParameterError("inputMatrix","array",$);if($.length!==3&&$.length!==4)throw I.invalidParameterError("inputMatrix","3x3 or 4x4 array",$.length);let J=$.flat().map(Number);if(J.length!==9&&J.length!==16)throw I.invalidParameterError("inputMatrix","cardinality of 9 or 16",J.length);return this.options.recombMatrix=J,this}function h8($){if(!I.plainObject($))throw I.invalidParameterError("options","plain object",$);if("brightness"in $)if(I.number($.brightness)&&$.brightness>=0)this.options.brightness=$.brightness;else throw I.invalidParameterError("brightness","number above zero",$.brightness);if("saturation"in $)if(I.number($.saturation)&&$.saturation>=0)this.options.saturation=$.saturation;else throw I.invalidParameterError("saturation","number above zero",$.saturation);if("hue"in $)if(I.integer($.hue))this.options.hue=$.hue%360;else throw I.invalidParameterError("hue","number",$.hue);if("lightness"in $)if(I.number($.lightness))this.options.lightness=$.lightness;else throw I.invalidParameterError("lightness","number",$.lightness);return this}m4.exports=($)=>{Object.assign($.prototype,{autoOrient:B8,rotate:A8,flip:R8,flop:E8,affine:j8,sharpen:T8,erode:u4,dilate:d4,median:z8,blur:L8,flatten:D8,unflatten:w8,gamma:F8,negate:M8,normalise:C8,normalize:_8,clahe:S8,convolve:y8,threshold:x8,boolean:v8,linear:O8,recomb:k8,modulate:h8})}});var s4=_((bQ,n4)=>{var{defineProperty:P2,getOwnPropertyDescriptor:f8,getOwnPropertyNames:b8}=Object,g8=Object.prototype.hasOwnProperty,d8=($,J)=>{for(var U in J)P2($,U,{get:J[U],enumerable:!0})},u8=($,J,U,H)=>{if(J&&typeof J==="object"||typeof J==="function"){for(let Q of b8(J))if(!g8.call($,Q)&&Q!==U)P2($,Q,{get:()=>J[Q],enumerable:!(H=f8(J,Q))||H.enumerable})}return $},m8=($)=>u8(P2({},"__esModule",{value:!0}),$),c4={};d8(c4,{default:()=>U7});n4.exports=m8(c4);var Y0={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},r4=Object.create(null);for(let $ in Y0)if(Object.hasOwn(Y0,$))r4[Y0[$]]=$;var o={to:{},get:{}};o.get=function($){let J=$.slice(0,3).toLowerCase(),U,H;switch(J){case"hsl":{U=o.get.hsl($),H="hsl";break}case"hwb":{U=o.get.hwb($),H="hwb";break}default:{U=o.get.rgb($),H="rgb";break}}if(!U)return null;return{model:H,value:U}};o.get.rgb=function($){if(!$)return null;let J=/^#([a-f\d]{3,4})$/i,U=/^#([a-f\d]{6})([a-f\d]{2})?$/i,H=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,Q=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,W=/^(\w+)$/,Z=[0,0,0,1],Y,N,K;if(Y=$.match(U)){K=Y[2],Y=Y[1];for(N=0;N<3;N++){let A=N*2;Z[N]=Number.parseInt(Y.slice(A,A+2),16)}if(K)Z[3]=Number.parseInt(K,16)/255}else if(Y=$.match(J)){Y=Y[1],K=Y[3];for(N=0;N<3;N++)Z[N]=Number.parseInt(Y[N]+Y[N],16);if(K)Z[3]=Number.parseInt(K+K,16)/255}else if(Y=$.match(H)){for(N=0;N<3;N++)Z[N]=Number.parseInt(Y[N+1],10);if(Y[4])Z[3]=Y[5]?Number.parseFloat(Y[4])*0.01:Number.parseFloat(Y[4])}else if(Y=$.match(Q)){for(N=0;N<3;N++)Z[N]=Math.round(Number.parseFloat(Y[N+1])*2.55);if(Y[4])Z[3]=Y[5]?Number.parseFloat(Y[4])*0.01:Number.parseFloat(Y[4])}else if(Y=$.match(W)){if(Y[1]==="transparent")return[0,0,0,0];if(!Object.hasOwn(Y0,Y[1]))return null;return Z=Y0[Y[1]],Z[3]=1,Z}else return null;for(N=0;N<3;N++)Z[N]=B0(Z[N],0,255);return Z[3]=B0(Z[3],0,1),Z};o.get.hsl=function($){if(!$)return null;let J=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,U=$.match(J);if(U){let H=Number.parseFloat(U[4]),Q=(Number.parseFloat(U[1])%360+360)%360,W=B0(Number.parseFloat(U[2]),0,100),Z=B0(Number.parseFloat(U[3]),0,100),Y=B0(Number.isNaN(H)?1:H,0,1);return[Q,W,Z,Y]}return null};o.get.hwb=function($){if(!$)return null;let J=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,U=$.match(J);if(U){let H=Number.parseFloat(U[4]),Q=(Number.parseFloat(U[1])%360+360)%360,W=B0(Number.parseFloat(U[2]),0,100),Z=B0(Number.parseFloat(U[3]),0,100),Y=B0(Number.isNaN(H)?1:H,0,1);return[Q,W,Z,Y]}return null};o.to.hex=function(...$){return"#"+C1($[0])+C1($[1])+C1($[2])+($[3]<1?C1(Math.round($[3]*255)):"")};o.to.rgb=function(...$){return $.length<4||$[3]===1?"rgb("+Math.round($[0])+", "+Math.round($[1])+", "+Math.round($[2])+")":"rgba("+Math.round($[0])+", "+Math.round($[1])+", "+Math.round($[2])+", "+$[3]+")"};o.to.rgb.percent=function(...$){let J=Math.round($[0]/255*100),U=Math.round($[1]/255*100),H=Math.round($[2]/255*100);return $.length<4||$[3]===1?"rgb("+J+"%, "+U+"%, "+H+"%)":"rgba("+J+"%, "+U+"%, "+H+"%, "+$[3]+")"};o.to.hsl=function(...$){return $.length<4||$[3]===1?"hsl("+$[0]+", "+$[1]+"%, "+$[2]+"%)":"hsla("+$[0]+", "+$[1]+"%, "+$[2]+"%, "+$[3]+")"};o.to.hwb=function(...$){let J="";if($.length>=4&&$[3]!==1)J=", "+$[3];return"hwb("+$[0]+", "+$[1]+"%, "+$[2]+"%"+J+")"};o.to.keyword=function(...$){return r4[$.slice(0,3)]};function B0($,J,U){return Math.min(Math.max(J,$),U)}function C1($){let J=Math.round($).toString(16).toUpperCase();return J.length<2?"0"+J:J}var f0=o,a4={};for(let $ of Object.keys(Y0))a4[Y0[$]]=$;var w={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},S0=w,G0=0.008856451679035631;function g0($){let J=$>0.0031308?1.055*$**0.4166666666666667-0.055:$*12.92;return Math.min(Math.max(0,J),1)}function d0($){return $>0.04045?(($+0.055)/1.055)**2.4:$/12.92}for(let $ of Object.keys(w)){if(!("channels"in w[$]))throw new Error("missing channels property: "+$);if(!("labels"in w[$]))throw new Error("missing channel labels property: "+$);if(w[$].labels.length!==w[$].channels)throw new Error("channel and label counts mismatch: "+$);let{channels:J,labels:U}=w[$];delete w[$].channels,delete w[$].labels,Object.defineProperty(w[$],"channels",{value:J}),Object.defineProperty(w[$],"labels",{value:U})}w.rgb.hsl=function($){let J=$[0]/255,U=$[1]/255,H=$[2]/255,Q=Math.min(J,U,H),W=Math.max(J,U,H),Z=W-Q,Y,N;switch(W){case Q:{Y=0;break}case J:{Y=(U-H)/Z;break}case U:{Y=2+(H-J)/Z;break}case H:{Y=4+(J-U)/Z;break}}if(Y=Math.min(Y*60,360),Y<0)Y+=360;let K=(Q+W)/2;if(W===Q)N=0;else if(K<=0.5)N=Z/(W+Q);else N=Z/(2-W-Q);return[Y,N*100,K*100]};w.rgb.hsv=function($){let J,U,H,Q,W,Z=$[0]/255,Y=$[1]/255,N=$[2]/255,K=Math.max(Z,Y,N),A=K-Math.min(Z,Y,N),j=function(D){return(K-D)/6/A+0.5};if(A===0)Q=0,W=0;else{switch(W=A/K,J=j(Z),U=j(Y),H=j(N),K){case Z:{Q=H-U;break}case Y:{Q=0.3333333333333333+J-H;break}case N:{Q=0.6666666666666666+U-J;break}}if(Q<0)Q+=1;else if(Q>1)Q-=1}return[Q*360,W*100,K*100]};w.rgb.hwb=function($){let J=$[0],U=$[1],H=$[2],Q=w.rgb.hsl($)[0],W=0.00392156862745098*Math.min(J,Math.min(U,H));return H=1-0.00392156862745098*Math.max(J,Math.max(U,H)),[Q,W*100,H*100]};w.rgb.oklab=function($){let J=d0($[0]/255),U=d0($[1]/255),H=d0($[2]/255),Q=Math.cbrt(0.4122214708*J+0.5363325363*U+0.0514459929*H),W=Math.cbrt(0.2119034982*J+0.6806995451*U+0.1073969566*H),Z=Math.cbrt(0.0883024619*J+0.2817188376*U+0.6299787005*H),Y=0.2104542553*Q+0.793617785*W-0.0040720468*Z,N=1.9779984951*Q-2.428592205*W+0.4505937099*Z,K=0.0259040371*Q+0.7827717662*W-0.808675766*Z;return[Y*100,N*100,K*100]};w.rgb.cmyk=function($){let J=$[0]/255,U=$[1]/255,H=$[2]/255,Q=Math.min(1-J,1-U,1-H),W=(1-J-Q)/(1-Q)||0,Z=(1-U-Q)/(1-Q)||0,Y=(1-H-Q)/(1-Q)||0;return[W*100,Z*100,Y*100,Q*100]};function l8($,J){return($[0]-J[0])**2+($[1]-J[1])**2+($[2]-J[2])**2}w.rgb.keyword=function($){let J=a4[$];if(J)return J;let U=Number.POSITIVE_INFINITY,H;for(let Q of Object.keys(Y0)){let W=Y0[Q],Z=l8($,W);if(Z<U)U=Z,H=Q}return H};w.keyword.rgb=function($){return Y0[$]};w.rgb.xyz=function($){let J=d0($[0]/255),U=d0($[1]/255),H=d0($[2]/255),Q=J*0.4124564+U*0.3575761+H*0.1804375,W=J*0.2126729+U*0.7151522+H*0.072175,Z=J*0.0193339+U*0.119192+H*0.9503041;return[Q*100,W*100,Z*100]};w.rgb.lab=function($){let J=w.rgb.xyz($),U=J[0],H=J[1],Q=J[2];U/=95.047,H/=100,Q/=108.883,U=U>G0?U**0.3333333333333333:7.787*U+0.13793103448275862,H=H>G0?H**0.3333333333333333:7.787*H+0.13793103448275862,Q=Q>G0?Q**0.3333333333333333:7.787*Q+0.13793103448275862;let W=116*H-16,Z=500*(U-H),Y=200*(H-Q);return[W,Z,Y]};w.hsl.rgb=function($){let J=$[0]/360,U=$[1]/100,H=$[2]/100,Q,W;if(U===0)return W=H*255,[W,W,W];let Z=H<0.5?H*(1+U):H+U-H*U,Y=2*H-Z,N=[0,0,0];for(let K=0;K<3;K++){if(Q=J+0.3333333333333333*-(K-1),Q<0)Q++;if(Q>1)Q--;if(6*Q<1)W=Y+(Z-Y)*6*Q;else if(2*Q<1)W=Z;else if(3*Q<2)W=Y+(Z-Y)*(0.6666666666666666-Q)*6;else W=Y;N[K]=W*255}return N};w.hsl.hsv=function($){let J=$[0],U=$[1]/100,H=$[2]/100,Q=U,W=Math.max(H,0.01);H*=2,U*=H<=1?H:2-H,Q*=W<=1?W:2-W;let Z=(H+U)/2,Y=H===0?2*Q/(W+Q):2*U/(H+U);return[J,Y*100,Z*100]};w.hsv.rgb=function($){let J=$[0]/60,U=$[1]/100,H=$[2]/100,Q=Math.floor(J)%6,W=J-Math.floor(J),Z=255*H*(1-U),Y=255*H*(1-U*W),N=255*H*(1-U*(1-W));switch(H*=255,Q){case 0:return[H,N,Z];case 1:return[Y,H,Z];case 2:return[Z,H,N];case 3:return[Z,Y,H];case 4:return[N,Z,H];case 5:return[H,Z,Y]}};w.hsv.hsl=function($){let J=$[0],U=$[1]/100,H=$[2]/100,Q=Math.max(H,0.01),W,Z;Z=(2-U)*H;let Y=(2-U)*Q;return W=U*Q,W/=Y<=1?Y:2-Y,W=W||0,Z/=2,[J,W*100,Z*100]};w.hwb.rgb=function($){let J=$[0]/360,U=$[1]/100,H=$[2]/100,Q=U+H,W;if(Q>1)U/=Q,H/=Q;let Z=Math.floor(6*J),Y=1-H;if(W=6*J-Z,(Z&1)!==0)W=1-W;let N=U+W*(Y-U),K,A,j;switch(Z){default:case 6:case 0:{K=Y,A=N,j=U;break}case 1:{K=N,A=Y,j=U;break}case 2:{K=U,A=Y,j=N;break}case 3:{K=U,A=N,j=Y;break}case 4:{K=N,A=U,j=Y;break}case 5:{K=Y,A=U,j=N;break}}return[K*255,A*255,j*255]};w.cmyk.rgb=function($){let J=$[0]/100,U=$[1]/100,H=$[2]/100,Q=$[3]/100,W=1-Math.min(1,J*(1-Q)+Q),Z=1-Math.min(1,U*(1-Q)+Q),Y=1-Math.min(1,H*(1-Q)+Q);return[W*255,Z*255,Y*255]};w.xyz.rgb=function($){let J=$[0]/100,U=$[1]/100,H=$[2]/100,Q,W,Z;return Q=J*3.2404542+U*-1.5371385+H*-0.4985314,W=J*-0.969266+U*1.8760108+H*0.041556,Z=J*0.0556434+U*-0.2040259+H*1.0572252,Q=g0(Q),W=g0(W),Z=g0(Z),[Q*255,W*255,Z*255]};w.xyz.lab=function($){let J=$[0],U=$[1],H=$[2];J/=95.047,U/=100,H/=108.883,J=J>G0?J**0.3333333333333333:7.787*J+0.13793103448275862,U=U>G0?U**0.3333333333333333:7.787*U+0.13793103448275862,H=H>G0?H**0.3333333333333333:7.787*H+0.13793103448275862;let Q=116*U-16,W=500*(J-U),Z=200*(U-H);return[Q,W,Z]};w.xyz.oklab=function($){let J=$[0]/100,U=$[1]/100,H=$[2]/100,Q=Math.cbrt(0.8189330101*J+0.3618667424*U-0.1288597137*H),W=Math.cbrt(0.0329845436*J+0.9293118715*U+0.0361456387*H),Z=Math.cbrt(0.0482003018*J+0.2643662691*U+0.633851707*H),Y=0.2104542553*Q+0.793617785*W-0.0040720468*Z,N=1.9779984951*Q-2.428592205*W+0.4505937099*Z,K=0.0259040371*Q+0.7827717662*W-0.808675766*Z;return[Y*100,N*100,K*100]};w.oklab.oklch=function($){return w.lab.lch($)};w.oklab.xyz=function($){let J=$[0]/100,U=$[1]/100,H=$[2]/100,Q=(0.999999998*J+0.396337792*U+0.215803758*H)**3,W=(1.000000008*J-0.105561342*U-0.063854175*H)**3,Z=(1.000000055*J-0.089484182*U-1.291485538*H)**3,Y=1.227013851*Q-0.55779998*W+0.281256149*Z,N=-0.040580178*Q+1.11225687*W-0.071676679*Z,K=-0.076381285*Q-0.421481978*W+1.58616322*Z;return[Y*100,N*100,K*100]};w.oklab.rgb=function($){let J=$[0]/100,U=$[1]/100,H=$[2]/100,Q=(J+0.3963377774*U+0.2158037573*H)**3,W=(J-0.1055613458*U-0.0638541728*H)**3,Z=(J-0.0894841775*U-1.291485548*H)**3,Y=g0(4.0767416621*Q-3.3077115913*W+0.2309699292*Z),N=g0(-1.2684380046*Q+2.6097574011*W-0.3413193965*Z),K=g0(-0.0041960863*Q-0.7034186147*W+1.707614701*Z);return[Y*255,N*255,K*255]};w.oklch.oklab=function($){return w.lch.lab($)};w.lab.xyz=function($){let J=$[0],U=$[1],H=$[2],Q,W,Z;W=(J+16)/116,Q=U/500+W,Z=W-H/200;let Y=W**3,N=Q**3,K=Z**3;return W=Y>G0?Y:(W-0.13793103448275862)/7.787,Q=N>G0?N:(Q-0.13793103448275862)/7.787,Z=K>G0?K:(Z-0.13793103448275862)/7.787,Q*=95.047,W*=100,Z*=108.883,[Q,W,Z]};w.lab.lch=function($){let J=$[0],U=$[1],H=$[2],Q;if(Q=Math.atan2(H,U)*360/2/Math.PI,Q<0)Q+=360;let Z=Math.sqrt(U*U+H*H);return[J,Z,Q]};w.lch.lab=function($){let J=$[0],U=$[1],Q=$[2]/360*2*Math.PI,W=U*Math.cos(Q),Z=U*Math.sin(Q);return[J,W,Z]};w.rgb.ansi16=function($,J=null){let[U,H,Q]=$,W=J===null?w.rgb.hsv($)[2]:J;if(W=Math.round(W/50),W===0)return 30;let Z=30+(Math.round(Q/255)<<2|Math.round(H/255)<<1|Math.round(U/255));if(W===2)Z+=60;return Z};w.hsv.ansi16=function($){return w.rgb.ansi16(w.hsv.rgb($),$[2])};w.rgb.ansi256=function($){let J=$[0],U=$[1],H=$[2];if(J>>4===U>>4&&U>>4===H>>4){if(J<8)return 16;if(J>248)return 231;return Math.round((J-8)/247*24)+232}return 16+36*Math.round(J/255*5)+6*Math.round(U/255*5)+Math.round(H/255*5)};w.ansi16.rgb=function($){$=$[0];let J=$%10;if(J===0||J===7){if($>50)J+=3.5;return J=J/10.5*255,[J,J,J]}let U=(Math.trunc($>50)+1)*0.5,H=(J&1)*U*255,Q=(J>>1&1)*U*255,W=(J>>2&1)*U*255;return[H,Q,W]};w.ansi256.rgb=function($){if($=$[0],$>=232){let W=($-232)*10+8;return[W,W,W]}$-=16;let J,U=Math.floor($/36)/5*255,H=Math.floor((J=$%36)/6)/5*255,Q=J%6/5*255;return[U,H,Q]};w.rgb.hex=function($){let U=(((Math.round($[0])&255)<<16)+((Math.round($[1])&255)<<8)+(Math.round($[2])&255)).toString(16).toUpperCase();return"000000".slice(U.length)+U};w.hex.rgb=function($){let J=$.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!J)return[0,0,0];let U=J[0];if(J[0].length===3)U=[...U].map((Y)=>Y+Y).join("");let H=Number.parseInt(U,16),Q=H>>16&255,W=H>>8&255,Z=H&255;return[Q,W,Z]};w.rgb.hcg=function($){let J=$[0]/255,U=$[1]/255,H=$[2]/255,Q=Math.max(Math.max(J,U),H),W=Math.min(Math.min(J,U),H),Z=Q-W,Y,N=Z<1?W/(1-Z):0;if(Z<=0)Y=0;else if(Q===J)Y=(U-H)/Z%6;else if(Q===U)Y=2+(H-J)/Z;else Y=4+(J-U)/Z;return Y/=6,Y%=1,[Y*360,Z*100,N*100]};w.hsl.hcg=function($){let J=$[1]/100,U=$[2]/100,H=U<0.5?2*J*U:2*J*(1-U),Q=0;if(H<1)Q=(U-0.5*H)/(1-H);return[$[0],H*100,Q*100]};w.hsv.hcg=function($){let J=$[1]/100,U=$[2]/100,H=J*U,Q=0;if(H<1)Q=(U-H)/(1-H);return[$[0],H*100,Q*100]};w.hcg.rgb=function($){let J=$[0]/360,U=$[1]/100,H=$[2]/100;if(U===0)return[H*255,H*255,H*255];let Q=[0,0,0],W=J%1*6,Z=W%1,Y=1-Z,N=0;switch(Math.floor(W)){case 0:{Q[0]=1,Q[1]=Z,Q[2]=0;break}case 1:{Q[0]=Y,Q[1]=1,Q[2]=0;break}case 2:{Q[0]=0,Q[1]=1,Q[2]=Z;break}case 3:{Q[0]=0,Q[1]=Y,Q[2]=1;break}case 4:{Q[0]=Z,Q[1]=0,Q[2]=1;break}default:Q[0]=1,Q[1]=0,Q[2]=Y}return N=(1-U)*H,[(U*Q[0]+N)*255,(U*Q[1]+N)*255,(U*Q[2]+N)*255]};w.hcg.hsv=function($){let J=$[1]/100,U=$[2]/100,H=J+U*(1-J),Q=0;if(H>0)Q=J/H;return[$[0],Q*100,H*100]};w.hcg.hsl=function($){let J=$[1]/100,H=$[2]/100*(1-J)+0.5*J,Q=0;if(H>0&&H<0.5)Q=J/(2*H);else if(H>=0.5&&H<1)Q=J/(2*(1-H));return[$[0],Q*100,H*100]};w.hcg.hwb=function($){let J=$[1]/100,U=$[2]/100,H=J+U*(1-J);return[$[0],(H-J)*100,(1-H)*100]};w.hwb.hcg=function($){let J=$[1]/100,H=1-$[2]/100,Q=H-J,W=0;if(Q<1)W=(H-Q)/(1-Q);return[$[0],Q*100,W*100]};w.apple.rgb=function($){return[$[0]/65535*255,$[1]/65535*255,$[2]/65535*255]};w.rgb.apple=function($){return[$[0]/255*65535,$[1]/255*65535,$[2]/255*65535]};w.gray.rgb=function($){return[$[0]/100*255,$[0]/100*255,$[0]/100*255]};w.gray.hsl=function($){return[0,0,$[0]]};w.gray.hsv=w.gray.hsl;w.gray.hwb=function($){return[0,100,$[0]]};w.gray.cmyk=function($){return[0,0,0,$[0]]};w.gray.lab=function($){return[$[0],0,0]};w.gray.hex=function($){let J=Math.round($[0]/100*255)&255,H=((J<<16)+(J<<8)+J).toString(16).toUpperCase();return"000000".slice(H.length)+H};w.rgb.gray=function($){return[($[0]+$[1]+$[2])/3/255*100]};function c8(){let $={},J=Object.keys(S0);for(let{length:U}=J,H=0;H<U;H++)$[J[H]]={distance:-1,parent:null};return $}function r8($){let J=c8(),U=[$];J[$].distance=0;while(U.length>0){let H=U.pop(),Q=Object.keys(S0[H]);for(let{length:W}=Q,Z=0;Z<W;Z++){let Y=Q[Z],N=J[Y];if(N.distance===-1)N.distance=J[H].distance+1,N.parent=H,U.unshift(Y)}}return J}function a8($,J){return function(U){return J($(U))}}function e8($,J){let U=[J[$].parent,$],H=S0[J[$].parent][$],Q=J[$].parent;while(J[Q].parent)U.unshift(J[Q].parent),H=a8(S0[J[Q].parent][Q],H),Q=J[Q].parent;return H.conversion=U,H}function n8($){let J=r8($),U={},H=Object.keys(J);for(let{length:Q}=H,W=0;W<Q;W++){let Z=H[W];if(J[Z].parent===null)continue;U[Z]=e8(Z,J)}return U}var s8=n8,b0={},p8=Object.keys(S0);function i8($){let J=function(...U){let H=U[0];if(H===void 0||H===null)return H;if(H.length>1)U=H;return $(U)};if("conversion"in $)J.conversion=$.conversion;return J}function t8($){let J=function(...U){let H=U[0];if(H===void 0||H===null)return H;if(H.length>1)U=H;let Q=$(U);if(typeof Q==="object")for(let{length:W}=Q,Z=0;Z<W;Z++)Q[Z]=Math.round(Q[Z]);return Q};if("conversion"in $)J.conversion=$.conversion;return J}for(let $ of p8){b0[$]={},Object.defineProperty(b0[$],"channels",{value:S0[$].channels}),Object.defineProperty(b0[$],"labels",{value:S0[$].labels});let J=s8($),U=Object.keys(J);for(let H of U){let Q=J[H];b0[$][H]=t8(Q),b0[$][H].raw=i8(Q)}}var $0=b0,e4=["keyword","gray","hex"],G2={};for(let $ of Object.keys($0))G2[[...$0[$].labels].sort().join("")]=$;var I2={};function n($,J){if(!(this instanceof n))return new n($,J);if(J&&J in e4)J=null;if(J&&!(J in $0))throw new Error("Unknown model: "+J);let U,H;if($==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if($ instanceof n)this.model=$.model,this.color=[...$.color],this.valpha=$.valpha;else if(typeof $==="string"){let Q=f0.get($);if(Q===null)throw new Error("Unable to parse color from string: "+$);this.model=Q.model,H=$0[this.model].channels,this.color=Q.value.slice(0,H),this.valpha=typeof Q.value[H]==="number"?Q.value[H]:1}else if($.length>0){this.model=J||"rgb",H=$0[this.model].channels;let Q=Array.prototype.slice.call($,0,H);this.color=V2(Q,H),this.valpha=typeof $[H]==="number"?$[H]:1}else if(typeof $==="number")this.model="rgb",this.color=[$>>16&255,$>>8&255,$&255],this.valpha=1;else{this.valpha=1;let Q=Object.keys($);if("alpha"in $)Q.splice(Q.indexOf("alpha"),1),this.valpha=typeof $.alpha==="number"?$.alpha:0;let W=Q.sort().join("");if(!(W in G2))throw new Error("Unable to parse color from object: "+JSON.stringify($));this.model=G2[W];let{labels:Z}=$0[this.model],Y=[];for(U=0;U<Z.length;U++)Y.push($[Z[U]]);this.color=V2(Y)}if(I2[this.model]){H=$0[this.model].channels;for(U=0;U<H;U++){let Q=I2[this.model][U];if(Q)this.color[U]=Q(this.color[U])}}if(this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze)Object.freeze(this)}n.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string($){let J=this.model in f0.to?this:this.rgb();J=J.round(typeof $==="number"?$:1);let U=J.valpha===1?J.color:[...J.color,this.valpha];return f0.to[J.model](...U)},percentString($){let J=this.rgb().round(typeof $==="number"?$:1),U=J.valpha===1?J.color:[...J.color,this.valpha];return f0.to.rgb.percent(...U)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){let $={},{channels:J}=$0[this.model],{labels:U}=$0[this.model];for(let H=0;H<J;H++)$[U[H]]=this.color[H];if(this.valpha!==1)$.alpha=this.valpha;return $},unitArray(){let $=this.rgb().color;if($[0]/=255,$[1]/=255,$[2]/=255,this.valpha!==1)$.push(this.valpha);return $},unitObject(){let $=this.rgb().object();if($.r/=255,$.g/=255,$.b/=255,this.valpha!==1)$.alpha=this.valpha;return $},round($){return $=Math.max($||0,0),new n([...this.color.map($7($)),this.valpha],this.model)},alpha($){if($!==void 0)return new n([...this.color,Math.max(0,Math.min(1,$))],this.model);return this.valpha},red:a("rgb",0,e(255)),green:a("rgb",1,e(255)),blue:a("rgb",2,e(255)),hue:a(["hsl","hsv","hsl","hwb","hcg"],0,($)=>($%360+360)%360),saturationl:a("hsl",1,e(100)),lightness:a("hsl",2,e(100)),saturationv:a("hsv",1,e(100)),value:a("hsv",2,e(100)),chroma:a("hcg",1,e(100)),gray:a("hcg",2,e(100)),white:a("hwb",1,e(100)),wblack:a("hwb",2,e(100)),cyan:a("cmyk",0,e(100)),magenta:a("cmyk",1,e(100)),yellow:a("cmyk",2,e(100)),black:a("cmyk",3,e(100)),x:a("xyz",0,e(95.047)),y:a("xyz",1,e(100)),z:a("xyz",2,e(108.833)),l:a("lab",0,e(100)),a:a("lab",1),b:a("lab",2),keyword($){if($!==void 0)return new n($);return $0[this.model].keyword(this.color)},hex($){if($!==void 0)return new n($);return f0.to.hex(...this.rgb().round().color)},hexa($){if($!==void 0)return new n($);let J=this.rgb().round().color,U=Math.round(this.valpha*255).toString(16).toUpperCase();if(U.length===1)U="0"+U;return f0.to.hex(...J)+U},rgbNumber(){let $=this.rgb().color;return($[0]&255)<<16|($[1]&255)<<8|$[2]&255},luminosity(){let $=this.rgb().color,J=[];for(let[U,H]of $.entries()){let Q=H/255;J[U]=Q<=0.04045?Q/12.92:((Q+0.055)/1.055)**2.4}return 0.2126*J[0]+0.7152*J[1]+0.0722*J[2]},contrast($){let J=this.luminosity(),U=$.luminosity();if(J>U)return(J+0.05)/(U+0.05);return(U+0.05)/(J+0.05)},level($){let J=this.contrast($);if(J>=7)return"AAA";return J>=4.5?"AA":""},isDark(){let $=this.rgb().color;return($[0]*2126+$[1]*7152+$[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){let $=this.rgb();for(let J=0;J<3;J++)$.color[J]=255-$.color[J];return $},lighten($){let J=this.hsl();return J.color[2]+=J.color[2]*$,J},darken($){let J=this.hsl();return J.color[2]-=J.color[2]*$,J},saturate($){let J=this.hsl();return J.color[1]+=J.color[1]*$,J},desaturate($){let J=this.hsl();return J.color[1]-=J.color[1]*$,J},whiten($){let J=this.hwb();return J.color[1]+=J.color[1]*$,J},blacken($){let J=this.hwb();return J.color[2]+=J.color[2]*$,J},grayscale(){let $=this.rgb().color,J=$[0]*0.3+$[1]*0.59+$[2]*0.11;return n.rgb(J,J,J)},fade($){return this.alpha(this.valpha-this.valpha*$)},opaquer($){return this.alpha(this.valpha+this.valpha*$)},rotate($){let J=this.hsl(),U=J.color[0];return U=(U+$)%360,U=U<0?360+U:U,J.color[0]=U,J},mix($,J){if(!$||!$.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof $);let U=$.rgb(),H=this.rgb(),Q=J===void 0?0.5:J,W=2*Q-1,Z=U.alpha()-H.alpha(),Y=((W*Z===-1?W:(W+Z)/(1+W*Z))+1)/2,N=1-Y;return n.rgb(Y*U.red()+N*H.red(),Y*U.green()+N*H.green(),Y*U.blue()+N*H.blue(),U.alpha()*Q+H.alpha()*(1-Q))}};for(let $ of Object.keys($0)){if(e4.includes($))continue;let{channels:J}=$0[$];n.prototype[$]=function(...U){if(this.model===$)return new n(this);if(U.length>0)return new n(U,$);return new n([...J7($0[this.model][$].raw(this.color)),this.valpha],$)},n[$]=function(...U){let H=U[0];if(typeof H==="number")H=V2(U,J);return new n(H,$)}}function o8($,J){return Number($.toFixed(J))}function $7($){return function(J){return o8(J,$)}}function a($,J,U){$=Array.isArray($)?$:[$];for(let H of $)(I2[H]||=[])[J]=U;return $=$[0],function(H){let Q;if(H!==void 0){if(U)H=U(H);return Q=this[$](),Q.color[J]=H,Q}if(Q=this[$]().color[J],U)Q=U(Q);return Q}}function e($){return function(J){return Math.max(0,Math.min($,J))}}function J7($){return Array.isArray($)?$:[$]}function V2($,J){for(let U=0;U<J;U++)if(typeof $[U]!=="number")$[U]=0;return $}var U7=n});var i4=_((gQ,p4)=>{p4.exports=s4().default});var J6=_((dQ,$6)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var H7=i4(),I0=H0(),t4={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function Q7($){return this._setBackgroundColourOption("tint",$),this}function W7($){return this.options.greyscale=I0.bool($)?$:!0,this}function Z7($){return this.greyscale($)}function N7($){if(!I0.string($))throw I0.invalidParameterError("colourspace","string",$);return this.options.colourspacePipeline=$,this}function Y7($){return this.pipelineColourspace($)}function q7($){if(!I0.string($))throw I0.invalidParameterError("colourspace","string",$);return this.options.colourspace=$,this}function K7($){return this.toColourspace($)}function o4($){if(I0.object($)||I0.string($)&&$.length>=3&&$.length<=200){let J=H7($);return[J.red(),J.green(),J.blue(),Math.round(J.alpha()*255)]}else throw I0.invalidParameterError("background","object or string",$)}function X7($,J){if(I0.defined(J))this.options[$]=o4(J)}$6.exports=($)=>{Object.assign($.prototype,{tint:Q7,greyscale:W7,grayscale:Z7,pipelineColourspace:N7,pipelineColorspace:Y7,toColourspace:q7,toColorspace:K7,_getBackgroundColourOption:o4,_setBackgroundColourOption:X7}),$.colourspace=t4,$.colorspace=t4}});var H6=_((uQ,U6)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var q0=H0(),G7={and:"and",or:"or",eor:"eor"};function I7(){return this.options.removeAlpha=!0,this}function V7($){if(q0.defined($))if(q0.number($)&&q0.inRange($,0,1))this.options.ensureAlpha=$;else throw q0.invalidParameterError("alpha","number between 0 and 1",$);else this.options.ensureAlpha=1;return this}function P7($){let J={red:0,green:1,blue:2,alpha:3};if(Object.keys(J).includes($))$=J[$];if(q0.integer($)&&q0.inRange($,0,4))this.options.extractChannel=$;else throw q0.invalidParameterError("channel","integer or one of: red, green, blue, alpha",$);return this}function A7($,J){if(Array.isArray($))$.forEach(function(U){this.options.joinChannelIn.push(this._createInputDescriptor(U,J))},this);else this.options.joinChannelIn.push(this._createInputDescriptor($,J));return this}function B7($){if(q0.string($)&&q0.inArray($,["and","or","eor"]))this.options.bandBoolOp=$;else throw q0.invalidParameterError("boolOp","one of: and, or, eor",$);return this}U6.exports=($)=>{Object.assign($.prototype,{removeAlpha:I7,ensureAlpha:V7,extractChannel:P7,joinChannel:A7,bandbool:B7}),$.bool=G7}});var Y6=_((mQ,N6)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var A2=O("path"),q=H0(),u0=t0(),Q6=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),R7=/\.(jp[2x]|j2[kc])$/i,W6=()=>new Error("JP2 output requires libvips with support for OpenJPEG"),Z6=($)=>1<<31-Math.clz32(Math.ceil(Math.log2($)));function E7($,J){let U;if(!q.string($))U=new Error("Missing output file path");else if(q.string(this.options.input.file)&&A2.resolve(this.options.input.file)===A2.resolve($))U=new Error("Cannot use same file for input and output");else if(R7.test(A2.extname($))&&!this.constructor.format.jp2k.output.file)U=W6();if(U)if(q.fn(J))J(U);else return Promise.reject(U);else{this.options.fileOut=$;let H=Error();return this._pipeline(J,H)}return this}function j7($,J){if(q.object($))this._setBooleanOption("resolveWithObject",$.resolveWithObject);else if(this.options.resolveWithObject)this.options.resolveWithObject=!1;this.options.fileOut="";let U=Error();return this._pipeline(q.fn($)?$:J,U)}function T7(){return this.options.keepMetadata|=1,this}function z7($){if(q.object($))for(let[J,U]of Object.entries($))if(q.object(U))for(let[H,Q]of Object.entries(U))if(q.string(Q))this.options.withExif[`exif-${J.toLowerCase()}-${H}`]=Q;else throw q.invalidParameterError(`${J}.${H}`,"string",Q);else throw q.invalidParameterError(J,"object",U);else throw q.invalidParameterError("exif","object",$);return this.options.withExifMerge=!1,this.keepExif()}function L7($){return this.withExif($),this.options.withExifMerge=!0,this}function D7(){return this.options.keepMetadata|=8,this}function w7($,J){if(q.string($))this.options.withIccProfile=$;else throw q.invalidParameterError("icc","string",$);if(this.keepIccProfile(),q.object(J)){if(q.defined(J.attach))if(q.bool(J.attach)){if(!J.attach)this.options.keepMetadata&=-9}else throw q.invalidParameterError("attach","boolean",J.attach)}return this}function F7(){return this.options.keepMetadata|=2,this}function M7($){if(q.string($)&&$.length>0)this.options.withXmp=$,this.options.keepMetadata|=2;else throw q.invalidParameterError("xmp","non-empty string",$);return this}function C7(){return this.options.keepMetadata=31,this}function _7($){if(this.keepMetadata(),this.withIccProfile("srgb"),q.object($)){if(q.defined($.orientation))if(q.integer($.orientation)&&q.inRange($.orientation,1,8))this.options.withMetadataOrientation=$.orientation;else throw q.invalidParameterError("orientation","integer between 1 and 8",$.orientation);if(q.defined($.density))if(q.number($.density)&&$.density>0)this.options.withMetadataDensity=$.density;else throw q.invalidParameterError("density","positive number",$.density);if(q.defined($.icc))this.withIccProfile($.icc);if(q.defined($.exif))this.withExifMerge($.exif)}return this}function S7($,J){let U=Q6.get((q.object($)&&q.string($.id)?$.id:$).toLowerCase());if(!U)throw q.invalidParameterError("format",`one of: ${[...Q6.keys()].join(", ")}`,$);return this[U](J)}function y7($){if(q.object($)){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.jpegQuality=$.quality;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);if(q.defined($.progressive))this._setBooleanOption("jpegProgressive",$.progressive);if(q.defined($.chromaSubsampling))if(q.string($.chromaSubsampling)&&q.inArray($.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=$.chromaSubsampling;else throw q.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",$.chromaSubsampling);let J=q.bool($.optimizeCoding)?$.optimizeCoding:$.optimiseCoding;if(q.defined(J))this._setBooleanOption("jpegOptimiseCoding",J);if(q.defined($.mozjpeg))if(q.bool($.mozjpeg)){if($.mozjpeg)this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3}else throw q.invalidParameterError("mozjpeg","boolean",$.mozjpeg);let U=q.bool($.trellisQuantization)?$.trellisQuantization:$.trellisQuantisation;if(q.defined(U))this._setBooleanOption("jpegTrellisQuantisation",U);if(q.defined($.overshootDeringing))this._setBooleanOption("jpegOvershootDeringing",$.overshootDeringing);let H=q.bool($.optimizeScans)?$.optimizeScans:$.optimiseScans;if(q.defined(H)){if(this._setBooleanOption("jpegOptimiseScans",H),H)this.options.jpegProgressive=!0}let Q=q.number($.quantizationTable)?$.quantizationTable:$.quantisationTable;if(q.defined(Q))if(q.integer(Q)&&q.inRange(Q,0,8))this.options.jpegQuantisationTable=Q;else throw q.invalidParameterError("quantisationTable","integer between 0 and 8",Q)}return this._updateFormatOut("jpeg",$)}function x7($){if(q.object($)){if(q.defined($.progressive))this._setBooleanOption("pngProgressive",$.progressive);if(q.defined($.compressionLevel))if(q.integer($.compressionLevel)&&q.inRange($.compressionLevel,0,9))this.options.pngCompressionLevel=$.compressionLevel;else throw q.invalidParameterError("compressionLevel","integer between 0 and 9",$.compressionLevel);if(q.defined($.adaptiveFiltering))this._setBooleanOption("pngAdaptiveFiltering",$.adaptiveFiltering);let J=$.colours||$.colors;if(q.defined(J))if(q.integer(J)&&q.inRange(J,2,256))this.options.pngBitdepth=Z6(J);else throw q.invalidParameterError("colours","integer between 2 and 256",J);if(q.defined($.palette))this._setBooleanOption("pngPalette",$.palette);else if([$.quality,$.effort,$.colours,$.colors,$.dither].some(q.defined))this._setBooleanOption("pngPalette",!0);if(this.options.pngPalette){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,0,100))this.options.pngQuality=$.quality;else throw q.invalidParameterError("quality","integer between 0 and 100",$.quality);if(q.defined($.effort))if(q.integer($.effort)&&q.inRange($.effort,1,10))this.options.pngEffort=$.effort;else throw q.invalidParameterError("effort","integer between 1 and 10",$.effort);if(q.defined($.dither))if(q.number($.dither)&&q.inRange($.dither,0,1))this.options.pngDither=$.dither;else throw q.invalidParameterError("dither","number between 0.0 and 1.0",$.dither)}}return this._updateFormatOut("png",$)}function v7($){if(q.object($)){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.webpQuality=$.quality;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);if(q.defined($.alphaQuality))if(q.integer($.alphaQuality)&&q.inRange($.alphaQuality,0,100))this.options.webpAlphaQuality=$.alphaQuality;else throw q.invalidParameterError("alphaQuality","integer between 0 and 100",$.alphaQuality);if(q.defined($.lossless))this._setBooleanOption("webpLossless",$.lossless);if(q.defined($.nearLossless))this._setBooleanOption("webpNearLossless",$.nearLossless);if(q.defined($.smartSubsample))this._setBooleanOption("webpSmartSubsample",$.smartSubsample);if(q.defined($.smartDeblock))this._setBooleanOption("webpSmartDeblock",$.smartDeblock);if(q.defined($.preset))if(q.string($.preset)&&q.inArray($.preset,["default","photo","picture","drawing","icon","text"]))this.options.webpPreset=$.preset;else throw q.invalidParameterError("preset","one of: default, photo, picture, drawing, icon, text",$.preset);if(q.defined($.effort))if(q.integer($.effort)&&q.inRange($.effort,0,6))this.options.webpEffort=$.effort;else throw q.invalidParameterError("effort","integer between 0 and 6",$.effort);if(q.defined($.minSize))this._setBooleanOption("webpMinSize",$.minSize);if(q.defined($.mixed))this._setBooleanOption("webpMixed",$.mixed)}return B2($,this.options),this._updateFormatOut("webp",$)}function O7($){if(q.object($)){if(q.defined($.reuse))this._setBooleanOption("gifReuse",$.reuse);if(q.defined($.progressive))this._setBooleanOption("gifProgressive",$.progressive);let J=$.colours||$.colors;if(q.defined(J))if(q.integer(J)&&q.inRange(J,2,256))this.options.gifBitdepth=Z6(J);else throw q.invalidParameterError("colours","integer between 2 and 256",J);if(q.defined($.effort))if(q.number($.effort)&&q.inRange($.effort,1,10))this.options.gifEffort=$.effort;else throw q.invalidParameterError("effort","integer between 1 and 10",$.effort);if(q.defined($.dither))if(q.number($.dither)&&q.inRange($.dither,0,1))this.options.gifDither=$.dither;else throw q.invalidParameterError("dither","number between 0.0 and 1.0",$.dither);if(q.defined($.interFrameMaxError))if(q.number($.interFrameMaxError)&&q.inRange($.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=$.interFrameMaxError;else throw q.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",$.interFrameMaxError);if(q.defined($.interPaletteMaxError))if(q.number($.interPaletteMaxError)&&q.inRange($.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=$.interPaletteMaxError;else throw q.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",$.interPaletteMaxError);if(q.defined($.keepDuplicateFrames))if(q.bool($.keepDuplicateFrames))this._setBooleanOption("gifKeepDuplicateFrames",$.keepDuplicateFrames);else throw q.invalidParameterError("keepDuplicateFrames","boolean",$.keepDuplicateFrames)}return B2($,this.options),this._updateFormatOut("gif",$)}function k7($){if(!this.constructor.format.jp2k.output.buffer)throw W6();if(q.object($)){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.jp2Quality=$.quality;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);if(q.defined($.lossless))if(q.bool($.lossless))this.options.jp2Lossless=$.lossless;else throw q.invalidParameterError("lossless","boolean",$.lossless);if(q.defined($.tileWidth))if(q.integer($.tileWidth)&&q.inRange($.tileWidth,1,32768))this.options.jp2TileWidth=$.tileWidth;else throw q.invalidParameterError("tileWidth","integer between 1 and 32768",$.tileWidth);if(q.defined($.tileHeight))if(q.integer($.tileHeight)&&q.inRange($.tileHeight,1,32768))this.options.jp2TileHeight=$.tileHeight;else throw q.invalidParameterError("tileHeight","integer between 1 and 32768",$.tileHeight);if(q.defined($.chromaSubsampling))if(q.string($.chromaSubsampling)&&q.inArray($.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=$.chromaSubsampling;else throw q.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",$.chromaSubsampling)}return this._updateFormatOut("jp2",$)}function B2($,J){if(q.object($)&&q.defined($.loop))if(q.integer($.loop)&&q.inRange($.loop,0,65535))J.loop=$.loop;else throw q.invalidParameterError("loop","integer between 0 and 65535",$.loop);if(q.object($)&&q.defined($.delay))if(q.integer($.delay)&&q.inRange($.delay,0,65535))J.delay=[$.delay];else if(Array.isArray($.delay)&&$.delay.every(q.integer)&&$.delay.every((U)=>q.inRange(U,0,65535)))J.delay=$.delay;else throw q.invalidParameterError("delay","integer or an array of integers between 0 and 65535",$.delay)}function h7($){if(q.object($)){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.tiffQuality=$.quality;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);if(q.defined($.bitdepth))if(q.integer($.bitdepth)&&q.inArray($.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=$.bitdepth;else throw q.invalidParameterError("bitdepth","1, 2, 4 or 8",$.bitdepth);if(q.defined($.tile))this._setBooleanOption("tiffTile",$.tile);if(q.defined($.tileWidth))if(q.integer($.tileWidth)&&$.tileWidth>0)this.options.tiffTileWidth=$.tileWidth;else throw q.invalidParameterError("tileWidth","integer greater than zero",$.tileWidth);if(q.defined($.tileHeight))if(q.integer($.tileHeight)&&$.tileHeight>0)this.options.tiffTileHeight=$.tileHeight;else throw q.invalidParameterError("tileHeight","integer greater than zero",$.tileHeight);if(q.defined($.miniswhite))this._setBooleanOption("tiffMiniswhite",$.miniswhite);if(q.defined($.pyramid))this._setBooleanOption("tiffPyramid",$.pyramid);if(q.defined($.xres))if(q.number($.xres)&&$.xres>0)this.options.tiffXres=$.xres;else throw q.invalidParameterError("xres","number greater than zero",$.xres);if(q.defined($.yres))if(q.number($.yres)&&$.yres>0)this.options.tiffYres=$.yres;else throw q.invalidParameterError("yres","number greater than zero",$.yres);if(q.defined($.compression))if(q.string($.compression)&&q.inArray($.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=$.compression;else throw q.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",$.compression);if(q.defined($.bigtiff))this._setBooleanOption("tiffBigtiff",$.bigtiff);if(q.defined($.predictor))if(q.string($.predictor)&&q.inArray($.predictor,["none","horizontal","float"]))this.options.tiffPredictor=$.predictor;else throw q.invalidParameterError("predictor","one of: none, horizontal, float",$.predictor);if(q.defined($.resolutionUnit))if(q.string($.resolutionUnit)&&q.inArray($.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=$.resolutionUnit;else throw q.invalidParameterError("resolutionUnit","one of: inch, cm",$.resolutionUnit)}return this._updateFormatOut("tiff",$)}function f7($){return this.heif({...$,compression:"av1"})}function b7($){if(q.object($)){if(q.string($.compression)&&q.inArray($.compression,["av1","hevc"]))this.options.heifCompression=$.compression;else throw q.invalidParameterError("compression","one of: av1, hevc",$.compression);if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.heifQuality=$.quality;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);if(q.defined($.lossless))if(q.bool($.lossless))this.options.heifLossless=$.lossless;else throw q.invalidParameterError("lossless","boolean",$.lossless);if(q.defined($.effort))if(q.integer($.effort)&&q.inRange($.effort,0,9))this.options.heifEffort=$.effort;else throw q.invalidParameterError("effort","integer between 0 and 9",$.effort);if(q.defined($.chromaSubsampling))if(q.string($.chromaSubsampling)&&q.inArray($.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=$.chromaSubsampling;else throw q.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",$.chromaSubsampling);if(q.defined($.bitdepth))if(q.integer($.bitdepth)&&q.inArray($.bitdepth,[8,10,12])){if($.bitdepth!==8&&this.constructor.versions.heif)throw q.invalidParameterError("bitdepth when using prebuilt binaries",8,$.bitdepth);this.options.heifBitdepth=$.bitdepth}else throw q.invalidParameterError("bitdepth","8, 10 or 12",$.bitdepth)}else throw q.invalidParameterError("options","Object",$);return this._updateFormatOut("heif",$)}function g7($){if(q.object($)){if(q.defined($.quality))if(q.integer($.quality)&&q.inRange($.quality,1,100))this.options.jxlDistance=$.quality>=30?0.1+(100-$.quality)*0.09:0.017666666666666667*$.quality*$.quality-1.15*$.quality+25;else throw q.invalidParameterError("quality","integer between 1 and 100",$.quality);else if(q.defined($.distance))if(q.number($.distance)&&q.inRange($.distance,0,15))this.options.jxlDistance=$.distance;else throw q.invalidParameterError("distance","number between 0.0 and 15.0",$.distance);if(q.defined($.decodingTier))if(q.integer($.decodingTier)&&q.inRange($.decodingTier,0,4))this.options.jxlDecodingTier=$.decodingTier;else throw q.invalidParameterError("decodingTier","integer between 0 and 4",$.decodingTier);if(q.defined($.lossless))if(q.bool($.lossless))this.options.jxlLossless=$.lossless;else throw q.invalidParameterError("lossless","boolean",$.lossless);if(q.defined($.effort))if(q.integer($.effort)&&q.inRange($.effort,1,9))this.options.jxlEffort=$.effort;else throw q.invalidParameterError("effort","integer between 1 and 9",$.effort)}return B2($,this.options),this._updateFormatOut("jxl",$)}function d7($){if(q.object($)){if(q.defined($.depth))if(q.string($.depth)&&q.inArray($.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=$.depth;else throw q.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",$.depth)}return this._updateFormatOut("raw")}function u7($){if(q.object($)){if(q.defined($.size))if(q.integer($.size)&&q.inRange($.size,1,8192))this.options.tileSize=$.size;else throw q.invalidParameterError("size","integer between 1 and 8192",$.size);if(q.defined($.overlap))if(q.integer($.overlap)&&q.inRange($.overlap,0,8192)){if($.overlap>this.options.tileSize)throw q.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,$.overlap);this.options.tileOverlap=$.overlap}else throw q.invalidParameterError("overlap","integer between 0 and 8192",$.overlap);if(q.defined($.container))if(q.string($.container)&&q.inArray($.container,["fs","zip"]))this.options.tileContainer=$.container;else throw q.invalidParameterError("container","one of: fs, zip",$.container);if(q.defined($.layout))if(q.string($.layout)&&q.inArray($.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=$.layout;else throw q.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",$.layout);if(q.defined($.angle))if(q.integer($.angle)&&!($.angle%90))this.options.tileAngle=$.angle;else throw q.invalidParameterError("angle","positive/negative multiple of 90",$.angle);if(this._setBackgroundColourOption("tileBackground",$.background),q.defined($.depth))if(q.string($.depth)&&q.inArray($.depth,["onepixel","onetile","one"]))this.options.tileDepth=$.depth;else throw q.invalidParameterError("depth","one of: onepixel, onetile, one",$.depth);if(q.defined($.skipBlanks))if(q.integer($.skipBlanks)&&q.inRange($.skipBlanks,-1,65535))this.options.tileSkipBlanks=$.skipBlanks;else throw q.invalidParameterError("skipBlanks","integer between -1 and 255/65535",$.skipBlanks);else if(q.defined($.layout)&&$.layout==="google")this.options.tileSkipBlanks=5;let J=q.bool($.center)?$.center:$.centre;if(q.defined(J))this._setBooleanOption("tileCentre",J);if(q.defined($.id))if(q.string($.id))this.options.tileId=$.id;else throw q.invalidParameterError("id","string",$.id);if(q.defined($.basename))if(q.string($.basename))this.options.tileBasename=$.basename;else throw q.invalidParameterError("basename","string",$.basename)}if(q.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw q.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function m7($){if(!q.plainObject($))throw q.invalidParameterError("options","object",$);if(q.integer($.seconds)&&q.inRange($.seconds,0,3600))this.options.timeoutSeconds=$.seconds;else throw q.invalidParameterError("seconds","integer between 0 and 3600",$.seconds);return this}function l7($,J){if(!(q.object(J)&&J.force===!1))this.options.formatOut=$;return this}function c7($,J){if(q.bool(J))this.options[$]=J;else throw q.invalidParameterError($,"boolean",J)}function r7(){if(!this.options.streamOut){this.options.streamOut=!0;let $=Error();this._pipeline(void 0,$)}}function a7($,J){if(typeof $==="function"){if(this._isStreamInput())this.on("finish",()=>{this._flattenBufferIn(),u0.pipeline(this.options,(U,H,Q)=>{if(U)$(q.nativeError(U,J));else $(null,H,Q)})});else u0.pipeline(this.options,(U,H,Q)=>{if(U)$(q.nativeError(U,J));else $(null,H,Q)});return this}else if(this.options.streamOut){if(this._isStreamInput()){if(this.once("finish",()=>{this._flattenBufferIn(),u0.pipeline(this.options,(U,H,Q)=>{if(U)this.emit("error",q.nativeError(U,J));else this.emit("info",Q),this.push(H);this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished)this.emit("finish")}else u0.pipeline(this.options,(U,H,Q)=>{if(U)this.emit("error",q.nativeError(U,J));else this.emit("info",Q),this.push(H);this.push(null),this.on("end",()=>this.emit("close"))});return this}else if(this._isStreamInput())return new Promise((U,H)=>{this.once("finish",()=>{this._flattenBufferIn(),u0.pipeline(this.options,(Q,W,Z)=>{if(Q)H(q.nativeError(Q,J));else if(this.options.resolveWithObject)U({data:W,info:Z});else U(W)})})});else return new Promise((U,H)=>{u0.pipeline(this.options,(Q,W,Z)=>{if(Q)H(q.nativeError(Q,J));else if(this.options.resolveWithObject)U({data:W,info:Z});else U(W)})})}N6.exports=($)=>{Object.assign($.prototype,{toFile:E7,toBuffer:j7,keepExif:T7,withExif:z7,withExifMerge:L7,keepIccProfile:D7,withIccProfile:w7,keepXmp:F7,withXmp:M7,keepMetadata:C7,withMetadata:_7,toFormat:S7,jpeg:y7,jp2:k7,png:x7,webp:v7,tiff:h7,avif:f7,heif:b7,jxl:g7,gif:O7,raw:d7,tile:u7,timeout:m7,_updateFormatOut:l7,_setBooleanOption:c7,_read:r7,_pipeline:a7})}});var G6=_((lQ,X6)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var e7=O("events"),_1=P1(),J0=H0(),{runtimePlatformArch:n7}=Z2(),t=t0(),q6=n7(),R2=t.libvipsVersion(),R0=t.format();R0.heif.output.alias=["avif","heic"];R0.jpeg.output.alias=["jpe","jpg"];R0.tiff.output.alias=["tif"];R0.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var s7={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},m0={vips:R2.semver};if(!R2.isGlobal)if(!R2.isWasm)try{m0=O(`@img/sharp-${q6}/versions`)}catch($){try{m0=O(`@img/sharp-libvips-${q6}/versions`)}catch(J){}}else try{m0=(()=>{throw new Error("Cannot require module "+"@img/sharp-wasm32/versions");})()}catch($){}m0.sharp=Q2().version;if(m0.heif&&R0.heif)R0.heif.input.fileSuffix=[".avif"],R0.heif.output.alias=["avif"];function K6($){if(J0.bool($))if($)return t.cache(50,20,100);else return t.cache(0,0,0);else if(J0.object($))return t.cache($.memory,$.files,$.items);else return t.cache()}K6(!0);function p7($){return t.concurrency(J0.integer($)?$:null)}if(_1.familySync()===_1.GLIBC&&!t._isUsingJemalloc())t.concurrency(1);else if(_1.familySync()===_1.MUSL&&t.concurrency()===1024)t.concurrency(O("os").availableParallelism());var i7=new e7.EventEmitter;function t7(){return t.counters()}function o7($){return t.simd(J0.bool($)?$:null)}function $9($){if(J0.object($))if(Array.isArray($.operation)&&$.operation.every(J0.string))t.block($.operation,!0);else throw J0.invalidParameterError("operation","Array<string>",$.operation);else throw J0.invalidParameterError("options","object",$)}function J9($){if(J0.object($))if(Array.isArray($.operation)&&$.operation.every(J0.string))t.block($.operation,!1);else throw J0.invalidParameterError("operation","Array<string>",$.operation);else throw J0.invalidParameterError("options","object",$)}X6.exports=($)=>{$.cache=K6,$.concurrency=p7,$.counters=t7,$.simd=o7,$.format=R0,$.interpolators=s7,$.versions=m0,$.queue=i7,$.block=$9,$.unblock=J9}});var V6=_((rQ,I6)=>{/*!
  Copyright 2013 Lovell Fuller and others.
  SPDX-License-Identifier: Apache-2.0
*/var V0=M4();S4()(V0);h4()(V0);b4()(V0);l4()(V0);J6()(V0);H6()(V0);Y6()(V0);G6()(V0);I6.exports=V0});var E6=_((aQ,R6)=>{R6.exports=B6;B6.sync=H9;var P6=O("fs");function U9($,J){var U=J.pathExt!==void 0?J.pathExt:process.env.PATHEXT;if(!U)return!0;if(U=U.split(";"),U.indexOf("")!==-1)return!0;for(var H=0;H<U.length;H++){var Q=U[H].toLowerCase();if(Q&&$.substr(-Q.length).toLowerCase()===Q)return!0}return!1}function A6($,J,U){if(!$.isSymbolicLink()&&!$.isFile())return!1;return U9(J,U)}function B6($,J,U){P6.stat($,function(H,Q){U(H,H?!1:A6(Q,$,J))})}function H9($,J){return A6(P6.statSync($),$,J)}});var D6=_((eQ,L6)=>{L6.exports=T6;T6.sync=Q9;var j6=O("fs");function T6($,J,U){j6.stat($,function(H,Q){U(H,H?!1:z6(Q,J))})}function Q9($,J){return z6(j6.statSync($),J)}function z6($,J){return $.isFile()&&W9($,J)}function W9($,J){var{mode:U,uid:H,gid:Q}=$,W=J.uid!==void 0?J.uid:process.getuid&&process.getuid(),Z=J.gid!==void 0?J.gid:process.getgid&&process.getgid(),Y=parseInt("100",8),N=parseInt("010",8),K=parseInt("001",8),A=Y|N,j=U&K||U&N&&Q===Z||U&Y&&H===W||U&A&&W===0;return j}});var F6=_((sQ,w6)=>{var nQ=O("fs"),S1;if(process.platform==="win32"||global.TESTING_WINDOWS)S1=E6();else S1=D6();w6.exports=E2;E2.sync=Z9;function E2($,J,U){if(typeof J==="function")U=J,J={};if(!U){if(typeof Promise!=="function")throw new TypeError("callback not provided");return new Promise(function(H,Q){E2($,J||{},function(W,Z){if(W)Q(W);else H(Z)})})}S1($,J||{},function(H,Q){if(H){if(H.code==="EACCES"||J&&J.ignoreErrors)H=null,Q=!1}U(H,Q)})}function Z9($,J){try{return S1.sync($,J||{})}catch(U){if(J&&J.ignoreErrors||U.code==="EACCES")return!1;else throw U}}});var v6=_((pQ,x6)=>{x6.exports=y6;y6.sync=Y9;var j2=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",M6=O("path"),N9=j2?";":":",C6=F6();function _6($){var J=new Error("not found: "+$);return J.code="ENOENT",J}function S6($,J){var U=J.colon||N9,H=J.path||process.env.PATH||"",Q=[""];H=H.split(U);var W="";if(j2){if(H.unshift(process.cwd()),W=J.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM",Q=W.split(U),$.indexOf(".")!==-1&&Q[0]!=="")Q.unshift("")}if($.match(/\//)||j2&&$.match(/\\/))H=[""];return{env:H,ext:Q,extExe:W}}function y6($,J,U){if(typeof J==="function")U=J,J={};var H=S6($,J),Q=H.env,W=H.ext,Z=H.extExe,Y=[];(function N(K,A){if(K===A)if(J.all&&Y.length)return U(null,Y);else return U(_6($));var j=Q[K];if(j.charAt(0)==='"'&&j.slice(-1)==='"')j=j.slice(1,-1);var D=M6.join(j,$);if(!j&&/^\.[\\\/]/.test($))D=$.slice(0,2)+D;(function x(C,z){if(C===z)return N(K+1,A);var T=W[C];C6(D+T,{pathExt:Z},function(h,v){if(!h&&v)if(J.all)Y.push(D+T);else return U(null,D+T);return x(C+1,z)})})(0,W.length)})(0,Q.length)}function Y9($,J){J=J||{};var U=S6($,J),H=U.env,Q=U.ext,W=U.extExe,Z=[];for(var Y=0,N=H.length;Y<N;Y++){var K=H[Y];if(K.charAt(0)==='"'&&K.slice(-1)==='"')K=K.slice(1,-1);var A=M6.join(K,$);if(!K&&/^\.[\\\/]/.test($))A=$.slice(0,2)+A;for(var j=0,D=Q.length;j<D;j++){var x=A+Q[j],C;try{if(C=C6.sync(x,{pathExt:W}),C)if(J.all)Z.push(x);else return x}catch(z){}}}if(J.all&&Z.length)return Z;if(J.nothrow)return null;throw _6($)}});var K0=_((tQ,f6)=>{var iQ=O("child_process").exec,q9=O("os").platform().match(/win(32|64)/),K9=v6(),O6=/\r\n|\r|\n/g,o0=/^\[?(.*?)\]?$/,k6=/[,]/,y1={};function X9($){var J={};$=$.replace(/=\s+/g,"=").trim();var U=$.split(" ");for(var H=0;H<U.length;H++){var Q=U[H].split("=",2),W=Q[0],Z=Q[1];if(typeof Z==="undefined")return null;J[W]=Z}return J}var h6=f6.exports={isWindows:q9,streamRegexp:o0,copy:function($,J){Object.keys($).forEach(function(U){J[U]=$[U]})},args:function(){var $=[],J=function(){if(arguments.length===1&&Array.isArray(arguments[0]))$=$.concat(arguments[0]);else $=$.concat([].slice.call(arguments))};return J.clear=function(){$=[]},J.get=function(){return $},J.find=function(U,H){var Q=$.indexOf(U);if(Q!==-1)return $.slice(Q+1,Q+1+(H||0))},J.remove=function(U,H){var Q=$.indexOf(U);if(Q!==-1)$.splice(Q,(H||0)+1)},J.clone=function(){var U=h6.args();return U($),U},J},makeFilterStrings:function($){return $.map(function(J){if(typeof J==="string")return J;var U="";if(Array.isArray(J.inputs))U+=J.inputs.map(function(H){return H.replace(o0,"[$1]")}).join("");else if(typeof J.inputs==="string")U+=J.inputs.replace(o0,"[$1]");if(U+=J.filter,J.options){if(typeof J.options==="string"||typeof J.options==="number")U+="="+J.options;else if(Array.isArray(J.options))U+="="+J.options.map(function(H){if(typeof H==="string"&&H.match(k6))return"'"+H+"'";else return H}).join(":");else if(Object.keys(J.options).length)U+="="+Object.keys(J.options).map(function(H){var Q=J.options[H];if(typeof Q==="string"&&Q.match(k6))Q="'"+Q+"'";return H+"="+Q}).join(":")}if(Array.isArray(J.outputs))U+=J.outputs.map(function(H){return H.replace(o0,"[$1]")}).join("");else if(typeof J.outputs==="string")U+=J.outputs.replace(o0,"[$1]");return U})},which:function($,J){if($ in y1)return J(null,y1[$]);K9($,function(U,H){if(U)return J(null,y1[$]="");J(null,y1[$]=H)})},timemarkToSeconds:function($){if(typeof $==="number")return $;if($.indexOf(":")===-1&&$.indexOf(".")>=0)return Number($);var J=$.split(":"),U=Number(J.pop());if(J.length)U+=Number(J.pop())*60;if(J.length)U+=Number(J.pop())*3600;return U},extractCodecData:function($,J,U){var H=/Input #[0-9]+, ([^ ]+),/,Q=/Duration\: ([^,]+)/,W=/Audio\: (.*)/,Z=/Video\: (.*)/;if(!("inputStack"in U))U.inputStack=[],U.inputIndex=-1,U.inInput=!1;var{inputStack:Y,inputIndex:N,inInput:K}=U,A,j,D,x;if(A=J.match(H))K=U.inInput=!0,N=U.inputIndex=U.inputIndex+1,Y[N]={format:A[1],audio:"",video:"",duration:""};else if(K&&(j=J.match(Q)))Y[N].duration=j[1];else if(K&&(D=J.match(W)))D=D[1].split(", "),Y[N].audio=D[0],Y[N].audio_details=D;else if(K&&(x=J.match(Z)))x=x[1].split(", "),Y[N].video=x[0],Y[N].video_details=x;else if(/Output #\d+/.test(J))K=U.inInput=!1;else if(/Stream mapping:|Press (\[q\]|ctrl-c) to stop/.test(J))return $.emit.apply($,["codecData"].concat(Y)),!0;return!1},extractProgress:function($,J){var U=X9(J);if(U){var H={frames:parseInt(U.frame,10),currentFps:parseInt(U.fps,10),currentKbps:U.bitrate?parseFloat(U.bitrate.replace("kbits/s","")):0,targetSize:parseInt(U.size||U.Lsize,10),timemark:U.time};if($._ffprobeData&&$._ffprobeData.format&&$._ffprobeData.format.duration){var Q=Number($._ffprobeData.format.duration);if(!isNaN(Q))H.percent=h6.timemarkToSeconds(H.timemark)/Q*100}$.emit("progress",H)}},extractError:function($){return $.split(O6).reduce(function(J,U){if(U.charAt(0)===" "||U.charAt(0)==="[")return[];else return J.push(U),J},[]).join(`
`)},linesRing:function($){var J=[],U=[],H=null,Q=!1,W=$-1;function Z(Y){J.forEach(function(N){N(Y)})}return{callback:function(Y){U.forEach(function(N){Y(N)}),J.push(Y)},append:function(Y){if(Q)return;if(Y instanceof Buffer)Y=""+Y;if(!Y||Y.length===0)return;var N=Y.split(O6);if(N.length===1)if(H!==null)H=H+N.shift();else H=N.shift();else{if(H!==null)H=H+N.shift(),Z(H),U.push(H);if(H=N.pop(),N.forEach(function(K){Z(K),U.push(K)}),W>-1&&U.length>W)U.splice(0,U.length-W)}},get:function(){if(H!==null)return U.concat([H]).join(`
`);else return U.join(`
`)},close:function(){if(Q)return;if(H!==null){if(Z(H),U.push(H),W>-1&&U.length>W)U.shift();H=null}Q=!0}}}}});var g6=_((oQ,b6)=>{var G9=K0();b6.exports=function($){$.mergeAdd=$.addInput=$.input=function(J){var U=!1,H=!1;if(typeof J!=="string"){if(!("readable"in J)||!J.readable)throw new Error("Invalid input");var Q=this._inputs.some(function(Z){return Z.isStream});if(Q)throw new Error("Only one input stream is supported");H=!0,J.pause()}else{var W=J.match(/^([a-z]{2,}):/i);U=!W||W[0]==="file"}return this._inputs.push(this._currentInput={source:J,isFile:U,isStream:H,options:G9.args()}),this},$.withInputFormat=$.inputFormat=$.fromFormat=function(J){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-f",J),this},$.withInputFps=$.withInputFPS=$.withFpsInput=$.withFPSInput=$.inputFPS=$.inputFps=$.fpsInput=$.FPSInput=function(J){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-r",J),this},$.nativeFramerate=$.withNativeFramerate=$.native=function(){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-re"),this},$.setStartTime=$.seekInput=function(J){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-ss",J),this},$.loop=function(J){if(!this._currentInput)throw new Error("No input specified");if(this._currentInput.options("-loop","1"),typeof J!=="undefined")this.duration(J);return this}}});var u6=_(($W,d6)=>{var I9=K0();d6.exports=function($){$.withNoAudio=$.noAudio=function(){return this._currentOutput.audio.clear(),this._currentOutput.audioFilters.clear(),this._currentOutput.audio("-an"),this},$.withAudioCodec=$.audioCodec=function(J){return this._currentOutput.audio("-acodec",J),this},$.withAudioBitrate=$.audioBitrate=function(J){return this._currentOutput.audio("-b:a",(""+J).replace(/k?$/,"k")),this},$.withAudioChannels=$.audioChannels=function(J){return this._currentOutput.audio("-ac",J),this},$.withAudioFrequency=$.audioFrequency=function(J){return this._currentOutput.audio("-ar",J),this},$.withAudioQuality=$.audioQuality=function(J){return this._currentOutput.audio("-aq",J),this},$.withAudioFilter=$.withAudioFilters=$.audioFilter=$.audioFilters=function(J){if(arguments.length>1)J=[].slice.call(arguments);if(!Array.isArray(J))J=[J];return this._currentOutput.audioFilters(I9.makeFilterStrings(J)),this}}});var l6=_((JW,m6)=>{var V9=K0();m6.exports=function($){$.withNoVideo=$.noVideo=function(){return this._currentOutput.video.clear(),this._currentOutput.videoFilters.clear(),this._currentOutput.video("-vn"),this},$.withVideoCodec=$.videoCodec=function(J){return this._currentOutput.video("-vcodec",J),this},$.withVideoBitrate=$.videoBitrate=function(J,U){if(J=(""+J).replace(/k?$/,"k"),this._currentOutput.video("-b:v",J),U)this._currentOutput.video("-maxrate",J,"-minrate",J,"-bufsize","3M");return this},$.withVideoFilter=$.withVideoFilters=$.videoFilter=$.videoFilters=function(J){if(arguments.length>1)J=[].slice.call(arguments);if(!Array.isArray(J))J=[J];return this._currentOutput.videoFilters(V9.makeFilterStrings(J)),this},$.withOutputFps=$.withOutputFPS=$.withFpsOutput=$.withFPSOutput=$.withFps=$.withFPS=$.outputFPS=$.outputFps=$.fpsOutput=$.FPSOutput=$.fps=$.FPS=function(J){return this._currentOutput.video("-r",J),this},$.takeFrames=$.withFrames=$.frames=function(J){return this._currentOutput.video("-vframes",J),this}}});var a6=_((UW,r6)=>{function c6($,J,U,H){return[{filter:"scale",options:{w:"if(gt(a,"+U+"),"+$+",trunc("+J+"*a/2)*2)",h:"if(lt(a,"+U+"),"+J+",trunc("+$+"/a/2)*2)"}},{filter:"pad",options:{w:$,h:J,x:"if(gt(a,"+U+"),0,("+$+"-iw)/2)",y:"if(lt(a,"+U+"),0,("+J+"-ih)/2)",color:H}}]}function T2($,J,U){var H=$.sizeData=$.sizeData||{};if(H[J]=U,!("size"in H))return[];var Q=H.size.match(/([0-9]+)x([0-9]+)/),W=H.size.match(/([0-9]+)x\?/),Z=H.size.match(/\?x([0-9]+)/),Y=H.size.match(/\b([0-9]{1,3})%/),N,K,A;if(Y){var j=Number(Y[1])/100;return[{filter:"scale",options:{w:"trunc(iw*"+j+"/2)*2",h:"trunc(ih*"+j+"/2)*2"}}]}else if(Q)if(N=Math.round(Number(Q[1])/2)*2,K=Math.round(Number(Q[2])/2)*2,A=N/K,H.pad)return c6(N,K,A,H.pad);else return[{filter:"scale",options:{w:N,h:K}}];else if(W||Z)if("aspect"in H)if(N=W?W[1]:Math.round(Number(Z[1])*H.aspect),K=Z?Z[1]:Math.round(Number(W[1])/H.aspect),N=Math.round(N/2)*2,K=Math.round(K/2)*2,H.pad)return c6(N,K,H.aspect,H.pad);else return[{filter:"scale",options:{w:N,h:K}}];else if(W)return[{filter:"scale",options:{w:Math.round(Number(W[1])/2)*2,h:"trunc(ow/a/2)*2"}}];else return[{filter:"scale",options:{w:"trunc(oh*a/2)*2",h:Math.round(Number(Z[1])/2)*2}}];else throw new Error("Invalid size specified: "+H.size)}r6.exports=function($){$.keepPixelAspect=$.keepDisplayAspect=$.keepDisplayAspectRatio=$.keepDAR=function(){return this.videoFilters([{filter:"scale",options:{w:"if(gt(sar,1),iw*sar,iw)",h:"if(lt(sar,1),ih/sar,ih)"}},{filter:"setsar",options:"1"}])},$.withSize=$.setSize=$.size=function(J){var U=T2(this._currentOutput,"size",J);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(U),this},$.withAspect=$.withAspectRatio=$.setAspect=$.setAspectRatio=$.aspect=$.aspectRatio=function(J){var U=Number(J);if(isNaN(U)){var H=J.match(/^(\d+):(\d+)$/);if(H)U=Number(H[1])/Number(H[2]);else throw new Error("Invalid aspect ratio: "+J)}var Q=T2(this._currentOutput,"aspect",U);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(Q),this},$.applyAutopadding=$.applyAutoPadding=$.applyAutopad=$.applyAutoPad=$.withAutopadding=$.withAutoPadding=$.withAutopad=$.withAutoPad=$.autoPad=$.autopad=function(J,U){if(typeof J==="string")U=J,J=!0;if(typeof J==="undefined")J=!0;var H=T2(this._currentOutput,"pad",J?U||"black":!1);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(H),this}}});var s6=_((HW,n6)=>{var e6=K0();n6.exports=function($){$.addOutput=$.output=function(J,U){var H=!1;if(!J&&this._currentOutput)throw new Error("Invalid output");if(J&&typeof J!=="string"){if(!("writable"in J)||!J.writable)throw new Error("Invalid output")}else if(typeof J==="string"){var Q=J.match(/^([a-z]{2,}):/i);H=!Q||Q[0]==="file"}if(J&&!("target"in this._currentOutput))this._currentOutput.target=J,this._currentOutput.isFile=H,this._currentOutput.pipeopts=U||{};else{if(J&&typeof J!=="string"){var W=this._outputs.some(function(Y){return typeof Y.target!=="string"});if(W)throw new Error("Only one output stream is supported")}this._outputs.push(this._currentOutput={target:J,isFile:H,flags:{},pipeopts:U||{}});var Z=this;if(["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(Y){Z._currentOutput[Y]=e6.args()}),!J)delete this._currentOutput.target}return this},$.seekOutput=$.seek=function(J){return this._currentOutput.options("-ss",J),this},$.withDuration=$.setDuration=$.duration=function(J){return this._currentOutput.options("-t",J),this},$.toFormat=$.withOutputFormat=$.outputFormat=$.format=function(J){return this._currentOutput.options("-f",J),this},$.map=function(J){return this._currentOutput.options("-map",J.replace(e6.streamRegexp,"[$1]")),this},$.updateFlvMetadata=$.flvmeta=function(){return this._currentOutput.flags.flvmeta=!0,this}}});var i6=_((QW,p6)=>{var z2=K0();p6.exports=function($){$.addInputOption=$.addInputOptions=$.withInputOption=$.withInputOptions=$.inputOption=$.inputOptions=function(J){if(!this._currentInput)throw new Error("No input specified");var U=!0;if(arguments.length>1)J=[].slice.call(arguments),U=!1;if(!Array.isArray(J))J=[J];return this._currentInput.options(J.reduce(function(H,Q){var W=String(Q).split(" ");if(U&&W.length===2)H.push(W[0],W[1]);else H.push(Q);return H},[])),this},$.addOutputOption=$.addOutputOptions=$.addOption=$.addOptions=$.withOutputOption=$.withOutputOptions=$.withOption=$.withOptions=$.outputOption=$.outputOptions=function(J){var U=!0;if(arguments.length>1)J=[].slice.call(arguments),U=!1;if(!Array.isArray(J))J=[J];return this._currentOutput.options(J.reduce(function(H,Q){var W=String(Q).split(" ");if(U&&W.length===2)H.push(W[0],W[1]);else H.push(Q);return H},[])),this},$.filterGraph=$.complexFilter=function(J,U){if(this._complexFilters.clear(),!Array.isArray(J))J=[J];if(this._complexFilters("-filter_complex",z2.makeFilterStrings(J).join(";")),Array.isArray(U)){var H=this;U.forEach(function(Q){H._complexFilters("-map",Q.replace(z2.streamRegexp,"[$1]"))})}else if(typeof U==="string")this._complexFilters("-map",U.replace(z2.streamRegexp,"[$1]"));return this}}});var o6=_((WW,t6)=>{var P9=O("path");t6.exports=function($){$.usingPreset=$.preset=function(J){if(typeof J==="function")J(this);else try{var U=P9.join(this.options.presets,J),H=O(U);if(typeof H.load==="function")H.load(this);else throw new Error("preset "+U+" has no load() function")}catch(Q){throw new Error("preset "+U+" could not be loaded: "+Q.message)}return this}}});var v1=_((NW,x1)=>{(function(){var $={},J,U;if(J=this,J!=null)U=J.async;$.noConflict=function(){return J.async=U,$};function H(V){var G=!1;return function(){if(G)throw new Error("Callback was already called.");G=!0,V.apply(J,arguments)}}var Q=function(V,G){if(V.forEach)return V.forEach(G);for(var P=0;P<V.length;P+=1)G(V[P],P,V)},W=function(V,G){if(V.map)return V.map(G);var P=[];return Q(V,function(B,R,E){P.push(G(B,R,E))}),P},Z=function(V,G,P){if(V.reduce)return V.reduce(G,P);return Q(V,function(B,R,E){P=G(P,B,R,E)}),P},Y=function(V){if(Object.keys)return Object.keys(V);var G=[];for(var P in V)if(V.hasOwnProperty(P))G.push(P);return G};if(typeof process==="undefined"||!process.nextTick)if(typeof setImmediate==="function")$.nextTick=function(V){setImmediate(V)},$.setImmediate=$.nextTick;else $.nextTick=function(V){setTimeout(V,0)},$.setImmediate=$.nextTick;else if($.nextTick=process.nextTick,typeof setImmediate!=="undefined")$.setImmediate=function(V){setImmediate(V)};else $.setImmediate=$.nextTick;$.each=function(V,G,P){if(P=P||function(){},!V.length)return P();var B=0;Q(V,function(R){G(R,H(function(E){if(E)P(E),P=function(){};else if(B+=1,B>=V.length)P(null)}))})},$.forEach=$.each,$.eachSeries=function(V,G,P){if(P=P||function(){},!V.length)return P();var B=0,R=function(){G(V[B],function(E){if(E)P(E),P=function(){};else if(B+=1,B>=V.length)P(null);else R()})};R()},$.forEachSeries=$.eachSeries,$.eachLimit=function(V,G,P,B){var R=N(G);R.apply(null,[V,P,B])},$.forEachLimit=$.eachLimit;var N=function(V){return function(G,P,B){if(B=B||function(){},!G.length||V<=0)return B();var R=0,E=0,L=0;(function y(){if(R>=G.length)return B();while(L<V&&E<G.length)E+=1,L+=1,P(G[E-1],function(d){if(d)B(d),B=function(){};else if(R+=1,L-=1,R>=G.length)B();else y()})})()}},K=function(V){return function(){var G=Array.prototype.slice.call(arguments);return V.apply(null,[$.each].concat(G))}},A=function(V,G){return function(){var P=Array.prototype.slice.call(arguments);return G.apply(null,[N(V)].concat(P))}},j=function(V){return function(){var G=Array.prototype.slice.call(arguments);return V.apply(null,[$.eachSeries].concat(G))}},D=function(V,G,P,B){var R=[];G=W(G,function(E,L){return{index:L,value:E}}),V(G,function(E,L){P(E.value,function(y,d){R[E.index]=d,L(y)})},function(E){B(E,R)})};$.map=K(D),$.mapSeries=j(D),$.mapLimit=function(V,G,P,B){return x(G)(V,P,B)};var x=function(V){return A(V,D)};$.reduce=function(V,G,P,B){$.eachSeries(V,function(R,E){P(G,R,function(L,y){G=y,E(L)})},function(R){B(R,G)})},$.inject=$.reduce,$.foldl=$.reduce,$.reduceRight=function(V,G,P,B){var R=W(V,function(E){return E}).reverse();$.reduce(R,G,P,B)},$.foldr=$.reduceRight;var C=function(V,G,P,B){var R=[];G=W(G,function(E,L){return{index:L,value:E}}),V(G,function(E,L){P(E.value,function(y){if(y)R.push(E);L()})},function(E){B(W(R.sort(function(L,y){return L.index-y.index}),function(L){return L.value}))})};$.filter=K(C),$.filterSeries=j(C),$.select=$.filter,$.selectSeries=$.filterSeries;var z=function(V,G,P,B){var R=[];G=W(G,function(E,L){return{index:L,value:E}}),V(G,function(E,L){P(E.value,function(y){if(!y)R.push(E);L()})},function(E){B(W(R.sort(function(L,y){return L.index-y.index}),function(L){return L.value}))})};$.reject=K(z),$.rejectSeries=j(z);var T=function(V,G,P,B){V(G,function(R,E){P(R,function(L){if(L)B(R),B=function(){};else E()})},function(R){B()})};$.detect=K(T),$.detectSeries=j(T),$.some=function(V,G,P){$.each(V,function(B,R){G(B,function(E){if(E)P(!0),P=function(){};R()})},function(B){P(!1)})},$.any=$.some,$.every=function(V,G,P){$.each(V,function(B,R){G(B,function(E){if(!E)P(!1),P=function(){};R()})},function(B){P(!0)})},$.all=$.every,$.sortBy=function(V,G,P){$.map(V,function(B,R){G(B,function(E,L){if(E)R(E);else R(null,{value:B,criteria:L})})},function(B,R){if(B)return P(B);else{var E=function(L,y){var d=L.criteria,r=y.criteria;return d<r?-1:d>r?1:0};P(null,W(R.sort(E),function(L){return L.value}))}})},$.auto=function(V,G){G=G||function(){};var P=Y(V);if(!P.length)return G(null);var B={},R=[],E=function(d){R.unshift(d)},L=function(d){for(var r=0;r<R.length;r+=1)if(R[r]===d){R.splice(r,1);return}},y=function(){Q(R.slice(0),function(d){d()})};E(function(){if(Y(B).length===P.length)G(null,B),G=function(){}}),Q(P,function(d){var r=V[d]instanceof Function?[V[d]]:V[d],z0=function(U1){var L0=Array.prototype.slice.call(arguments,1);if(L0.length<=1)L0=L0[0];if(U1){var k1={};Q(Y(B),function(_2){k1[_2]=B[_2]}),k1[d]=L0,G(U1,k1),G=function(){}}else B[d]=L0,$.setImmediate(y)},j5=r.slice(0,Math.abs(r.length-1))||[],M2=function(){return Z(j5,function(U1,L0){return U1&&B.hasOwnProperty(L0)},!0)&&!B.hasOwnProperty(d)};if(M2())r[r.length-1](z0,B);else{var C2=function(){if(M2())L(C2),r[r.length-1](z0,B)};E(C2)}})},$.waterfall=function(V,G){if(G=G||function(){},V.constructor!==Array){var P=new Error("First argument to waterfall must be an array of functions");return G(P)}if(!V.length)return G();var B=function(R){return function(E){if(E)G.apply(null,arguments),G=function(){};else{var L=Array.prototype.slice.call(arguments,1),y=R.next();if(y)L.push(B(y));else L.push(G);$.setImmediate(function(){R.apply(null,L)})}}};B($.iterator(V))()};var h=function(V,G,P){if(P=P||function(){},G.constructor===Array)V.map(G,function(R,E){if(R)R(function(L){var y=Array.prototype.slice.call(arguments,1);if(y.length<=1)y=y[0];E.call(null,L,y)})},P);else{var B={};V.each(Y(G),function(R,E){G[R](function(L){var y=Array.prototype.slice.call(arguments,1);if(y.length<=1)y=y[0];B[R]=y,E(L)})},function(R){P(R,B)})}};$.parallel=function(V,G){h({map:$.map,each:$.each},V,G)},$.parallelLimit=function(V,G,P){h({map:x(G),each:N(G)},V,P)},$.series=function(V,G){if(G=G||function(){},V.constructor===Array)$.mapSeries(V,function(B,R){if(B)B(function(E){var L=Array.prototype.slice.call(arguments,1);if(L.length<=1)L=L[0];R.call(null,E,L)})},G);else{var P={};$.eachSeries(Y(V),function(B,R){V[B](function(E){var L=Array.prototype.slice.call(arguments,1);if(L.length<=1)L=L[0];P[B]=L,R(E)})},function(B){G(B,P)})}},$.iterator=function(V){var G=function(P){var B=function(){if(V.length)V[P].apply(null,arguments);return B.next()};return B.next=function(){return P<V.length-1?G(P+1):null},B};return G(0)},$.apply=function(V){var G=Array.prototype.slice.call(arguments,1);return function(){return V.apply(null,G.concat(Array.prototype.slice.call(arguments)))}};var v=function(V,G,P,B){var R=[];V(G,function(E,L){P(E,function(y,d){R=R.concat(d||[]),L(y)})},function(E){B(E,R)})};$.concat=K(v),$.concatSeries=j(v),$.whilst=function(V,G,P){if(V())G(function(B){if(B)return P(B);$.whilst(V,G,P)});else P()},$.doWhilst=function(V,G,P){V(function(B){if(B)return P(B);if(G())$.doWhilst(V,G,P);else P()})},$.until=function(V,G,P){if(!V())G(function(B){if(B)return P(B);$.until(V,G,P)});else P()},$.doUntil=function(V,G,P){V(function(B){if(B)return P(B);if(!G())$.doUntil(V,G,P);else P()})},$.queue=function(V,G){if(G===void 0)G=1;function P(E,L,y,d){if(L.constructor!==Array)L=[L];Q(L,function(r){var z0={data:r,callback:typeof d==="function"?d:null};if(y)E.tasks.unshift(z0);else E.tasks.push(z0);if(E.saturated&&E.tasks.length===G)E.saturated();$.setImmediate(E.process)})}var B=0,R={tasks:[],concurrency:G,saturated:null,empty:null,drain:null,push:function(E,L){P(R,E,!1,L)},unshift:function(E,L){P(R,E,!0,L)},process:function(){if(B<R.concurrency&&R.tasks.length){var E=R.tasks.shift();if(R.empty&&R.tasks.length===0)R.empty();B+=1;var L=function(){if(B-=1,E.callback)E.callback.apply(E,arguments);if(R.drain&&R.tasks.length+B===0)R.drain();R.process()},y=H(L);V(E.data,y)}},length:function(){return R.tasks.length},running:function(){return B}};return R},$.cargo=function(V,G){var P=!1,B=[],R={tasks:B,payload:G,saturated:null,empty:null,drain:null,push:function(E,L){if(E.constructor!==Array)E=[E];Q(E,function(y){if(B.push({data:y,callback:typeof L==="function"?L:null}),R.saturated&&B.length===G)R.saturated()}),$.setImmediate(R.process)},process:function E(){if(P)return;if(B.length===0){if(R.drain)R.drain();return}var L=typeof G==="number"?B.splice(0,G):B.splice(0),y=W(L,function(d){return d.data});if(R.empty)R.empty();P=!0,V(y,function(){P=!1;var d=arguments;Q(L,function(r){if(r.callback)r.callback.apply(null,d)}),E()})},length:function(){return B.length},running:function(){return P}};return R};var b=function(V){return function(G){var P=Array.prototype.slice.call(arguments,1);G.apply(null,P.concat([function(B){var R=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(B){if(console.error)console.error(B)}else if(console[V])Q(R,function(E){console[V](E)})}}]))}};$.log=b("log"),$.dir=b("dir"),$.memoize=function(V,G){var P={},B={};G=G||function(E){return E};var R=function(){var E=Array.prototype.slice.call(arguments),L=E.pop(),y=G.apply(null,E);if(y in P)L.apply(null,P[y]);else if(y in B)B[y].push(L);else B[y]=[L],V.apply(null,E.concat([function(){P[y]=arguments;var d=B[y];delete B[y];for(var r=0,z0=d.length;r<z0;r++)d[r].apply(null,arguments)}]))};return R.memo=P,R.unmemoized=V,R},$.unmemoize=function(V){return function(){return(V.unmemoized||V).apply(null,arguments)}},$.times=function(V,G,P){var B=[];for(var R=0;R<V;R++)B.push(R);return $.map(B,G,P)},$.timesSeries=function(V,G,P){var B=[];for(var R=0;R<V;R++)B.push(R);return $.mapSeries(B,G,P)},$.compose=function(){var V=Array.prototype.reverse.call(arguments);return function(){var G=this,P=Array.prototype.slice.call(arguments),B=P.pop();$.reduce(V,P,function(R,E,L){E.apply(G,R.concat([function(){var y=arguments[0],d=Array.prototype.slice.call(arguments,1);L(y,d)}]))},function(R,E){B.apply(G,[R].concat(E))})}};var f=function(V,G){var P=function(){var R=this,E=Array.prototype.slice.call(arguments),L=E.pop();return V(G,function(y,d){y.apply(R,E.concat([d]))},L)};if(arguments.length>2){var B=Array.prototype.slice.call(arguments,2);return P.apply(this,B)}else return P};if($.applyEach=K(f),$.applyEachSeries=j(f),$.forever=function(V,G){function P(B){if(B){if(G)return G(B);throw B}V(P)}P()},typeof define!=="undefined"&&define.amd)define([],function(){return $});else if(typeof x1!=="undefined"&&x1.exports)x1.exports=$;else J.async=$})()});var H5=_((KW,U5)=>{var L2=O("child_process").spawn,YW=O("path"),qW=O("fs"),$5=v1(),E0=K0();function J5($){if($._inputs[0].isStream)return;$.ffprobe(0,function(U,H){$._ffprobeData=H})}U5.exports=function($){$._spawnFfmpeg=function(J,U,H,Q){if(typeof U==="function")Q=H,H=U,U={};if(typeof Q==="undefined")Q=H,H=function(){};var W="stdoutLines"in U?U.stdoutLines:this.options.stdoutLines;this._getFfmpegPath(function(Z,Y){if(Z)return Q(Z);else if(!Y||Y.length===0)return Q(new Error("Cannot find ffmpeg"));if(U.niceness&&U.niceness!==0&&!E0.isWindows)J.unshift("-n",U.niceness,Y),Y="nice";var N=E0.linesRing(W),K=!1,A=E0.linesRing(W),j=!1,D=L2(Y,J,U);if(D.stderr)D.stderr.setEncoding("utf8");D.on("error",function(T){Q(T)});var x=null;function C(T){if(T)x=T;if(z&&(K||!U.captureStdout)&&j)Q(x,N,A)}var z=!1;if(D.on("exit",function(T,h){if(z=!0,h)C(new Error("ffmpeg was killed with signal "+h));else if(T)C(new Error("ffmpeg exited with code "+T));else C()}),U.captureStdout)D.stdout.on("data",function(T){N.append(T)}),D.stdout.on("close",function(){N.close(),K=!0,C()});D.stderr.on("data",function(T){A.append(T)}),D.stderr.on("close",function(){A.close(),j=!0,C()}),H(D,N,A)})},$._getArguments=function(){var J=this._complexFilters.get(),U=this._outputs.some(function(H){return H.isFile});return[].concat(this._inputs.reduce(function(H,Q){var W=typeof Q.source==="string"?Q.source:"pipe:0";return H.concat(Q.options.get(),["-i",W])},[]),this._global.get(),U?["-y"]:[],J,this._outputs.reduce(function(H,Q){var W=E0.makeFilterStrings(Q.sizeFilters.get()),Z=Q.audioFilters.get(),Y=Q.videoFilters.get().concat(W),N;if(!Q.target)N=[];else if(typeof Q.target==="string")N=[Q.target];else N=["pipe:1"];return H.concat(Q.audio.get(),Z.length?["-filter:a",Z.join(",")]:[],Q.video.get(),Y.length?["-filter:v",Y.join(",")]:[],Q.options.get(),N)},[]))},$._prepare=function(J,U){var H=this;if($5.waterfall([function(Q){H._checkCapabilities(Q)},function(Q){if(!U)return Q();H.ffprobe(0,function(W,Z){if(!W)H._ffprobeData=Z;Q()})},function(Q){var W=H._outputs.some(function(Z){if(Z.flags.flvmeta&&!Z.isFile)H.logger.warn("Updating flv metadata is only supported for files"),Z.flags.flvmeta=!1;return Z.flags.flvmeta});if(W)H._getFlvtoolPath(function(Z){Q(Z)});else Q()},function(Q){var W;try{W=H._getArguments()}catch(Z){return Q(Z)}Q(null,W)},function(Q,W){H.availableEncoders(function(Z,Y){for(var N=0;N<Q.length;N++)if(Q[N]==="-acodec"||Q[N]==="-vcodec"){if(N++,Q[N]in Y&&Y[Q[N]].experimental)Q.splice(N+1,0,"-strict","experimental"),N+=2}W(null,Q)})}],J),!U)if(this.listeners("progress").length>0)J5(this);else this.once("newListener",function(Q){if(Q==="progress")J5(this)})},$.exec=$.execute=$.run=function(){var J=this,U=this._outputs.some(function(Y){return"target"in Y});if(!U)throw new Error("No output specified");var H=this._outputs.filter(function(Y){return typeof Y.target!=="string"})[0],Q=this._inputs.filter(function(Y){return typeof Y.source!=="string"})[0],W=!1;function Z(Y,N,K){if(!W)if(W=!0,Y)J.emit("error",Y,N,K);else J.emit("end",N,K)}return J._prepare(function(Y,N){if(Y)return Z(Y);J._spawnFfmpeg(N,{captureStdout:!H,niceness:J.options.niceness,cwd:J.options.cwd,windowsHide:!0},function K(A,j,D){if(J.ffmpegProc=A,J.emit("start","ffmpeg "+N.join(" ")),Q)Q.source.on("error",function(z){var T=new Error("Input stream error: "+z.message);T.inputStreamError=z,Z(T),A.kill()}),Q.source.resume(),Q.source.pipe(A.stdin),A.stdin.on("error",function(){});if(J.options.timeout)J.processTimer=setTimeout(function(){var z="process ran into a timeout ("+J.options.timeout+"s)";Z(new Error(z),j.get(),D.get()),A.kill()},J.options.timeout*1000);if(H)A.stdout.pipe(H.target,H.pipeopts),H.target.on("close",function(){J.logger.debug("Output stream closed, scheduling kill for ffmpeg process"),setTimeout(function(){Z(new Error("Output stream closed")),A.kill()},20)}),H.target.on("error",function(z){J.logger.debug("Output stream error, killing ffmpeg process");var T=new Error("Output stream error: "+z.message);T.outputStreamError=z,Z(T,j.get(),D.get()),A.kill("SIGKILL")});if(D){if(J.listeners("stderr").length)D.callback(function(z){J.emit("stderr",z)});if(J.listeners("codecData").length){var x=!1,C={};D.callback(function(z){if(!x)x=E0.extractCodecData(J,z,C)})}if(J.listeners("progress").length)D.callback(function(z){E0.extractProgress(J,z)})}},function K(A,j,D){if(clearTimeout(J.processTimer),delete J.ffmpegProc,A){if(A.message.match(/ffmpeg exited with code/))A.message+=": "+E0.extractError(D.get());Z(A,j.get(),D.get())}else{var x=J._outputs.filter(function(C){return C.flags.flvmeta});if(x.length)J._getFlvtoolPath(function(C,z){if(C)return Z(C);$5.each(x,function(T,h){L2(z,["-U",T.target],{windowsHide:!0}).on("error",function(v){h(new Error("Error running "+z+" on "+T.target+": "+v.message))}).on("exit",function(v,b){if(v!==0||b)h(new Error(z+" "+(b?"received signal "+b:"exited with code "+v))+" when running on "+T.target);else h()})},function(T){if(T)Z(T);else Z(null,j.get(),D.get())})});else Z(null,j.get(),D.get())}})}),this},$.renice=function(J){if(!E0.isWindows){if(J=J||0,J<-20||J>20)this.logger.warn("Invalid niceness value: "+J+", must be between -20 and 20");if(J=Math.min(20,Math.max(-20,J)),this.options.niceness=J,this.ffmpegProc){var U=this.logger,H=this.ffmpegProc.pid,Q=L2("renice",[J,"-p",H],{windowsHide:!0});Q.on("error",function(W){U.warn("could not renice process "+H+": "+W.message)}),Q.on("exit",function(W,Z){if(Z)U.warn("could not renice process "+H+": renice was killed by signal "+Z);else if(W)U.warn("could not renice process "+H+": renice exited with "+W);else U.info("successfully reniced process "+H+" to "+J+" niceness")})}}return this},$.kill=function(J){if(!this.ffmpegProc)this.logger.warn("No running ffmpeg process, cannot send signal");else this.ffmpegProc.kill(J||"SIGKILL");return this}}});var Z5=_((XW,W5)=>{var $1=O("fs"),Q5=O("path"),O1=v1(),j0=K0(),A9=/^\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/,B9=/^\s*([D\.])([E\.])([VAS])([I\.])([L\.])([S\.]) ([^ ]+) +(.*)$/,R9=/\(encoders:([^\)]+)\)/,E9=/\(decoders:([^\)]+)\)/,j9=/^\s*([VAS\.])([F\.])([S\.])([X\.])([B\.])([D\.]) ([^ ]+) +(.*)$/,T9=/^\s*([D ])([E ])\s+([^ ]+)\s+(.*)$/,D2=/\r\n|\r|\n/,z9=/^(?: [T\.][S\.][C\.] )?([^ ]+) +(AA?|VV?|\|)->(AA?|VV?|\|) +(.*)$/,l={};W5.exports=function($){$.setFfmpegPath=function(J){return l.ffmpegPath=J,this},$.setFfprobePath=function(J){return l.ffprobePath=J,this},$.setFlvtoolPath=function(J){return l.flvtoolPath=J,this},$._forgetPaths=function(){delete l.ffmpegPath,delete l.ffprobePath,delete l.flvtoolPath},$._getFfmpegPath=function(J){if("ffmpegPath"in l)return J(null,l.ffmpegPath);O1.waterfall([function(U){if(process.env.FFMPEG_PATH)$1.exists(process.env.FFMPEG_PATH,function(H){if(H)U(null,process.env.FFMPEG_PATH);else U(null,"")});else U(null,"")},function(U,H){if(U.length)return H(null,U);j0.which("ffmpeg",function(Q,W){H(Q,W)})}],function(U,H){if(U)J(U);else J(null,l.ffmpegPath=H||"")})},$._getFfprobePath=function(J){var U=this;if("ffprobePath"in l)return J(null,l.ffprobePath);O1.waterfall([function(H){if(process.env.FFPROBE_PATH)$1.exists(process.env.FFPROBE_PATH,function(Q){H(null,Q?process.env.FFPROBE_PATH:"")});else H(null,"")},function(H,Q){if(H.length)return Q(null,H);j0.which("ffprobe",function(W,Z){Q(W,Z)})},function(H,Q){if(H.length)return Q(null,H);U._getFfmpegPath(function(W,Z){if(W)Q(W);else if(Z.length){var Y=j0.isWindows?"ffprobe.exe":"ffprobe",N=Q5.join(Q5.dirname(Z),Y);$1.exists(N,function(K){Q(null,K?N:"")})}else Q(null,"")})}],function(H,Q){if(H)J(H);else J(null,l.ffprobePath=Q||"")})},$._getFlvtoolPath=function(J){if("flvtoolPath"in l)return J(null,l.flvtoolPath);O1.waterfall([function(U){if(process.env.FLVMETA_PATH)$1.exists(process.env.FLVMETA_PATH,function(H){U(null,H?process.env.FLVMETA_PATH:"")});else U(null,"")},function(U,H){if(U.length)return H(null,U);if(process.env.FLVTOOL2_PATH)$1.exists(process.env.FLVTOOL2_PATH,function(Q){H(null,Q?process.env.FLVTOOL2_PATH:"")});else H(null,"")},function(U,H){if(U.length)return H(null,U);j0.which("flvmeta",function(Q,W){H(Q,W)})},function(U,H){if(U.length)return H(null,U);j0.which("flvtool2",function(Q,W){H(Q,W)})}],function(U,H){if(U)J(U);else J(null,l.flvtoolPath=H||"")})},$.availableFilters=$.getAvailableFilters=function(J){if("filters"in l)return J(null,l.filters);this._spawnFfmpeg(["-filters"],{captureStdout:!0,stdoutLines:0},function(U,H){if(U)return J(U);var Q=H.get(),W=Q.split(`
`),Z={},Y={A:"audio",V:"video","|":"none"};W.forEach(function(N){var K=N.match(z9);if(K)Z[K[1]]={description:K[4],input:Y[K[2].charAt(0)],multipleInputs:K[2].length>1,output:Y[K[3].charAt(0)],multipleOutputs:K[3].length>1}}),J(null,l.filters=Z)})},$.availableCodecs=$.getAvailableCodecs=function(J){if("codecs"in l)return J(null,l.codecs);this._spawnFfmpeg(["-codecs"],{captureStdout:!0,stdoutLines:0},function(U,H){if(U)return J(U);var Q=H.get(),W=Q.split(D2),Z={};W.forEach(function(Y){var N=Y.match(A9);if(N&&N[7]!=="=")Z[N[7]]={type:{V:"video",A:"audio",S:"subtitle"}[N[3]],description:N[8],canDecode:N[1]==="D",canEncode:N[2]==="E",drawHorizBand:N[4]==="S",directRendering:N[5]==="D",weirdFrameTruncation:N[6]==="T"};if(N=Y.match(B9),N&&N[7]!=="="){var K=Z[N[7]]={type:{V:"video",A:"audio",S:"subtitle"}[N[3]],description:N[8],canDecode:N[1]==="D",canEncode:N[2]==="E",intraFrameOnly:N[4]==="I",isLossy:N[5]==="L",isLossless:N[6]==="S"},A=K.description.match(R9);A=A?A[1].trim().split(" "):[];var j=K.description.match(E9);if(j=j?j[1].trim().split(" "):[],A.length||j.length){var D={};j0.copy(K,D),delete D.canEncode,delete D.canDecode,A.forEach(function(x){Z[x]={},j0.copy(D,Z[x]),Z[x].canEncode=!0}),j.forEach(function(x){if(x in Z)Z[x].canDecode=!0;else Z[x]={},j0.copy(D,Z[x]),Z[x].canDecode=!0})}}}),J(null,l.codecs=Z)})},$.availableEncoders=$.getAvailableEncoders=function(J){if("encoders"in l)return J(null,l.encoders);this._spawnFfmpeg(["-encoders"],{captureStdout:!0,stdoutLines:0},function(U,H){if(U)return J(U);var Q=H.get(),W=Q.split(D2),Z={};W.forEach(function(Y){var N=Y.match(j9);if(N&&N[7]!=="=")Z[N[7]]={type:{V:"video",A:"audio",S:"subtitle"}[N[1]],description:N[8],frameMT:N[2]==="F",sliceMT:N[3]==="S",experimental:N[4]==="X",drawHorizBand:N[5]==="B",directRendering:N[6]==="D"}}),J(null,l.encoders=Z)})},$.availableFormats=$.getAvailableFormats=function(J){if("formats"in l)return J(null,l.formats);this._spawnFfmpeg(["-formats"],{captureStdout:!0,stdoutLines:0},function(U,H){if(U)return J(U);var Q=H.get(),W=Q.split(D2),Z={};W.forEach(function(Y){var N=Y.match(T9);if(N)N[3].split(",").forEach(function(K){if(!(K in Z))Z[K]={description:N[4],canDemux:!1,canMux:!1};if(N[1]==="D")Z[K].canDemux=!0;if(N[2]==="E")Z[K].canMux=!0})}),J(null,l.formats=Z)})},$._checkCapabilities=function(J){var U=this;O1.waterfall([function(H){U.availableFormats(H)},function(H,Q){var W=U._outputs.reduce(function(Z,Y){var N=Y.options.find("-f",1);if(N){if(!(N[0]in H)||!H[N[0]].canMux)Z.push(N)}return Z},[]);if(W.length===1)return Q(new Error("Output format "+W[0]+" is not available"));else if(W.length>1)return Q(new Error("Output formats "+W.join(", ")+" are not available"));if(W=U._inputs.reduce(function(Z,Y){var N=Y.options.find("-f",1);if(N){if(!(N[0]in H)||!H[N[0]].canDemux)Z.push(N[0])}return Z},[]),W.length===1)return Q(new Error("Input format "+W[0]+" is not available"));else if(W.length>1)return Q(new Error("Input formats "+W.join(", ")+" are not available"));Q()},function(H){U.availableEncoders(H)},function(H,Q){var W=U._outputs.reduce(function(Z,Y){var N=Y.audio.find("-acodec",1);if(N&&N[0]!=="copy"){if(!(N[0]in H)||H[N[0]].type!=="audio")Z.push(N[0])}return Z},[]);if(W.length===1)return Q(new Error("Audio codec "+W[0]+" is not available"));else if(W.length>1)return Q(new Error("Audio codecs "+W.join(", ")+" are not available"));if(W=U._outputs.reduce(function(Z,Y){var N=Y.video.find("-vcodec",1);if(N&&N[0]!=="copy"){if(!(N[0]in H)||H[N[0]].type!=="video")Z.push(N[0])}return Z},[]),W.length===1)return Q(new Error("Video codec "+W[0]+" is not available"));else if(W.length>1)return Q(new Error("Video codecs "+W.join(", ")+" are not available"));Q()}],J)}}});var Y5=_((GW,N5)=>{var L9=O("child_process").spawn;function D9($){return $.match(/^TAG:/)}function w9($){return $.match(/^DISPOSITION:/)}function F9($){var J=$.split(/\r\n|\r|\n/);J=J.filter(function(Y){return Y.length>0});var U={streams:[],format:{},chapters:[]};function H(Y){var N={},K=J.shift();while(typeof K!=="undefined"){if(K.toLowerCase()=="[/"+Y+"]")return N;else if(K.match(/^\[/)){K=J.shift();continue}var A=K.match(/^([^=]+)=(.*)$/);if(A)if(!A[1].match(/^TAG:/)&&A[2].match(/^[0-9]+(\.[0-9]+)?$/))N[A[1]]=Number(A[2]);else N[A[1]]=A[2];K=J.shift()}return N}var Q=J.shift();while(typeof Q!=="undefined"){if(Q.match(/^\[stream/i)){var W=H("stream");U.streams.push(W)}else if(Q.match(/^\[chapter/i)){var Z=H("chapter");U.chapters.push(Z)}else if(Q.toLowerCase()==="[format]")U.format=H("format");Q=J.shift()}return U}N5.exports=function($){$.ffprobe=function(){var J,U=null,H=[],Q,Q=arguments[arguments.length-1],W=!1;function Z(Y,N){if(!W)W=!0,Q(Y,N)}switch(arguments.length){case 3:U=arguments[0],H=arguments[1];break;case 2:if(typeof arguments[0]==="number")U=arguments[0];else if(Array.isArray(arguments[0]))H=arguments[0];break}if(U===null){if(!this._currentInput)return Z(new Error("No input specified"));J=this._currentInput}else if(J=this._inputs[U],!J)return Z(new Error("Invalid input index"));this._getFfprobePath(function(Y,N){if(Y)return Z(Y);else if(!N)return Z(new Error("Cannot find ffprobe"));var K="",A=!1,j="",D=!1,x=J.isStream?"pipe:0":J.source,C=L9(N,["-show_streams","-show_format"].concat(H,x),{windowsHide:!0});if(J.isStream)C.stdin.on("error",function(v){if(["ECONNRESET","EPIPE","EOF"].indexOf(v.code)>=0)return;Z(v)}),C.stdin.on("close",function(){J.source.pause(),J.source.unpipe(C.stdin)}),J.source.pipe(C.stdin);C.on("error",Q);var z=null;function T(v){if(v)z=v;if(h&&A&&D){if(z){if(j)z.message+=`
`+j;return Z(z)}var b=F9(K);[b.format].concat(b.streams).forEach(function(f){if(f){var V=Object.keys(f).filter(D9);if(V.length)f.tags=f.tags||{},V.forEach(function(P){f.tags[P.substr(4)]=f[P],delete f[P]});var G=Object.keys(f).filter(w9);if(G.length)f.disposition=f.disposition||{},G.forEach(function(P){f.disposition[P.substr(12)]=f[P],delete f[P]})}}),Z(null,b)}}var h=!1;C.on("exit",function(v,b){if(h=!0,v)T(new Error("ffprobe exited with code "+v));else if(b)T(new Error("ffprobe was killed with signal "+b));else T()}),C.stdout.on("data",function(v){K+=v}),C.stdout.on("close",function(){A=!0,T()}),C.stderr.on("data",function(v){j+=v}),C.stderr.on("close",function(){D=!0,T()})})}}});var G5=_((IW,X5)=>{var q5=O("fs"),T0=O("path"),M9=O("stream").PassThrough,C9=v1(),K5=K0();X5.exports=function $(J){J.saveToFile=J.save=function(U){return this.output(U).run(),this},J.writeToStream=J.pipe=J.stream=function(U,H){if(U&&!("writable"in U))H=U,U=void 0;if(!U){if(process.version.match(/v0\.8\./))throw new Error("PassThrough stream is not supported on node v0.8");U=new M9}return this.output(U,H).run(),U},J.takeScreenshots=J.thumbnail=J.thumbnails=J.screenshot=J.screenshots=function(U,H){var Q=this,W=this._currentInput.source;if(U=U||{count:1},typeof U==="number")U={count:U};if(!("folder"in U))U.folder=H||".";if("timestamps"in U)U.timemarks=U.timestamps;if(!("timemarks"in U)){if(!U.count)throw new Error("Cannot take screenshots: neither a count nor a timemark list are specified");var Z=100/(1+U.count);U.timemarks=[];for(var Y=0;Y<U.count;Y++)U.timemarks.push(Z*(Y+1)+"%")}if("size"in U){var N=U.size.match(/^(\d+)x(\d+)$/),K=U.size.match(/^(\d+)x\?$/),A=U.size.match(/^\?x(\d+)$/),j=U.size.match(/^(\d+)%$/);if(!N&&!K&&!A&&!j)throw new Error("Invalid size parameter: "+U.size)}var D;function x(C){if(D)C(null,D);else Q.ffprobe(function(z,T){D=T,C(z,T)})}return C9.waterfall([function C(z){if(U.timemarks.some(function(T){return(""+T).match(/^[\d.]+%$/)})){if(typeof W!=="string")return z(new Error("Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks"));x(function(T,h){if(T)z(T);else{var v=h.streams.reduce(function(f,V){if(V.codec_type==="video"&&V.width*V.height>f.width*f.height)return V;else return f},{width:0,height:0});if(v.width===0)return z(new Error("No video stream in input, cannot take screenshots"));var b=Number(v.duration);if(isNaN(b))b=Number(h.format.duration);if(isNaN(b))return z(new Error("Could not get input duration, please specify fixed timemarks"));U.timemarks=U.timemarks.map(function(f){if((""+f).match(/^([\d.]+)%$/))return b*parseFloat(f)/100;else return f}),z()}})}else z()},function C(z){U.timemarks=U.timemarks.map(function(T){return K5.timemarkToSeconds(T)}).sort(function(T,h){return T-h}),z()},function C(z){var T=U.filename||"tn.png";if(T.indexOf(".")===-1)T+=".png";if(U.timemarks.length>1&&!T.match(/%(s|0*i)/)){var h=T0.extname(T);T=T0.join(T0.dirname(T),T0.basename(T,h)+"_%i"+h)}z(null,T)},function C(z,T){if(z.match(/%[bf]/)){if(typeof W!=="string")return T(new Error("Cannot replace %f or %b when using an input stream"));z=z.replace(/%f/g,T0.basename(W)).replace(/%b/g,T0.basename(W,T0.extname(W)))}T(null,z)},function C(z,T){if(z.match(/%[whr]/)){if(N)return T(null,z,N[1],N[2]);x(function(h,v){if(h)return T(new Error("Could not determine video resolution to replace %w, %h or %r"));var b=v.streams.reduce(function(G,P){if(P.codec_type==="video"&&P.width*P.height>G.width*G.height)return P;else return G},{width:0,height:0});if(b.width===0)return T(new Error("No video stream in input, cannot replace %w, %h or %r"));var{width:f,height:V}=b;if(K)V=V*Number(K[1])/f,f=Number(K[1]);else if(A)f=f*Number(A[1])/V,V=Number(A[1]);else if(j)f=f*Number(j[1])/100,V=V*Number(j[1])/100;T(null,z,Math.round(f/2)*2,Math.round(V/2)*2)})}else T(null,z,-1,-1)},function C(z,T,h,v){z=z.replace(/%r/g,"%wx%h").replace(/%w/g,T).replace(/%h/g,h),v(null,z)},function C(z,T){var h=U.timemarks.map(function(v,b){return z.replace(/%s/g,K5.timemarkToSeconds(v)).replace(/%(0*)i/g,function(f,V){var G=""+(b+1);return V.substr(0,Math.max(0,V.length+1-G.length))+G})});Q.emit("filenames",h),T(null,h)},function C(z,T){q5.exists(U.folder,function(h){if(!h)q5.mkdir(U.folder,function(v){if(v)T(v);else T(null,z)});else T(null,z)})}],function C(z,T){if(z)return Q.emit("error",z);var h=U.timemarks.length,v,b=[v={filter:"split",options:h,outputs:[]}];if("size"in U){Q.size(U.size);var f=Q._currentOutput.sizeFilters.get().map(function(B,R){if(R>0)B.inputs="size"+(R-1);return B.outputs="size"+R,B});v.inputs="size"+(f.length-1),b=f.concat(b),Q._currentOutput.sizeFilters.clear()}var V=0;for(var G=0;G<h;G++){var P="screen"+G;if(v.outputs.push(P),G===0)V=U.timemarks[G],Q.seekInput(V);if(Q.output(T0.join(U.folder,T[G])).frames(1).map(P),G>0)Q.seek(U.timemarks[G]-V)}Q.complexFilter(b),Q.run()}),this},J.mergeToFile=J.concatenate=J.concat=function(U,H){var Q=this._inputs.filter(function(Z){return!Z.isStream})[0],W=this;return this.ffprobe(this._inputs.indexOf(Q),function(Z,Y){if(Z)return W.emit("error",Z);var N=Y.streams.some(function(A){return A.codec_type==="audio"}),K=Y.streams.some(function(A){return A.codec_type==="video"});W.output(U,H).complexFilter({filter:"concat",options:{n:W._inputs.length,v:K?1:0,a:N?1:0}}).run()}),this}}});var P5=_((VW,V5)=>{var __dirname="/Users/rahulkumar/Documents/media-helper/ffmpeg/node_modules/fluent-ffmpeg/lib",_9=O("path"),S9=O("util"),I5=O("events").EventEmitter,w2=K0();function g($,J){if(!(this instanceof g))return new g($,J);if(I5.call(this),typeof $==="object"&&!("readable"in $))J=$;else J=J||{},J.source=$;if(this._inputs=[],J.source)this.input(J.source);this._outputs=[],this.output();var U=this;["_global","_complexFilters"].forEach(function(H){U[H]=w2.args()}),J.stdoutLines="stdoutLines"in J?J.stdoutLines:100,J.presets=J.presets||J.preset||_9.join(__dirname,"presets"),J.niceness=J.niceness||J.priority||0,this.options=J,this.logger=J.logger||{debug:function(){},info:function(){},warn:function(){},error:function(){}}}S9.inherits(g,I5);V5.exports=g;g.prototype.clone=function(){var $=new g,J=this;if($.options=this.options,$.logger=this.logger,$._inputs=this._inputs.map(function(U){return{source:U.source,options:U.options.clone()}}),"target"in this._outputs[0])$._outputs=[],$.output();else{if($._outputs=[$._currentOutput={flags:{}}],["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(U){$._currentOutput[U]=J._currentOutput[U].clone()}),this._currentOutput.sizeData)$._currentOutput.sizeData={},w2.copy(this._currentOutput.sizeData,$._currentOutput.sizeData);w2.copy(this._currentOutput.flags,$._currentOutput.flags)}return["_global","_complexFilters"].forEach(function(U){$[U]=J[U].clone()}),$};g6()(g.prototype);u6()(g.prototype);l6()(g.prototype);a6()(g.prototype);s6()(g.prototype);i6()(g.prototype);o6()(g.prototype);H5()(g.prototype);Z5()(g.prototype);g.setFfmpegPath=function($){new g().setFfmpegPath($)};g.setFfprobePath=function($){new g().setFfprobePath($)};g.setFlvtoolPath=function($){new g().setFlvtoolPath($)};g.availableFilters=g.getAvailableFilters=function($){new g().availableFilters($)};g.availableCodecs=g.getAvailableCodecs=function($){new g().availableCodecs($)};g.availableFormats=g.getAvailableFormats=function($){new g().availableFormats($)};g.availableEncoders=g.getAvailableEncoders=function($){new g().availableEncoders($)};Y5()(g.prototype);g.ffprobe=function($){var J=new g($);J.ffprobe.apply(J,Array.prototype.slice.call(arguments,1))};G5()(g.prototype)});var h1=($,J,U)=>{return(H,Q)=>{let W=-1;return Z(0);async function Z(Y){if(Y<=W)throw new Error("next() called multiple times");W=Y;let N,K=!1,A;if($[Y])A=$[Y][0][0],H.req.routeIndex=Y;else A=Y===$.length&&Q||void 0;if(A)try{N=await A(H,()=>Z(Y+1))}catch(j){if(j instanceof Error&&J)H.error=j,N=await J(j,H),K=!0;else throw j}else if(H.finalized===!1&&U)N=await U(H);if(N&&(H.finalized===!1||K))H.res=N;return H}}};var x2=Symbol();var v2=async($,J=Object.create(null))=>{let{all:U=!1,dot:H=!1}=J,W=($ instanceof H1?$.raw.headers:$.headers).get("Content-Type");if(W?.startsWith("multipart/form-data")||W?.startsWith("application/x-www-form-urlencoded"))return w5($,{all:U,dot:H});return{}};async function w5($,J){let U=await $.formData();if(U)return F5(U,J);return{}}function F5($,J){let U=Object.create(null);if($.forEach((H,Q)=>{if(!(J.all||Q.endsWith("[]")))U[Q]=H;else M5(U,Q,H)}),J.dot)Object.entries(U).forEach(([H,Q])=>{if(H.includes("."))C5(U,H,Q),delete U[H]});return U}var M5=($,J,U)=>{if($[J]!==void 0)if(Array.isArray($[J]))$[J].push(U);else $[J]=[$[J],U];else if(!J.endsWith("[]"))$[J]=U;else $[J]=[U]},C5=($,J,U)=>{let H=$,Q=J.split(".");Q.forEach((W,Z)=>{if(Z===Q.length-1)H[W]=U;else{if(!H[W]||typeof H[W]!=="object"||Array.isArray(H[W])||H[W]instanceof File)H[W]=Object.create(null);H=H[W]}})};var b1=($)=>{let J=$.split("/");if(J[0]==="")J.shift();return J},O2=($)=>{let{groups:J,path:U}=_5($),H=b1(U);return S5(H,J)},_5=($)=>{let J=[];return $=$.replace(/\{[^}]+\}/g,(U,H)=>{let Q=`@${H}`;return J.push([Q,U]),Q}),{groups:J,path:$}},S5=($,J)=>{for(let U=J.length-1;U>=0;U--){let[H]=J[U];for(let Q=$.length-1;Q>=0;Q--)if($[Q].includes(H)){$[Q]=$[Q].replace(H,J[U][1]);break}}return $},Q1={},k2=($,J)=>{if($==="*")return"*";let U=$.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(U){let H=`${$}#${J}`;if(!Q1[H])if(U[2])Q1[H]=J&&J[0]!==":"&&J[0]!=="*"?[H,U[1],new RegExp(`^${U[2]}(?=/${J})`)]:[$,U[1],new RegExp(`^${U[2]}$`)];else Q1[H]=[$,U[1],!0];return Q1[H]}return null},W1=($,J)=>{try{return J($)}catch{return $.replace(/(?:%[0-9A-Fa-f]{2})+/g,(U)=>{try{return J(U)}catch{return U}})}},y5=($)=>W1($,decodeURI),g1=($)=>{let J=$.url,U=J.indexOf("/",J.indexOf(":")+4),H=U;for(;H<J.length;H++){let Q=J.charCodeAt(H);if(Q===37){let W=J.indexOf("?",H),Z=J.slice(U,W===-1?void 0:W);return y5(Z.includes("%25")?Z.replace(/%25/g,"%2525"):Z)}else if(Q===63)break}return J.slice(U,H)};var h2=($)=>{let J=g1($);return J.length>1&&J.at(-1)==="/"?J.slice(0,-1):J},D0=($,J,...U)=>{if(U.length)J=D0(J,...U);return`${$?.[0]==="/"?"":"/"}${$}${J==="/"?"":`${$?.at(-1)==="/"?"":"/"}${J?.[0]==="/"?J.slice(1):J}`}`},Z1=($)=>{if($.charCodeAt($.length-1)!==63||!$.includes(":"))return null;let J=$.split("/"),U=[],H="";return J.forEach((Q)=>{if(Q!==""&&!/\:/.test(Q))H+="/"+Q;else if(/\:/.test(Q))if(/\?/.test(Q)){if(U.length===0&&H==="")U.push("/");else U.push(H);let W=Q.replace("?","");H+="/"+W,U.push(H)}else H+="/"+Q}),U.filter((Q,W,Z)=>Z.indexOf(Q)===W)},f1=($)=>{if(!/[%+]/.test($))return $;if($.indexOf("+")!==-1)$=$.replace(/\+/g," ");return $.indexOf("%")!==-1?W1($,d1):$},f2=($,J,U)=>{let H;if(!U&&J&&!/[%+]/.test(J)){let Z=$.indexOf(`?${J}`,8);if(Z===-1)Z=$.indexOf(`&${J}`,8);while(Z!==-1){let Y=$.charCodeAt(Z+J.length+1);if(Y===61){let N=Z+J.length+2,K=$.indexOf("&",N);return f1($.slice(N,K===-1?void 0:K))}else if(Y==38||isNaN(Y))return"";Z=$.indexOf(`&${J}`,Z+1)}if(H=/[%+]/.test($),!H)return}let Q={};H??=/[%+]/.test($);let W=$.indexOf("?",8);while(W!==-1){let Z=$.indexOf("&",W+1),Y=$.indexOf("=",W);if(Y>Z&&Z!==-1)Y=-1;let N=$.slice(W+1,Y===-1?Z===-1?void 0:Z:Y);if(H)N=f1(N);if(W=Z,N==="")continue;let K;if(Y===-1)K="";else if(K=$.slice(Y+1,Z===-1?void 0:Z),H)K=f1(K);if(U){if(!(Q[N]&&Array.isArray(Q[N])))Q[N]=[];Q[N].push(K)}else Q[N]??=K}return J?Q[J]:Q},b2=f2,g2=($,J)=>{return f2($,J,!0)},d1=decodeURIComponent;var d2=($)=>W1($,d1),H1=class{raw;#$;#J;routeIndex=0;path;bodyCache={};constructor($,J="/",U=[[]]){this.raw=$,this.path=J,this.#J=U,this.#$={}}param($){return $?this.#U($):this.#W()}#U($){let J=this.#J[0][this.routeIndex][1][$],U=this.#Q(J);return U&&/\%/.test(U)?d2(U):U}#W(){let $={},J=Object.keys(this.#J[0][this.routeIndex][1]);for(let U of J){let H=this.#Q(this.#J[0][this.routeIndex][1][U]);if(H!==void 0)$[U]=/\%/.test(H)?d2(H):H}return $}#Q($){return this.#J[1]?this.#J[1][$]:$}query($){return b2(this.url,$)}queries($){return g2(this.url,$)}header($){if($)return this.raw.headers.get($)??void 0;let J={};return this.raw.headers.forEach((U,H)=>{J[H]=U}),J}async parseBody($){return this.bodyCache.parsedBody??=await v2(this,$)}#H=($)=>{let{bodyCache:J,raw:U}=this,H=J[$];if(H)return H;let Q=Object.keys(J)[0];if(Q)return J[Q].then((W)=>{if(Q==="json")W=JSON.stringify(W);return new Response(W)[$]()});return J[$]=U[$]()};json(){return this.#H("text").then(($)=>JSON.parse($))}text(){return this.#H("text")}arrayBuffer(){return this.#H("arrayBuffer")}blob(){return this.#H("blob")}formData(){return this.#H("formData")}addValidatedData($,J){this.#$[$]=J}valid($){return this.#$[$]}get url(){return this.raw.url}get method(){return this.raw.method}get[x2](){return this.#J}get matchedRoutes(){return this.#J[0].map(([[,$]])=>$)}get routePath(){return this.#J[0].map(([[,$]])=>$)[this.routeIndex].path}};var u2={Stringify:1,BeforeStream:2,Stream:3},x5=($,J)=>{let U=new String($);return U.isEscaped=!0,U.callbacks=J,U};var u1=async($,J,U,H,Q)=>{if(typeof $==="object"&&!($ instanceof String)){if(!($ instanceof Promise))$=$.toString();if($ instanceof Promise)$=await $}let W=$.callbacks;if(!W?.length)return Promise.resolve($);if(Q)Q[0]+=$;else Q=[$];let Z=Promise.all(W.map((Y)=>Y({phase:J,buffer:Q,context:H}))).then((Y)=>Promise.all(Y.filter(Boolean).map((N)=>u1(N,J,!1,H,Q))).then(()=>Q[0]));if(U)return x5(await Z,W);else return Z};var v5="text/plain; charset=UTF-8",m1=($,J)=>{return{"Content-Type":$,...J}},m2=class{#$;#J;env={};#U;finalized=!1;error;#W;#Q;#H;#K;#Y;#q;#N;#X;#G;constructor($,J){if(this.#$=$,J)this.#Q=J.executionCtx,this.env=J.env,this.#q=J.notFoundHandler,this.#G=J.path,this.#X=J.matchResult}get req(){return this.#J??=new H1(this.#$,this.#G,this.#X),this.#J}get event(){if(this.#Q&&"respondWith"in this.#Q)return this.#Q;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#Q)return this.#Q;else throw Error("This context has no ExecutionContext")}get res(){return this.#H||=new Response(null,{headers:this.#N??=new Headers})}set res($){if(this.#H&&$){$=new Response($.body,$);for(let[J,U]of this.#H.headers.entries()){if(J==="content-type")continue;if(J==="set-cookie"){let H=this.#H.headers.getSetCookie();$.headers.delete("set-cookie");for(let Q of H)$.headers.append("set-cookie",Q)}else $.headers.set(J,U)}}this.#H=$,this.finalized=!0}render=(...$)=>{return this.#Y??=(J)=>this.html(J),this.#Y(...$)};setLayout=($)=>this.#K=$;getLayout=()=>this.#K;setRenderer=($)=>{this.#Y=$};header=($,J,U)=>{if(this.finalized)this.#H=new Response(this.#H.body,this.#H);let H=this.#H?this.#H.headers:this.#N??=new Headers;if(J===void 0)H.delete($);else if(U?.append)H.append($,J);else H.set($,J)};status=($)=>{this.#W=$};set=($,J)=>{this.#U??=new Map,this.#U.set($,J)};get=($)=>{return this.#U?this.#U.get($):void 0};get var(){if(!this.#U)return{};return Object.fromEntries(this.#U)}#Z($,J,U){let H=this.#H?new Headers(this.#H.headers):this.#N??new Headers;if(typeof J==="object"&&"headers"in J){let W=J.headers instanceof Headers?J.headers:new Headers(J.headers);for(let[Z,Y]of W)if(Z.toLowerCase()==="set-cookie")H.append(Z,Y);else H.set(Z,Y)}if(U)for(let[W,Z]of Object.entries(U))if(typeof Z==="string")H.set(W,Z);else{H.delete(W);for(let Y of Z)H.append(W,Y)}let Q=typeof J==="number"?J:J?.status??this.#W;return new Response($,{status:Q,headers:H})}newResponse=(...$)=>this.#Z(...$);body=($,J,U)=>this.#Z($,J,U);text=($,J,U)=>{return!this.#N&&!this.#W&&!J&&!U&&!this.finalized?new Response($):this.#Z($,J,m1(v5,U))};json=($,J,U)=>{return this.#Z(JSON.stringify($),J,m1("application/json",U))};html=($,J,U)=>{let H=(Q)=>this.#Z(Q,J,m1("text/html; charset=UTF-8",U));return typeof $==="object"?u1($,u2.Stringify,!1,{}).then(H):H($)};redirect=($,J)=>{let U=String($);return this.header("Location",!/[^\x00-\xFF]/.test(U)?U:encodeURI(U)),this.newResponse(null,J??302)};notFound=()=>{return this.#q??=()=>new Response,this.#q(this)}};var m="ALL",l2="all",c2=["get","post","put","delete","options","patch"],N1="Can not add a route since the matcher is already built.",Y1=class extends Error{};var r2="__COMPOSED_HANDLER";var O5=($)=>{return $.text("404 Not Found",404)},a2=($,J)=>{if("getResponse"in $){let U=$.getResponse();return J.newResponse(U.body,U)}return console.error($),J.text("Internal Server Error",500)},l1=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#$="/";routes=[];constructor($={}){[...c2,l2].forEach((Q)=>{this[Q]=(W,...Z)=>{if(typeof W==="string")this.#$=W;else this.#W(Q,this.#$,W);return Z.forEach((Y)=>{this.#W(Q,this.#$,Y)}),this}}),this.on=(Q,W,...Z)=>{for(let Y of[W].flat()){this.#$=Y;for(let N of[Q].flat())Z.map((K)=>{this.#W(N.toUpperCase(),this.#$,K)})}return this},this.use=(Q,...W)=>{if(typeof Q==="string")this.#$=Q;else this.#$="*",W.unshift(Q);return W.forEach((Z)=>{this.#W(m,this.#$,Z)}),this};let{strict:U,...H}=$;Object.assign(this,H),this.getPath=U??!0?$.getPath??g1:h2}#J(){let $=new l1({router:this.router,getPath:this.getPath});return $.errorHandler=this.errorHandler,$.#U=this.#U,$.routes=this.routes,$}#U=O5;errorHandler=a2;route($,J){let U=this.basePath($);return J.routes.map((H)=>{let Q;if(J.errorHandler===a2)Q=H.handler;else Q=async(W,Z)=>(await h1([],J.errorHandler)(W,()=>H.handler(W,Z))).res,Q[r2]=H.handler;U.#W(H.method,H.path,Q)}),this}basePath($){let J=this.#J();return J._basePath=D0(this._basePath,$),J}onError=($)=>{return this.errorHandler=$,this};notFound=($)=>{return this.#U=$,this};mount($,J,U){let H,Q;if(U)if(typeof U==="function")Q=U;else if(Q=U.optionHandler,U.replaceRequest===!1)H=(Y)=>Y;else H=U.replaceRequest;let W=Q?(Y)=>{let N=Q(Y);return Array.isArray(N)?N:[N]}:(Y)=>{let N=void 0;try{N=Y.executionCtx}catch{}return[Y.env,N]};H||=(()=>{let Y=D0(this._basePath,$),N=Y==="/"?0:Y.length;return(K)=>{let A=new URL(K.url);return A.pathname=A.pathname.slice(N)||"/",new Request(A,K)}})();let Z=async(Y,N)=>{let K=await J(H(Y.req.raw),...W(Y));if(K)return K;await N()};return this.#W(m,D0($,"*"),Z),this}#W($,J,U){$=$.toUpperCase(),J=D0(this._basePath,J);let H={basePath:this._basePath,path:J,method:$,handler:U};this.router.add($,J,[U,H]),this.routes.push(H)}#Q($,J){if($ instanceof Error)return this.errorHandler($,J);throw $}#H($,J,U,H){if(H==="HEAD")return(async()=>new Response(null,await this.#H($,J,U,"GET")))();let Q=this.getPath($,{env:U}),W=this.router.match(H,Q),Z=new m2($,{path:Q,matchResult:W,env:U,executionCtx:J,notFoundHandler:this.#U});if(W[0].length===1){let N;try{N=W[0][0][0][0](Z,async()=>{Z.res=await this.#U(Z)})}catch(K){return this.#Q(K,Z)}return N instanceof Promise?N.then((K)=>K||(Z.finalized?Z.res:this.#U(Z))).catch((K)=>this.#Q(K,Z)):N??this.#U(Z)}let Y=h1(W[0],this.errorHandler,this.#U);return(async()=>{try{let N=await Y(Z);if(!N.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return N.res}catch(N){return this.#Q(N,Z)}})()}fetch=($,...J)=>{return this.#H($,J[1],J[0],$.method)};request=($,J,U,H)=>{if($ instanceof Request)return this.fetch(J?new Request($,J):$,U,H);return $=$.toString(),this.fetch(new Request(/^https?:\/\//.test($)?$:`http://localhost${D0("/",$)}`,J),U,H)};fire=()=>{addEventListener("fetch",($)=>{$.respondWith(this.#H($.request,$,void 0,$.request.method))})}};var l0=[];function q1($,J){let U=this.buildAllMatchers(),H=(Q,W)=>{let Z=U[Q]||U[m],Y=Z[2][W];if(Y)return Y;let N=W.match(Z[0]);if(!N)return[[],l0];let K=N.indexOf("",1);return[Z[1][K],N]};return this.match=H,H($,J)}var K1="[^/]+",c0=".*",r0="(?:|/.*)",w0=Symbol(),k5=new Set(".\\+*[^]$()");function h5($,J){if($.length===1)return J.length===1?$<J?-1:1:-1;if(J.length===1)return 1;if($===c0||$===r0)return 1;else if(J===c0||J===r0)return-1;if($===K1)return 1;else if(J===K1)return-1;return $.length===J.length?$<J?-1:1:J.length-$.length}var X1=class{#$;#J;#U=Object.create(null);insert($,J,U,H,Q){if($.length===0){if(this.#$!==void 0)throw w0;if(Q)return;this.#$=J;return}let[W,...Z]=$,Y=W==="*"?Z.length===0?["","",c0]:["","",K1]:W==="/*"?["","",r0]:W.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),N;if(Y){let K=Y[1],A=Y[2]||K1;if(K&&Y[2]){if(A===".*")throw w0;if(A=A.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(A))throw w0}if(N=this.#U[A],!N){if(Object.keys(this.#U).some((j)=>j!==c0&&j!==r0))throw w0;if(Q)return;if(N=this.#U[A]=new X1,K!=="")N.#J=H.varIndex++}if(!Q&&K!=="")U.push([K,N.#J])}else if(N=this.#U[W],!N){if(Object.keys(this.#U).some((K)=>K.length>1&&K!==c0&&K!==r0))throw w0;if(Q)return;N=this.#U[W]=new X1}N.insert(Z,J,U,H,Q)}buildRegExpStr(){let J=Object.keys(this.#U).sort(h5).map((U)=>{let H=this.#U[U];return(typeof H.#J==="number"?`(${U})@${H.#J}`:k5.has(U)?`\\${U}`:U)+H.buildRegExpStr()});if(typeof this.#$==="number")J.unshift(`#${this.#$}`);if(J.length===0)return"";if(J.length===1)return J[0];return"(?:"+J.join("|")+")"}};var e2=class{#$={varIndex:0};#J=new X1;insert($,J,U){let H=[],Q=[];for(let Z=0;;){let Y=!1;if($=$.replace(/\{[^}]+\}/g,(N)=>{let K=`@\\${Z}`;return Q[Z]=[K,N],Z++,Y=!0,K}),!Y)break}let W=$.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let Z=Q.length-1;Z>=0;Z--){let[Y]=Q[Z];for(let N=W.length-1;N>=0;N--)if(W[N].indexOf(Y)!==-1){W[N]=W[N].replace(Y,Q[Z][1]);break}}return this.#J.insert(W,J,H,this.#$,U),H}buildRegExp(){let $=this.#J.buildRegExpStr();if($==="")return[/^$/,[],[]];let J=0,U=[],H=[];return $=$.replace(/#(\d+)|@(\d+)|\.\*\$/g,(Q,W,Z)=>{if(W!==void 0)return U[++J]=Number(W),"$()";if(Z!==void 0)return H[Number(Z)]=++J,"";return""}),[new RegExp(`^${$}`),U,H]}};var f5=[/^$/,[],Object.create(null)],n2=Object.create(null);function s2($){return n2[$]??=new RegExp($==="*"?"":`^${$.replace(/\/\*$|([.\\+*[^\]$()])/g,(J,U)=>U?`\\${U}`:"(?:|/.*)")}$`)}function b5(){n2=Object.create(null)}function g5($){let J=new e2,U=[];if($.length===0)return f5;let H=$.map((K)=>[!/\*|\/:/.test(K[0]),...K]).sort(([K,A],[j,D])=>K?1:j?-1:A.length-D.length),Q=Object.create(null);for(let K=0,A=-1,j=H.length;K<j;K++){let[D,x,C]=H[K];if(D)Q[x]=[C.map(([T])=>[T,Object.create(null)]),l0];else A++;let z;try{z=J.insert(x,A,D)}catch(T){throw T===w0?new Y1(x):T}if(D)continue;U[A]=C.map(([T,h])=>{let v=Object.create(null);h-=1;for(;h>=0;h--){let[b,f]=z[h];v[b]=f}return[T,v]})}let[W,Z,Y]=J.buildRegExp();for(let K=0,A=U.length;K<A;K++)for(let j=0,D=U[K].length;j<D;j++){let x=U[K][j]?.[1];if(!x)continue;let C=Object.keys(x);for(let z=0,T=C.length;z<T;z++)x[C[z]]=Y[x[C[z]]]}let N=[];for(let K in Z)N[K]=U[Z[K]];return[W,N,Q]}function y0($,J){if(!$)return;for(let U of Object.keys($).sort((H,Q)=>Q.length-H.length))if(s2(U).test(J))return[...$[U]];return}var G1=class{name="RegExpRouter";#$;#J;constructor(){this.#$={[m]:Object.create(null)},this.#J={[m]:Object.create(null)}}add($,J,U){let H=this.#$,Q=this.#J;if(!H||!Q)throw new Error(N1);if(!H[$])[H,Q].forEach((Y)=>{Y[$]=Object.create(null),Object.keys(Y[m]).forEach((N)=>{Y[$][N]=[...Y[m][N]]})});if(J==="/*")J="*";let W=(J.match(/\/:/g)||[]).length;if(/\*$/.test(J)){let Y=s2(J);if($===m)Object.keys(H).forEach((N)=>{H[N][J]||=y0(H[N],J)||y0(H[m],J)||[]});else H[$][J]||=y0(H[$],J)||y0(H[m],J)||[];Object.keys(H).forEach((N)=>{if($===m||$===N)Object.keys(H[N]).forEach((K)=>{Y.test(K)&&H[N][K].push([U,W])})}),Object.keys(Q).forEach((N)=>{if($===m||$===N)Object.keys(Q[N]).forEach((K)=>Y.test(K)&&Q[N][K].push([U,W]))});return}let Z=Z1(J)||[J];for(let Y=0,N=Z.length;Y<N;Y++){let K=Z[Y];Object.keys(Q).forEach((A)=>{if($===m||$===A)Q[A][K]||=[...y0(H[A],K)||y0(H[m],K)||[]],Q[A][K].push([U,W-N+Y+1])})}}match=q1;buildAllMatchers(){let $=Object.create(null);return Object.keys(this.#J).concat(Object.keys(this.#$)).forEach((J)=>{$[J]||=this.#U(J)}),this.#$=this.#J=void 0,b5(),$}#U($){let J=[],U=$===m;if([this.#$,this.#J].forEach((H)=>{let Q=H[$]?Object.keys(H[$]).map((W)=>[W,H[$][W]]):[];if(Q.length!==0)U||=!0,J.push(...Q);else if($!==m)J.push(...Object.keys(H[m]).map((W)=>[W,H[m][W]]))}),!U)return null;else return g5(J)}};var d5=class{name="PreparedRegExpRouter";#$;#J;constructor($,J){this.#$=$,this.#J=J}#U($,J){let U=this.#$[$];U[1].forEach((H)=>H&&H.push(J)),Object.values(U[2]).forEach((H)=>H[0].push(J))}#W($,J,U,H,Q){let W=this.#$[$];if(!Q)W[2][J][0].push([U,{}]);else H.forEach((Z)=>{if(typeof Z==="number")W[1][Z].push([U,Q]);else W[2][Z||J][0].push([U,Q])})}add($,J,U){if(!this.#$[$]){let Q=this.#$[m],W={};for(let Z in Q[2])W[Z]=[Q[2][Z][0].slice(),l0];this.#$[$]=[Q[0],Q[1].map((Z)=>Array.isArray(Z)?Z.slice():0),W]}if(J==="/*"||J==="*"){let Q=[U,{}];if($===m)for(let W in this.#$)this.#U(W,Q);else this.#U($,Q);return}let H=this.#J[J];if(!H)throw new Error(`Path ${J} is not registered`);for(let[Q,W]of H)if($===m)for(let Z in this.#$)this.#W(Z,J,U,Q,W);else this.#W($,J,U,Q,W)}buildAllMatchers(){return this.#$}match=q1};var c1=class{name="SmartRouter";#$=[];#J=[];constructor($){this.#$=$.routers}add($,J,U){if(!this.#J)throw new Error(N1);this.#J.push([$,J,U])}match($,J){if(!this.#J)throw new Error("Fatal error");let U=this.#$,H=this.#J,Q=U.length,W=0,Z;for(;W<Q;W++){let Y=U[W];try{for(let N=0,K=H.length;N<K;N++)Y.add(...H[N]);Z=Y.match($,J)}catch(N){if(N instanceof Y1)continue;throw N}this.match=Y.match.bind(Y),this.#$=[Y],this.#J=void 0;break}if(W===Q)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,Z}get activeRouter(){if(this.#J||this.#$.length!==1)throw new Error("No active router has been determined yet.");return this.#$[0]}};var a0=Object.create(null),r1=class{#$;#J;#U;#W=0;#Q=a0;constructor($,J,U){if(this.#J=U||Object.create(null),this.#$=[],$&&J){let H=Object.create(null);H[$]={handler:J,possibleKeys:[],score:0},this.#$=[H]}this.#U=[]}insert($,J,U){this.#W=++this.#W;let H=this,Q=O2(J),W=[];for(let Z=0,Y=Q.length;Z<Y;Z++){let N=Q[Z],K=Q[Z+1],A=k2(N,K),j=Array.isArray(A)?A[0]:N;if(j in H.#J){if(H=H.#J[j],A)W.push(A[1]);continue}if(H.#J[j]=new r1,A)H.#U.push(A),W.push(A[1]);H=H.#J[j]}return H.#$.push({[$]:{handler:U,possibleKeys:W.filter((Z,Y,N)=>N.indexOf(Z)===Y),score:this.#W}}),H}#H($,J,U,H){let Q=[];for(let W=0,Z=$.#$.length;W<Z;W++){let Y=$.#$[W],N=Y[J]||Y[m],K={};if(N!==void 0){if(N.params=Object.create(null),Q.push(N),U!==a0||H&&H!==a0)for(let A=0,j=N.possibleKeys.length;A<j;A++){let D=N.possibleKeys[A],x=K[N.score];N.params[D]=H?.[D]&&!x?H[D]:U[D]??H?.[D],K[N.score]=!0}}}return Q}search($,J){let U=[];this.#Q=a0;let Q=[this],W=b1(J),Z=[];for(let Y=0,N=W.length;Y<N;Y++){let K=W[Y],A=Y===N-1,j=[];for(let D=0,x=Q.length;D<x;D++){let C=Q[D],z=C.#J[K];if(z)if(z.#Q=C.#Q,A){if(z.#J["*"])U.push(...this.#H(z.#J["*"],$,C.#Q));U.push(...this.#H(z,$,C.#Q))}else j.push(z);for(let T=0,h=C.#U.length;T<h;T++){let v=C.#U[T],b=C.#Q===a0?{}:{...C.#Q};if(v==="*"){let R=C.#J["*"];if(R)U.push(...this.#H(R,$,C.#Q)),R.#Q=b,j.push(R);continue}let[f,V,G]=v;if(!K&&!(G instanceof RegExp))continue;let P=C.#J[f],B=W.slice(Y).join("/");if(G instanceof RegExp){let R=G.exec(B);if(R){if(b[V]=R[0],U.push(...this.#H(P,$,C.#Q,b)),Object.keys(P.#J).length){P.#Q=b;let E=R[0].match(/\//)?.length??0;(Z[E]||=[]).push(P)}continue}}if(G===!0||G.test(K))if(b[V]=K,A){if(U.push(...this.#H(P,$,b,C.#Q)),P.#J["*"])U.push(...this.#H(P.#J["*"],$,b,C.#Q))}else P.#Q=b,j.push(P)}}Q=j.concat(Z.shift()??[])}if(U.length>1)U.sort((Y,N)=>{return Y.score-N.score});return[U.map(({handler:Y,params:N})=>[Y,N])]}};var a1=class{name="TrieRouter";#$;constructor(){this.#$=new r1}add($,J,U){let H=Z1(J);if(H){for(let Q=0,W=H.length;Q<W;Q++)this.#$.insert($,H[Q],U);return}this.#$.insert($,J,U)}match($,J){return this.#$.search($,J)}};var e1=class extends l1{constructor($={}){super($);this.router=$.router??new c1({routers:[new G1,new a1]})}};var E5=y2(V6(),1);var A5=y2(P5(),1);import{unlink as y9,writeFile as x9}from"fs/promises";import{tmpdir as v9}from"os";import{join as O9}from"path";var J1=async($)=>{let J=$.type.split("/")[0],U=O9(v9(),$.name);await x9(U,Buffer.from(await $.arrayBuffer()));try{return await new Promise((H,Q)=>{A5.default.ffprobe(U,(W,Z)=>{if(W)return Q(W);let Y=Z.streams.find((K)=>K.codec_type==="video"),N=Z.streams.find((K)=>K.codec_type==="audio");if(J==="image"){let{width:K,height:A}=Y||{};H({width:K,height:A})}else if(J==="video"){let{duration:K}=Z.format||{},{width:A,height:j}=Y||{};H({duration:K,width:A,height:j})}else if(J==="audio"){let{duration:K}=Z.format||{};H({duration:K})}else Q(new Error("Unsupported file type"))})})}finally{await y9(U)}};import{unlink as B5}from"fs/promises";var R5=async($)=>{let J=$.get("file"),U=$.get("height")?.toString()||"200",H=$.get("width")?.toString()||"200",Q=$.get("duration")?.toString()||"0",W=$.get("quality")?.toString()||"80",Z=$.get("format")?.toString()||"avif",Y=`/tmp/thumbnail-input-${Date.now()}`;await Bun.write(Y,J);let N=`/tmp/thumbnail-output-${Date.now()}.${Z}`,A=J.type.startsWith("video")?["-i",Y,"-ss",Q,"-vframes","1","-vf",`scale=${H}:${U}:force_original_aspect_ratio=decrease`,"-c:v",Z==="webp"?"libwebp":Z==="avif"?"libaom-av1":Z,"-q:v",W,"-y",N]:["-i",Y,"-vf",`scale=${H}:${U}`,"-c:v",Z==="webp"?"libwebp":Z==="avif"?"libaom-av1":Z,"-q:v",W,"-y",N];await Bun.spawn(["ffmpeg",...A]).exited;let D=Bun.file(N);return(async()=>{await B5(Y),await B5(N)})(),new File([await D.arrayBuffer()],`${J.name.split(".")[0]}-thumbnail.${Z}`,{type:`image/${Z}`})};var k9={thumbnail:R5,info:J1},F2=new e1;F2.get("/",async($)=>{let J=$.req.query("width")||200,U=$.req.query("height")||200,H=$.req.query("url")||"https://i.ytimg.com/vi/xtJA_3kH4Qg/hqdefault.jpg",Q=await fetch(H).then((Z)=>Z.arrayBuffer()),W=await E5.default(Buffer.from(Q)).resize(Number(J),Number(U)).toBuffer();return new Response(W,{headers:{"Content-Type":"image/jpeg"}})});F2.all("/:path",async($,J)=>{let U=$.req.param("path"),H=k9[U];if(!H)return $.json({error:"Invalid action"},400);if($.req.method==="GET"||$.req.method==="HEAD")return $.json({error:"Method not allowed"},405);let Q=await $.req.formData(),W=Q.get("file");if(H===J1){let K=await J1(W);return $.json(K)}if(!W)return $.json({error:"Invalid file"},400);if(!(W.type.startsWith("image")||W.type.startsWith("video")||W.type.startsWith("audio")))return $.json({error:"Invalid file type"},400);let[Y,N]=await Promise.all([H(Q,$),J1(W)]);return new Response(Y,{headers:{"Content-Type":Y.type,"X-INFO":JSON.stringify(N)}})});var DW={port:3000,fetch:F2.fetch};export{DW as default};
